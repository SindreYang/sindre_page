<!DOCTYPE html>
<html lang="zh-CN,en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.mviai.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="自动摘要: 	正交投影摄像机和透视投影摄像机	1.区别		正交投影摄像机：所有物体被渲染出来的尺寸是一样的，没有近大远小之分。因为对象相对于摄像机的距离对渲染的结果是没有影响的。常用于二维游戏中。透视投影摄 ……..">
<meta property="og:type" content="article">
<meta property="og:title" content="8">
<meta property="og:url" content="http://blog.mviai.com/2025/8._Three.js/index.html">
<meta property="og:site_name" content="落叶无痕">
<meta property="og:description" content="自动摘要: 	正交投影摄像机和透视投影摄像机	1.区别		正交投影摄像机：所有物体被渲染出来的尺寸是一样的，没有近大远小之分。因为对象相对于摄像机的距离对渲染的结果是没有影响的。常用于二维游戏中。透视投影摄 ……..">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.mviai.com/images/1666055976066-a0aae5d8-3c70-4b5a-ae68-3951372aaf95.jpeg">
<meta property="og:image" content="http://blog.mviai.com/images/1666058037376-c882f682-47c0-43ed-8341-43df67cf32d1.png">
<meta property="og:image" content="http://blog.mviai.com/images/1666058048694-4ab4171e-6c9b-47db-9fa4-fef5bb2c5a61.png">
<meta property="og:image" content="http://blog.mviai.com/images/1668668784398-0c73e8ce-3dd4-4b23-8559-96e246c7e21f.png">
<meta property="og:image" content="http://blog.mviai.com/images/1668668577554-a03bcc0d-6f8d-4ff3-88dd-81a058ed0de7.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667208451941-bd1ac2cf-9f02-49a9-85d5-947fb92bf19c.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667208921070-16eecc42-d4cb-40c4-9045-8dff09a19a19.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667267400670-539d575f-78f8-4f90-92ee-d60d8a9f6c43.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667267393418-3d968190-2215-4731-a17a-360684e789bd.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667271331333-f9dd7df5-6c88-4a4e-920a-57f7270fadb0.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667281330336-045d5f8a-a418-49c6-901b-27f575d5d4d9.png">
<meta property="og:image" content="http://blog.mviai.com/images/1667358786048-ef1773b6-4d25-4ec8-8bd7-0ae47b06ced1.png">
<meta property="article:published_time" content="2025-01-22T04:37:41.000Z">
<meta property="article:modified_time" content="2025-01-22T12:37:41.510Z">
<meta property="article:author" content="SindreYang">
<meta property="article:tag" content="生活">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.mviai.com/images/1666055976066-a0aae5d8-3c70-4b5a-ae68-3951372aaf95.jpeg">

<link rel="canonical" href="http://blog.mviai.com/2025/8._Three.js/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>8 | 落叶无痕</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">落叶无痕</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">72</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">321</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NpbmRyZVlhbmc=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.mviai.com/2025/8._Three.js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="SindreYang">
      <meta itemprop="description" content="沉淀后我愿意做一个温暖的人。有自己的喜好，有自己的原则，有自己的信仰，不急功近利，不浮夸轻薄，宠辱不惊，淡定安逸，心静如水。------不忘初心，方得始终">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落叶无痕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          8
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-01-22 12:37:41 / 修改时间：20:37:41" itemprop="dateCreated datePublished" datetime="2025-01-22T12:37:41+08:00">2025-01-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/3DWeb%E5%9F%B9%E8%AE%AD%E8%AE%A1%E5%88%92/" itemprop="url" rel="index"><span itemprop="name">3DWeb培训计划</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    
      <a title="changyan" href="/2025/8._Three.js/#SOHUCS" itemprop="discussionUrl">
        <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2025/8._Three.js/" itemprop="commentCount"></span>
      </a>
    
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>自动摘要: 	正交投影摄像机和透视投影摄像机	1.区别		正交投影摄像机：所有物体被渲染出来的尺寸是一样的，没有近大远小之分。因为对象相对于摄像机的距离对渲染的结果是没有影响的。常用于二维游戏中。透视投影摄 ……..</p>
<span id="more"></span>

<h1 id="正交投影摄像机和透视投影摄像机"><a href="#正交投影摄像机和透视投影摄像机" class="headerlink" title="正交投影摄像机和透视投影摄像机"></a>正交投影摄像机和透视投影摄像机</h1><ol>
<li>区别</li>
</ol>
<p>正交投影摄像机：所有物体被渲染出来的尺寸是一样的，没有近大远小之分。因为对象相对于摄像机的距离对渲染的结果是没有影响的。常用于二维游戏中。透视投影摄像机：透视试图，近大远小。更贴近真实世界。</p>
<ol start="2">
<li>属性</li>
</ol>
<p>正交投影摄像机Orthographic Camera：<img src="/images/1666055976066-a0aae5d8-3c70-4b5a-ae68-3951372aaf95.jpeg"><br>构造函数：</p>
<p>THREE.OrthographicCamera(left, right, top, bottom, near, far)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>left（左边界）</td>
<td>可视范围的左平面，渲染部分的左边界。</td>
</tr>
<tr>
<td>right（右边界）</td>
<td>可渲染区域的另一边界</td>
</tr>
<tr>
<td>top（上边界）</td>
<td>可渲染区域的最上面</td>
</tr>
<tr>
<td>bottom（下边界）</td>
<td>可渲染区域的最下面</td>
</tr>
<tr>
<td>near（近面距离）</td>
<td>基于摄像机所处的位置，从这一点开始渲染</td>
</tr>
<tr>
<td>far（远面距离）</td>
<td>基于摄像机所处的位置，渲染场景到这一点结束</td>
</tr>
<tr>
<td>zoom（变焦）</td>
<td>放大和缩小场景（默认值为1，小于1—缩小，大于1—放大，负数场景会上下颠倒）</td>
</tr>
</tbody></table>
<pre><code>透视投影摄像机PerspectiveCamera：![](/images/1666056384697-d28eb3a7-2764-4c7b-ad98-6c6a8021a4f7.jpeg)
</code></pre>
<p>构造函数：</p>
<p>THREE.PerspectiveCamera(fov,aspect,near,far,zoom)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>fov</td>
<td>视场。摄像机能够看到的那部分场景。一般计算机不能完全显示能够看到的景象，所以一般会选择较小的区域。推荐默认值：50</td>
</tr>
<tr>
<td>aspect（长宽比）</td>
<td>渲染结果的横向尺寸和纵向尺寸的比值。推荐默认值：window.innerWidth&#x2F;window.innerHeight</td>
</tr>
<tr>
<td>near（近面距离）</td>
<td>定义从距离摄像机多近的距离开始渲染。推荐默认值：0.1</td>
</tr>
<tr>
<td>far（远面距离）</td>
<td>定义了摄像机从它所处的位置能够看多远。推荐默认值：100</td>
</tr>
<tr>
<td>zoom（变焦）</td>
<td>放大和缩小场景（默认值为1，小于1—缩小，大于1—放大，负数场景会上下颠倒）</td>
</tr>
</tbody></table>
<ol start="3">
<li>实例：</li>
</ol>
<p><img src="/images/1666058037376-c882f682-47c0-43ed-8341-43df67cf32d1.png"><br><img src="/images/1666058048694-4ab4171e-6c9b-47db-9fa4-fef5bb2c5a61.png"><br>需求：在Three.js中改变摄像机，通过点击按钮SwitchCamera时，透视摄像机变成正交摄像机。过程：a. 构建基本场景（scene，camera，renderer，plane，spotLight，ambientLight）b. 添加立方体（平铺整个平面）c. 添加初始化性能插件、dat.GUI简化实验流程d. 添加用户交互插件e. 窗口触发函数（页面响应式布局）代码：HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">viewport</span></span></span><br><span class="line"><span class="tag">		  <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/three/three.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/three/controls/TrackballControls.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/three/geometries/ConvexGeometry.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/three/geometries/QuickHull.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/three/geometries/ParametricGeometries.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/util/Stats.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/util/dat.gui.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;libs/three/controls/OrbitControls.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/util.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;04-01.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/default.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;draw()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">120</span>,<span class="number">60</span>,<span class="number">180</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRender</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平面</span></span><br><span class="line"><span class="keyword">var</span> plane;</span><br><span class="line"><span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">180</span>,<span class="number">180</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initPlane</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> planeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry, planeMaterial);</span><br><span class="line"></span><br><span class="line">    plane.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="number">0.5</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">    plane.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(plane);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//光</span></span><br><span class="line"><span class="keyword">var</span> light;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    scene.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x292929</span>));</span><br><span class="line"></span><br><span class="line">    light = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(<span class="number">0xffffff</span>,<span class="number">0.7</span>);</span><br><span class="line">    light.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">20</span>,<span class="number">40</span>,<span class="number">60</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//方块</span></span><br><span class="line"><span class="keyword">var</span> cube;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCube</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;(planeGeometry.<span class="property">parameters</span>.<span class="property">height</span>/<span class="number">5</span>);j++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;planeGeometry.<span class="property">parameters</span>.<span class="property">width</span>/<span class="number">5</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> rnd = <span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">0.75</span>+<span class="number">0.25</span>;</span><br><span class="line">            <span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>();</span><br><span class="line">            cubeMaterial.<span class="property">color</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(rnd,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,cubeMaterial);</span><br><span class="line"></span><br><span class="line">            cube.<span class="property">position</span>.<span class="title function_">set</span>(</span><br><span class="line">                -((planeGeometry.<span class="property">parameters</span>.<span class="property">width</span>)/<span class="number">2</span>)+<span class="number">2</span>+(i*<span class="number">5</span>),</span><br><span class="line">                <span class="number">2</span>,</span><br><span class="line">                -((planeGeometry.<span class="property">parameters</span>.<span class="property">height</span>)/<span class="number">2</span>)+<span class="number">2</span>+(j*<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">            scene.<span class="title function_">add</span>(cube);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用dat.GUI简化实验流程</span></span><br><span class="line"><span class="keyword">var</span> trackballControls;</span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>)&#123;</span><br><span class="line">    controls = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">perspective</span> = <span class="string">&quot;Perspective&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">switchCamera</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(camera <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>)&#123;</span><br><span class="line">                camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrthographicCamera</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>/-<span class="number">16</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="number">16</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>/<span class="number">16</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>/-<span class="number">16</span>, -<span class="number">200</span>,<span class="number">500</span>);</span><br><span class="line">                camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">120</span>,<span class="number">60</span>,<span class="number">180</span>);</span><br><span class="line">                camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);</span><br><span class="line"></span><br><span class="line">                trackballControls = <span class="title function_">initTrackballControls</span>(camera,renderer);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">perspective</span> = <span class="string">&quot;Orthographic&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">                camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">120</span>,<span class="number">60</span>,<span class="number">180</span>);</span><br><span class="line"></span><br><span class="line">                camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);</span><br><span class="line">                trackballControls = <span class="title function_">initTrackballControls</span>(camera,renderer);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">perspective</span> = <span class="string">&quot;Perspective&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;switchCamera&#x27;</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;perspective&#x27;</span>).<span class="title function_">listen</span>();</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&#x27;300px&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> interaction;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initInteraction</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    interaction = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    interaction.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    interaction.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    interaction.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    interaction.<span class="property">minDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    interaction.<span class="property">maxDistance</span>  = <span class="number">600</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    interaction.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口触发函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onWindowResize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//更新控制器</span></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="comment">//更新性能插件</span></span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRender</span>();</span><br><span class="line">    <span class="title function_">initPlane</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initCube</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initInteraction</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = onWindowResize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>总结：正交投影摄像机和透视投影摄像机的切换，首先用instanceof判断目前摄像机是否是透视摄像机，如果是透视投影摄像机，则用<strong><strong>camera &#x3D; new THREE.OrthographicCamera（left, right, top, bottom, near, far）</strong></strong>设置为正交投影摄像机，反之亦然。后续可以继续设置摄像机的位置，对准场景中心。</strong></p>
<h1 id="从外部资源加载几何体"><a href="#从外部资源加载几何体" class="headerlink" title="从外部资源加载几何体"></a>从外部资源加载几何体</h1><table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>JSON</td>
<td></td>
</tr>
<tr>
<td>OBJ或MTL</td>
<td>OBJ是一种简单的三维文件格式，由Wavefront Technologies创建。它是使用最广泛的三维文件格式，用来定义对象的几何体。MTL文件常同OBJ文件一起使用。Three.js还有一个可定制的OBJ导出器，叫做OBJExporter.js，可以用来将Three.js中的模型导出一个OBJ文件。</td>
</tr>
<tr>
<td>STL</td>
<td>STL是STLereoLithography（立体成型术）的缩写，广泛用于快速成型。例如三维打印机的模型文件通常是STL文件。Three.js还有一个可定制的STL导出器，叫作OBJExporter.js，可以用来将Three.js中的模型导出到一个OBJ文件。</td>
</tr>
<tr>
<td>PLY</td>
<td>这种格式的全程是多边形（polygon）文件格式，通常用来保存三维扫描仪的信息。</td>
</tr>
</tbody></table>
<p>以牙齿模型ply格式为例：首先：引入script加载器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;libs/three/loaders/PLYLoader.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>然后实例化加载对象，加载模型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PLYLoader</span>();</span><br><span class="line">loader.<span class="title function_">load</span>(<span class="string">&#x27;tooth-models/arch_lower_aligned.ply&#x27;</span>,<span class="keyword">function</span> (<span class="params">loadedMesh</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="number">0x7777ff</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(loadedMesh, material);</span><br><span class="line"></span><br><span class="line">    group.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.1</span>,<span class="number">0.1</span>,<span class="number">0.1</span>);</span><br><span class="line">    <span class="title function_">setModelPosition</span>(group);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(group);</span><br><span class="line">    scene.<span class="title function_">add</span>(group);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>案列完整代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>)&#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRender</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">var</span> light;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x444444</span>));</span><br><span class="line"></span><br><span class="line">    light = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointLight</span>(<span class="number">0xffffff</span>);</span><br><span class="line">    light.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//告诉平行光需要开启阴影投射</span></span><br><span class="line">    light.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    scene.<span class="title function_">add</span>(light);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模型强制居中处理</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setModelPosition</span>(<span class="params">object</span>) &#123;</span><br><span class="line">    object.<span class="title function_">updateMatrixWorld</span>();</span><br><span class="line">    <span class="comment">// 获得包围盒得min和max</span></span><br><span class="line">    <span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Box3</span>().<span class="title function_">setFromObject</span>(object);</span><br><span class="line">    <span class="comment">// 返回包围盒的宽度，高度，和深度</span></span><br><span class="line">    <span class="keyword">const</span> boxSize = box.<span class="title function_">getSize</span>();</span><br><span class="line">    <span class="comment">// 返回包围盒的中心点</span></span><br><span class="line">    <span class="keyword">const</span> center = box.<span class="title function_">getCenter</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>());</span><br><span class="line">    object.<span class="property">position</span>.<span class="property">x</span> += object.<span class="property">position</span>.<span class="property">x</span> - center.<span class="property">x</span>;</span><br><span class="line">    object.<span class="property">position</span>.<span class="property">y</span> += object.<span class="property">position</span>.<span class="property">y</span> - center.<span class="property">y</span>;</span><br><span class="line">    object.<span class="property">position</span>.<span class="property">z</span> += object.<span class="property">position</span>.<span class="property">z</span> - center.<span class="property">z</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModel</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    <span class="keyword">var</span> helper = <span class="keyword">new</span> <span class="variable constant_">THREE</span> .<span class="title class_">AxesHelper</span>();</span><br><span class="line">    scene.<span class="title function_">add</span>(helper);</span><br><span class="line">    <span class="comment">//从外部加载PLY格式文件</span></span><br><span class="line">    <span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PLYLoader</span>();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&#x27;tooth-models/arch_lower_aligned.ply&#x27;</span>,<span class="keyword">function</span> (<span class="params">loadedMesh</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="number">0x7777ff</span>,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(loadedMesh, material);</span><br><span class="line">        <span class="title function_">setModelPosition</span>(group);</span><br><span class="line">        group.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.1</span>,<span class="number">0.1</span>,<span class="number">0.1</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(group);</span><br><span class="line">        scene.<span class="title function_">add</span>(group);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats =<span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initRender</span>();</span><br><span class="line">    <span class="title function_">initModel</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注: 牙齿模型位置有问题（已通过手动修改模型位置解决）、<strong>牙齿材质问题（学习完材质之后解决</strong>）、移除模型问题（通过移除最后一个添加到场景的对象）</p>
<h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><ol>
<li>JSON文件加载问题：文件加载不出</li>
<li>ply文件加载问题：模型的材质无法正确加载。（ply格式中rgb颜色附加到顶点信息中无法正确编写代码）；</li>
</ol>
<p><img src="/images/1668668784398-0c73e8ce-3dd4-4b23-8559-96e246c7e21f.png"><br>可以自定义材质，但是无法正确加载原模型的材质颜色</p>
<ol start="3">
<li>obj格式模型完整加载：mtl文件中保存了material信息，obj文件中保存了geometry信息</li>
</ol>
<p><img src="/images/1668668577554-a03bcc0d-6f8d-4ff3-88dd-81a058ed0de7.png"></p>
<h1 id="光源"><a href="#光源" class="headerlink" title="光源"></a>光源</h1><p>💡没有光源，渲染的场景将不可见（除非使用基础材质或线框材质）</p>
<h2 id="不同种类的光源"><a href="#不同种类的光源" class="headerlink" title="不同种类的光源"></a>不同种类的光源</h2><table>
<thead>
<tr>
<th></th>
<th>名字</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>简单基础光源</td>
<td>THREE.AmbientLight</td>
<td>基础光源。该光源的颜色会叠加到场景现有物体的颜色上</td>
</tr>
<tr>
<td></td>
<td>THREE.PointLight</td>
<td>点光源，从空间的一点向所有方向发射光线。点光源能用来创建阴影</td>
</tr>
<tr>
<td></td>
<td>THREE.SpotLight</td>
<td>有聚光效果，类似台灯、手电筒。该光源可以投射阴影</td>
</tr>
<tr>
<td></td>
<td>THREE.DirectionalLight</td>
<td>无限光，光线可以看作是平行线，就像太阳光。可以用来创建阴影</td>
</tr>
<tr>
<td>特殊</td>
<td>THREE.HemisphereLight</td>
<td>特殊光源，可以通过模拟反光面和光线微弱的天空来创建更加自然的室外光线。无阴影</td>
</tr>
<tr>
<td></td>
<td>THREE.AreaLight</td>
<td>使用这种光源可以指定散发光线的平面，而不是一个点。无阴影</td>
</tr>
<tr>
<td></td>
<td>THREE.lensFlare</td>
<td>这不是一种光源。可以为场景中的光源增加镜头光晕效果</td>
</tr>
</tbody></table>
<h2 id="THREE-AmbientLight"><a href="#THREE-AmbientLight" class="headerlink" title="THREE.AmbientLight"></a>THREE.AmbientLight</h2><h3 id="作用描述："><a href="#作用描述：" class="headerlink" title="作用描述："></a>作用描述：</h3><ol>
<li>颜色会应用到全局</li>
<li>光源没有特别的来源方向</li>
<li>不会产生阴影，会将所有物体渲染为相同的颜色</li>
<li>最好在使用其他光源的同时使用它，目的是弱化阴影，或给场景添加一些额外的颜色</li>
</ol>
<h3 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h3><ol>
<li>使用这种光源时，用色应该尽量保守。如果指定的颜色过于明亮，会发现画面的颜色过于饱和。</li>
<li>除了颜色之外，还可以设置强度值。</li>
</ol>
<h3 id="创建THREE-AmbientLight光源"><a href="#创建THREE-AmbientLight光源" class="headerlink" title="创建THREE.AmbientLight光源"></a>创建THREE.AmbientLight光源</h3><ol>
<li>首先添加实例化THREE.AmbientLight对象</li>
</ol>
<p>var ambientLight &#x3D; new THREE.AmbientLight(“#606008”);</p>
<ol start="2">
<li>将对象添加到场景</li>
</ol>
<p>scene.add(ambientLight);</p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="结果："><a href="#结果：" class="headerlink" title="结果："></a>结果：</h4><h4 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera = <span class="title function_">initCamera</span>();</span><br><span class="line"><span class="comment">// function initCamera() &#123;</span></span><br><span class="line"><span class="comment">//     camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1,1000);</span></span><br><span class="line"><span class="comment">//     camera.position.set(30, 30, 30);</span></span><br><span class="line"><span class="comment">//     camera.lookAt(new THREE.Vector3(0, 0, 0));</span></span><br><span class="line"><span class="comment">//     scene.add(camera);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRender</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xffffff</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//灯光</span></span><br><span class="line"><span class="keyword">var</span> ambientLight;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initAmbientLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0xffffff</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//点光源</span></span><br><span class="line"><span class="keyword">var</span> spotLight;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initSpotLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="number">0xffffff</span>, <span class="number">1</span>, <span class="number">180</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">4</span>);</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="title function_">set</span>(<span class="number">2048</span>,<span class="number">2048</span>);</span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>);</span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line">    controls = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">intensity</span> = ambientLight.<span class="property">intensity</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ambientColor</span> = ambientLight.<span class="property">color</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">disableSpotlight</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">add</span>(controls, <span class="string">&#x27;intensity&#x27;</span>, <span class="number">0</span>, <span class="number">3</span>,<span class="number">0.1</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        ambientLight.<span class="property">color</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(controls.<span class="property">ambientColor</span>);</span><br><span class="line">        ambientLight.<span class="property">intensity</span> = controls.<span class="property">intensity</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="title function_">addColor</span>(controls,<span class="string">&#x27;ambientColor&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        spotLight.<span class="property">color</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(controls.<span class="property">ambientColor</span>);</span><br><span class="line">        spotLight.<span class="property">intensity</span> = controls.<span class="property">intensity</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;disableSpotlight&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        spotLight.<span class="property">visible</span> = !e;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls2;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls2</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>(camera, renderer);<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls2.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls2.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls2.<span class="property">autoRotate</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls2.<span class="property">minDistance</span> = <span class="number">50</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls2.<span class="property">maxDistance</span> = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls2.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="property">update</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//页面窗口响应式布局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnchange</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initControls2</span>();</span><br><span class="line">    <span class="title function_">initRender</span>();</span><br><span class="line">    <span class="title function_">initAmbientLight</span>();</span><br><span class="line">    <span class="title function_">initSpotLight</span>();</span><br><span class="line">    <span class="title function_">addHouseAndTree</span>(scene)</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnchange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="THREE-SpotLight"><a href="#THREE-SpotLight" class="headerlink" title="THREE.SpotLight"></a>THREE.SpotLight</h2><p>作用描述</p>
<ol>
<li>聚光灯光源，从特定的一点以锥形发射光线</li>
<li>该光源产生的光具有方向和角度</li>
<li>THREE.SpotLight所有属性<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>angle（角度）</strong></td>
<td>光源发射出的光束的宽度，单位是弧度，默认值为Math.PI&#x2F;3</td>
</tr>
<tr>
<td><strong>castShadow（投影）</strong></td>
<td>如果设置为true，这个光源就会生成阴影</td>
</tr>
<tr>
<td><strong>color（颜色）</strong></td>
<td>光源颜色</td>
</tr>
<tr>
<td><strong>decay（衰减）</strong></td>
<td>光源强度随着离开光源的距离而衰减的速度。该值为2时更接近现实世界中的效果，默认值为1。只有当WebGLReader的属性physicallyCorrectLights（物理正确光源）被设置为启用时，decay属性才有效</td>
</tr>
<tr>
<td><strong>distance（距离）</strong></td>
<td>光源照射的距离。默认值为0，这意味着光线强度不会随着距离的增加而减弱。</td>
</tr>
<tr>
<td><strong>intensity（强度）</strong></td>
<td>光源照射的强度。默认值为1</td>
</tr>
<tr>
<td><strong>penumbra（半影区）</strong></td>
<td>该属性设置聚光灯的锥形照明区域在其区域边缘附近的平滑衰减速度。取值范围在0到1之间，默认值为0</td>
</tr>
<tr>
<td><strong>position（位置）</strong></td>
<td>光源在场景中的位置</td>
</tr>
<tr>
<td><strong>power（功率）</strong></td>
<td>当物理正确模式启用时（WebGLReader的属性physicallyCorrectLights被设置为启用时），该属性指定光源的功率，以流明为单位，默认值为4*Math.PI</td>
</tr>
<tr>
<td><strong>target（目标）</strong></td>
<td>使用THREE.SpotLight光源时，它的指向很重要。使用target属性，可以将THREE.SpotLight光源指向场景中的特定对象或特定位置。注意，此属性需要一个THREE.Object3D对象（如THREE.Mesh）</td>
</tr>
<tr>
<td><strong>visible（是否可见）</strong></td>
<td>光源是否可见。如果属性设置为true，该光源就会打开；如果设置为false，光源就会关闭</td>
</tr>
</tbody></table>
</li>
</ol>
<p>当THREE.SpotLight的shadow属性为enable时，可以用以下属性调节阴影特性</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>shadow.bias（阴影偏移）</strong></td>
<td>用来偏置阴影的位置。当用非常薄的对象时，可以使用它来解决一些奇怪的效果。如果看到一些奇怪的阴影效果，可以将该属性设置为很小的值（比如0.01）通常可以解决问题。默认值为0</td>
</tr>
<tr>
<td><strong>shadow.camera.far（投影远点）</strong></td>
<td>到距离光源的哪一个位置可以生成阴影。默认值为5000.</td>
</tr>
<tr>
<td><strong>shadow.camera.fov（投影视场）</strong></td>
<td>用于生成阴影的视场大小。默认值为50</td>
</tr>
<tr>
<td><strong>shadow.camera.near（投影近点）</strong></td>
<td>从距离光源的哪一个位置开始生成阴影。默认值为50</td>
</tr>
<tr>
<td><strong>shadow.mapSize.width和<strong><strong>shadow.mapSize.height</strong></strong>（阴影映射宽度和阴影映射高度）</strong></td>
<td>决定了有多少像素用来生成阴影。当阴影具有锯齿状边缘或看起来不光滑时，可以增加这个值。在场景渲染之后无法更改。两者的默认值均为512</td>
</tr>
<tr>
<td><strong>shadow.radius（半径）</strong></td>
<td>当该值大于1时，阴影的边缘将有平滑效果。该属性在THREE.WebGLRenderer的shadowMap.type属性为THREE.BasicShadowMap时无效。</td>
</tr>
</tbody></table>
<p>案列结果代码</p>
<h2 id="THREE-PointLight"><a href="#THREE-PointLight" class="headerlink" title="THREE.PointLight"></a>THREE.PointLight</h2><ol>
<li>点光源是一种单点发光，照射所有方向的光源。</li>
<li>点光源可以像聚光灯一样启用阴影并设置其属性<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>color（颜色）</strong></td>
<td>光源颜色</td>
</tr>
<tr>
<td><strong>distance（距离）</strong></td>
<td>光源照射的距离。默认值为0，这意味着光的强度不会随着距离增加而减少</td>
</tr>
<tr>
<td><strong>intensity（强度）</strong></td>
<td>光源照射的强度。默认值为1</td>
</tr>
<tr>
<td><strong>position（位置）</strong></td>
<td>光源在场景中的位置</td>
</tr>
<tr>
<td><strong>visible（是否可见）</strong></td>
<td>该属性设置为true，光源就会打开，false——关闭</td>
</tr>
<tr>
<td><strong>decay（衰减）</strong></td>
<td>光源强度随着离开光源的距离而衰减的速度。该值为2时更接近现实世界中的效果，默认值为1。只有当WebGLReader的属性physicallyCorrectLights（物理正确光源）被设置为启用时，decay属性才有效</td>
</tr>
<tr>
<td><strong>power（功率）</strong></td>
<td>当物理正确模式启用时（WebGLReader的属性physicallyCorrectLights被设置为启用时），该属性指定光源的功率，以流明为单位，默认值为4*Math.PI</td>
</tr>
</tbody></table>
</li>
</ol>
<p>案例结果代码</p>
<h2 id="THREE-DirectionalLight"><a href="#THREE-DirectionalLight" class="headerlink" title="THREE.DirectionalLight"></a>THREE.DirectionalLight</h2><ol>
<li>平行光，发出的所有光线都是互相平行的</li>
<li>平行光的一个范例就是太阳光</li>
<li>被平行光照亮的物体的整个区域接收到的光强是一样的</li>
</ol>
<p>案例结果代码</p>
<h2 id="THREE-HemisphereLight"><a href="#THREE-HemisphereLight" class="headerlink" title="THREE.HemisphereLight"></a>THREE.HemisphereLight</h2><ol>
<li><p>可以创建出更贴近自然的户外光照效果</p>
</li>
<li><p>创建一个半球光光源</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hemisphereLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">HemisphereLight</span>(<span class="number">0xffffff</span>,<span class="number">0x00ff00</span>,<span class="number">0.6</span>);</span><br><span class="line">hemisphereLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">500</span>,<span class="number">0</span>);</span><br><span class="line">scene.<span class="title function_">add</span>(hemisphereLight);</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>groundColor</strong></td>
<td>从地面发出的光线的颜色</td>
</tr>
<tr>
<td><strong>color</strong></td>
<td>从天空发出的光线的颜色</td>
</tr>
<tr>
<td><strong>intensity</strong></td>
<td>光线照射的强度</td>
</tr>
</tbody></table>
</li>
</ol>
<p>案例结果代码</p>
<h2 id="THREE-AreaLight"><a href="#THREE-AreaLight" class="headerlink" title="THREE.AreaLight"></a>THREE.AreaLight</h2><ol>
<li><p>使用THREE.AreaLight光源，可以定义一个长方形的发光区域</p>
</li>
<li><p>使用THREE.AreaLight光源，需要现在HTML中导入库RectAreaLightUniformsLib.js</p>
</li>
<li><p>添加THREE.AreaLight光源</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//光源颜色为0xffffff,光强为500，宽为4，高为10</span></span><br><span class="line"><span class="keyword">var</span> areaLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AreaLight</span>(<span class="number">0xffffff</span>,<span class="number">500</span>,<span class="number">4</span>,<span class="number">10</span>);</span><br><span class="line">areaLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">20</span>,<span class="number">30</span>);</span><br><span class="line">scene.<span class="title function_">add</span>(areaLight);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在创建THREE.AreaLight光源时，创建出一个垂直平面</p>
</li>
<li><p>不能看到光源本身，只能看到光源发射出的光，而且只有当光照射到某个物体上时才能看见。可以在光源位置增加平面对象来模拟光线照射区域。</p>
</li>
</ol>
<p>案例结果代码</p>
<h2 id="镜头光晕（Lens-Flare）"><a href="#镜头光晕（Lens-Flare）" class="headerlink" title="镜头光晕（Lens Flare）"></a>镜头光晕（Lens Flare）</h2><ol>
<li>对于游戏和三维图像来说，可以更具真实感</li>
<li>THREE.LensFlare对象接受如下参数</li>
</ol>
<p>flare &#x3D; new THREE.LensFlare(texture,size,distance,blending,color,opacity);</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>texture（纹理）</td>
<td>纹理——图片，用来决定光晕的形状</td>
</tr>
<tr>
<td>size（尺寸）</td>
<td>可以指定光晕大小，单位是像素。如果设置为-1，将使用纹理本身的大小</td>
</tr>
<tr>
<td>distance（距离）</td>
<td>从光源（0）到摄像机（1）的距离。使用这个参数将镜头光晕放置正确的位置</td>
</tr>
<tr>
<td>blending（混合）</td>
<td>可以为光晕提供多种材质，混合模式决定了它们如何混合在一起。默认混合方式是THREE.AdditiveBlending</td>
</tr>
<tr>
<td>color（颜色）</td>
<td>光晕的颜色</td>
</tr>
<tr>
<td>opacity（不透明度）</td>
<td>定义光晕的不透明度，0完全透明，1完全不透明</td>
</tr>
</tbody></table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载一个纹理</span></span><br><span class="line"><span class="keyword">var</span> textureFlare0 = <span class="variable constant_">THREE</span>.<span class="property">ImageUtils</span>.<span class="title function_">loadTexture</span>(<span class="string">&quot;../../..&quot;</span>);</span><br><span class="line"><span class="comment">//定义镜头光晕颜色</span></span><br><span class="line"><span class="keyword">var</span> flareColor = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xffffff</span>);</span><br><span class="line"><span class="comment">//创建THREE.LensFlare对象</span></span><br><span class="line"><span class="keyword">var</span> lensFlare = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LensFlare</span>(textureFlare0,<span class="number">350</span>,<span class="number">0.0</span>,<span class="variable constant_">THREE</span>.<span class="property">AdditiveBlending</span>,flareColor);</span><br><span class="line"><span class="comment">//设置镜头光晕的位置</span></span><br><span class="line">lensFlare.<span class="property">position</span>.<span class="title function_">copy</span>(spotLight.<span class="property">position</span>);</span><br><span class="line"><span class="comment">//添加至场景中</span></span><br><span class="line">scene.<span class="title function_">add</span>(lensFlare);</span><br><span class="line"></span><br><span class="line"><span class="comment">//加载纹理</span></span><br><span class="line"><span class="keyword">var</span> textureFlare3 = <span class="variable constant_">THREE</span>.<span class="property">ImageUtils</span>.<span class="title function_">loadTexture</span>(<span class="string">&quot;../../..&quot;</span>);</span><br><span class="line"><span class="comment">//用THREE.LensFlare的add方法添加纹理，尺寸，距离，混合模式</span></span><br><span class="line">lensFlare.<span class="title function_">add</span>(textureFlare3,<span class="number">60</span>,<span class="number">0.6</span>,<span class="variable constant_">THREE</span>.<span class="property">AdditiveBlending</span>);</span><br></pre></td></tr></table></figure>
<p>案例结果代码</p>
<h1 id="材质（texture）"><a href="#材质（texture）" class="headerlink" title="材质（texture）"></a>材质（texture）</h1><h2 id="所有材质："><a href="#所有材质：" class="headerlink" title="所有材质："></a>所有材质：</h2><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>MeshBasicMaterial（网格基础材质）</strong></td>
<td>基础材质，用于给几何体赋予一种简单的颜色，或者显示几何体的线框</td>
</tr>
<tr>
<td><strong>MeshDepthMaterial（网格深度材质）</strong></td>
<td>这个材质的使用从摄像机到网格的距离来决定如何给网格上色</td>
</tr>
<tr>
<td><strong>MeshNormalMaterial（网格法向材质）</strong></td>
<td>使用法向向量计算物体的表面颜色</td>
</tr>
<tr>
<td><strong>MeshLambertMaterial（网格Lambert材质）</strong></td>
<td>这是一种考虑光照影响的材质，用于创建暗淡，不光亮的物体</td>
</tr>
<tr>
<td><strong>MeshPhongMaterial（网格Phong材质）</strong></td>
<td>这是一种考虑光照影响的材质，用于创建光亮的物体</td>
</tr>
<tr>
<td><strong>MeshStandardMaterial（网格标准材质）</strong></td>
<td>这种标准材质采用“基于物理的渲染（PBR）”算法来绘制物体表面。能计算出表面与光线的正确互动关系，从而使渲染出来的物体更真实。</td>
</tr>
<tr>
<td><strong>MeshPhysicalMaterial（网格物理材质）</strong></td>
<td>这是MeshStandardMaterial（网格标准材质）的扩展材质，为光线反射计算模型提供了更多的控制</td>
</tr>
<tr>
<td><strong>MeshToonMaterial（网格卡通材质）</strong></td>
<td>这是MeshPhongMaterial（网格Phong材质）的扩展材质，使得物体渲染卡通化</td>
</tr>
<tr>
<td><strong>ShadowMaterial（阴影材质）</strong></td>
<td>专门用于接收用于阴影图的特殊材质。在该材质中只有阴影图像，非阴影部分为完全透明的区域</td>
</tr>
<tr>
<td><strong>shaderMaterial（着色器材质）</strong></td>
<td>允许使用自定义的着色器程序，直接控制顶点的放置位置和像素的着色方式</td>
</tr>
<tr>
<td><strong>LineBasicMaterial（直线基础材质）</strong></td>
<td>用于THREE.line（直线）几何体，用于创建着色的直线</td>
</tr>
<tr>
<td><strong>LineDashMaterial（虚线材质）</strong></td>
<td>这种材质和LineBasicMaterial（直线基础材质）一样，但是允许创建一种虚线的效果。</td>
</tr>
</tbody></table>
<h2 id="材质的共有属性"><a href="#材质的共有属性" class="headerlink" title="材质的共有属性"></a>材质的共有属性</h2><h3 id="基础属性"><a href="#基础属性" class="headerlink" title="基础属性"></a>基础属性</h3><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>id（标识符）</strong></td>
<td>用于识别材质，并在创建材质时赋值。从0开始往上增加</td>
</tr>
<tr>
<td><strong>uuid（通用唯一识别符）</strong></td>
<td>这是生成的唯一ID，在内部使用</td>
</tr>
<tr>
<td><strong>name（名称）</strong></td>
<td>可以通过这个属性赋予材质名称，用于调试的目的</td>
</tr>
<tr>
<td><strong>opacity（不透明度）</strong></td>
<td>定义物体的透明度。与transparent属性一起使用。该属性的赋值范围从0到1</td>
</tr>
<tr>
<td><strong>transparent（是否透明）</strong></td>
<td>如果设置为true，Three.js会使用指定的不透明度渲染物体，如果设置为false，这个物体就不透明。如果使用alpha（透明度）通道的纹理，这个值应该设置为true。</td>
</tr>
<tr>
<td><strong>overdraw（过度描绘）</strong></td>
<td>当使用THREE.CanvasRender时，多边形会被渲染的稍微大一点。当这个渲染器渲染的物体有间隙时，可以将这个属性设置为true。</td>
</tr>
<tr>
<td><strong>visible（是否可见）</strong></td>
<td>定义该材质是否可见。如果设置为false，该物体在场景中就不可见</td>
</tr>
<tr>
<td><strong>side（侧面）</strong></td>
<td>可以定义哪一面应用材质。默认值是THREE.FontSide（前面）。</td>
</tr>
<tr>
<td><strong>needsUpdate（是否更新）</strong></td>
<td>对于材质的某些修改，是否告诉THREE.js材质已经改变，如果设置为true，Three.js会使用新的材质属性更新它的缓存</td>
</tr>
<tr>
<td><strong>colorWrite（是否输出颜色）</strong></td>
<td>如果属性值设置为false，则具有该材质的物体不会被真正的绘制到场景中，实际效果是该物体本身是不可见的，但其他物体被它挡住的部分也不可见</td>
</tr>
<tr>
<td><strong>flatShading（平面着色）</strong></td>
<td>该属性控制物体表面法线的生成方式，从而影响光线效果。属性值为true时，在两个相邻但不共面的三角形之间，光照会因为生硬过度而产生棱角，为false时则会产生平滑的过度效果。</td>
</tr>
<tr>
<td><strong>lights</strong></td>
<td>该属性值为布尔值。控制物体表面是否接受光照。默认值为true</td>
</tr>
<tr>
<td><strong>premultipliedAlpha（预计算Alpha混合）</strong></td>
<td>该属性控制半透明表面的混合方式。默认值为false</td>
</tr>
<tr>
<td><strong>dithering（抖动）</strong></td>
<td>该属性控制是否启用颜色抖动模式，在一定程度上可以减轻颜色不均的问题。默认值为false</td>
</tr>
<tr>
<td><strong>shadowSide（投影面）</strong></td>
<td>控制哪个面会投射阴影。默认值为null。当属性值为null时。投射阴影的面按照如下原则推定：当side为THREE.FrontSide时，side为后面；当side为THREE.BackSide时，side为前面当side为THREE.DoubleSide时，side为前面双侧</td>
</tr>
<tr>
<td><strong>vertexColors（顶点颜色）</strong></td>
<td>可以为物体的每一个顶点指定特有的颜色。默认值是THREE.NoColors。如果设置属性值为THREE.VertexColors，则渲染时将使用THREE.Face3 vertexColors数组指定的颜色，为每一个顶点设定颜色。如果该属性值为THREE.FaceColors，则会使用每一个面自己的颜色属性来设定面的颜色。CanvasRenderer不支持该属性，但WebGLRenderer能够支持</td>
</tr>
<tr>
<td><strong>fog（雾）</strong></td>
<td>控制材质是否受雾的影响</td>
</tr>
</tbody></table>
<h3 id="融合属性"><a href="#融合属性" class="headerlink" title="融合属性"></a>融合属性</h3><ul>
<li>融合属性决定了我们渲染的颜色如何与它们后面的颜色交互<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>blending（融合）</strong></td>
<td>该属性决定了物体上的材质如何与背景融合。一般的融合模式是THREE.NormalBlending，在这种模式下只显示材质的上层</td>
</tr>
<tr>
<td><strong>blendSrc（融合源）</strong></td>
<td>除了标准融合模式之外，还可以通过设置blendSrc、blendDst和blendEquation来创建自定义的融合模式。这个属性定义了物体（源）如何与背景（目标）相融合。默认值为THREE.SrcAlphaFactor，即使用alpha（透明度通道）进行融合。</td>
</tr>
<tr>
<td><strong>blendSrcAlpha（融合源透明度）</strong></td>
<td>该属性为blendSrc指定透明度，默认值为null</td>
</tr>
<tr>
<td><strong>blendDst（融合目标）</strong></td>
<td>定义了融合时如何使用背景（目标），默认值为THREE.OneMinusSrcAlphaFactor，其含义是目标也使用源的alpha通道进行融合，只是使用的值是1（源的alpha通道值）</td>
</tr>
<tr>
<td><strong>blendDstAlpha（融合目标透明度）</strong></td>
<td>该属性为blendDst指定透明度，默认值为null</td>
</tr>
<tr>
<td><strong>blendEquation（融合公式）</strong></td>
<td>定义如何使用不blendSrc和blendDst的值。默认值为使它们相加（AddEquation）。</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="高级属性"><a href="#高级属性" class="headerlink" title="高级属性"></a>高级属性</h3><h2 id="THREE-MeshBasicMaterial"><a href="#THREE-MeshBasicMaterial" class="headerlink" title="THREE.MeshBasicMaterial"></a>THREE.MeshBasicMaterial</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ol>
<li>一种简单的材质，不考虑场景中光照的影响</li>
<li>使用这种材质网格会被渲染成简单的平面多边形</li>
<li>可以显示几何体的线框</li>
</ol>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>color（颜色）</td>
<td>设置材质的颜色</td>
</tr>
<tr>
<td>wireframe（线框）</td>
<td>设置这个属性可以将材质渲染成线框，适用于调试</td>
</tr>
<tr>
<td>wireframeLinewidth（线框线宽）</td>
<td>如果打开了wireframe，这个属性定义线框中线的宽度</td>
</tr>
<tr>
<td>wireframeLinecap（线框线段端点）</td>
<td>这个属性定义了线框模式下顶点间线段的端点如何显示。可选的值包括butt（平）、round（圆）和square（方）。默认值是round。在实际使用中，这个属性的修改结果很难看出来。WebGLRenderer对象不支持该属性。</td>
</tr>
<tr>
<td>wireframeLinejoin（线框线段连接点）</td>
<td>定义了线段连接点如何显示。可选的值有round（圆）、bevel（斜角）、miter（尖角）。默认值为round。WebGLRenderer对象不支持该属性。</td>
</tr>
</tbody></table>
<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">20</span>,<span class="number">50</span>,<span class="number">40</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> webGLRenderer,canvasRenderer,renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    webGLRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    webGLRenderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    webGLRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    webGLRenderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    canvasRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CanvasRenderer</span>();</span><br><span class="line">    canvasRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line"></span><br><span class="line">    renderer = webGLRenderer;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x0c0c0c</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">40</span>,<span class="number">60</span>,-<span class="number">10</span>);</span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1024</span>,<span class="number">1024</span>);</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">130</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">40</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模型</span></span><br><span class="line"><span class="keyword">var</span> axes,cube,plane,meshMaterial,sphere,ground,selectedMesh;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    axes = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(axes);</span><br><span class="line">    <span class="comment">//材质</span></span><br><span class="line">    meshMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x7777ff</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;Basic Material&quot;</span>,</span><br><span class="line">        <span class="attr">flatShading</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//地面</span></span><br><span class="line">    <span class="keyword">var</span> groundGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> groundMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x777777</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    ground = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(groundGeometry,groundMaterial);</span><br><span class="line">    ground.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">    ground.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">20</span>;</span><br><span class="line">    ground.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(ground);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//立方体</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>);</span><br><span class="line">    cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,meshMaterial);</span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//球</span></span><br><span class="line">    <span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">14</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">    sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphereGeometry,meshMaterial);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    sphere.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// scene.add(sphere);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//平面</span></span><br><span class="line">    <span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">14</span>,<span class="number">14</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,meshMaterial);</span><br><span class="line">    plane.<span class="property">position</span> = sphere.<span class="property">position</span>;</span><br><span class="line"></span><br><span class="line">    selectedMesh = cube;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    selectedMesh.<span class="property">rotation</span>.<span class="property">y</span> +=<span class="number">0.02</span>;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口响应式布局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MBM</span>,<span class="title class_">MaterialGui</span>,gui;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMBM</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MBM</span> = cube.<span class="property">material</span>;</span><br><span class="line">    <span class="variable constant_">MBM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = cube.<span class="property">id</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">uuid</span> = cube.<span class="property">uuid</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;Basic Material&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">opacity</span> = meshMaterial.<span class="property">opacity</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">transparent</span> = meshMaterial.<span class="property">transparent</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">overdraw</span> = meshMaterial.<span class="property">overdraw</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">visible</span> = meshMaterial.<span class="property">visible</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">side</span> = <span class="string">&quot;FrontSide&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">colorWrite</span> = meshMaterial.<span class="property">colorWrite</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">flatShading</span> = meshMaterial.<span class="property">flatShading</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">premultipliedAlpha</span> = meshMaterial.<span class="property">premultipliedAlpha</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dithering</span> = meshMaterial.<span class="property">dithering</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">shadowSide</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vertexColors</span> = <span class="string">&quot;NoColors&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fog</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = meshMaterial.<span class="property">color</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframe</span> = meshMaterial.<span class="property">wireframe</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframeLinewidth</span> = <span class="number">6.9</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframeLinecap</span> = <span class="string">&quot;round&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframeLinejoin</span> = <span class="string">&quot;round&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">switchRenderer</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (renderer <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">WebGLRenderer</span>) &#123;</span><br><span class="line">                renderer = canvasRenderer;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                renderer = webGLRenderer;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedMesh</span> = <span class="string">&quot;cube&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    <span class="title class_">MaterialGui</span> = gui.<span class="title function_">addFolder</span>(<span class="string">&quot;THREE.Material&quot;</span>);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;uuid&#x27;</span>);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;opacity&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">opacity</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;transparent&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">transparent</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;overdraw&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">overdraw</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;visible&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">visible</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;side&#x27;</span>,&#123;<span class="title class_">FrontSide</span>:<span class="number">0</span>,<span class="title class_">BackSide</span>:<span class="number">1</span>,<span class="title class_">BothSides</span>:<span class="number">2</span>&#125;).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">side</span> = <span class="built_in">parseInt</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;colorWrite&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">colorWrite</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;flatShading&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">flatShading</span> = e;</span><br><span class="line">        meshMaterial.<span class="property">needsUpdate</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;premultipliedAlpha&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">premultipliedAlpha</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;dithering&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">dithering</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;shadowSide&#x27;</span>,&#123;<span class="title class_">FrontSide</span>:<span class="number">0</span>,<span class="title class_">BackSide</span>:<span class="number">1</span>,<span class="title class_">BothSide</span>:<span class="number">2</span>&#125;).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">       meshMaterial.<span class="property">shadowSide</span> = <span class="built_in">parseInt</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;vertexColors&#x27;</span>, &#123;<span class="title class_">NoColors</span>: <span class="variable constant_">THREE</span>.<span class="property">NoColors</span>, <span class="title class_">FaceColors</span>: <span class="variable constant_">THREE</span>.<span class="property">FaceColors</span>,</span><br><span class="line">        <span class="title class_">VertexColors</span>: <span class="variable constant_">THREE</span>.<span class="property">VertexColors</span>&#125;).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">vertexColors</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">vertexColors</span> = <span class="built_in">parseInt</span>(vertexColors);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MaterialGui</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;fog&#x27;</span>);</span><br><span class="line">    <span class="comment">//THREE.MeshBasicMaterialGUI</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">MeshBasicMaterialGUI</span> = gui.<span class="title function_">addFolder</span>(<span class="string">&quot;THREE.MeshBasicMaterial&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MeshBasicMaterialGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;color&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">color</span>.<span class="title function_">getStyle</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MeshBasicMaterialGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;wireframe&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframe</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MeshBasicMaterialGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;wireframeLinewidth&#x27;</span>,<span class="number">0</span>,<span class="number">20</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframeLinewidth</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MeshBasicMaterialGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;wireframeLinecap&#x27;</span>,[<span class="string">&#x27;butt&#x27;</span>,<span class="string">&#x27;round&#x27;</span>,<span class="string">&#x27;square&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframeLinecap</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">MeshBasicMaterialGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;wireframeLinejoin&#x27;</span>,[<span class="string">&#x27;round&#x27;</span>,<span class="string">&#x27;bevel&#x27;</span>,<span class="string">&#x27;miter&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframeLinejoin</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;switchRenderer&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;selectedMesh&#x27;</span>,[<span class="string">&#x27;cube&#x27;</span>,<span class="string">&#x27;sphere&#x27;</span>,<span class="string">&#x27;plane&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        scene.<span class="title function_">remove</span>(cube);</span><br><span class="line">        scene.<span class="title function_">remove</span>(sphere);</span><br><span class="line">        scene.<span class="title function_">remove</span>(plane);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (e)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;cube&#x27;</span>:</span><br><span class="line">                scene.<span class="title function_">add</span>(cube);</span><br><span class="line">                selectedMesh = cube;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;sphere&#x27;</span>:</span><br><span class="line">                scene.<span class="title function_">add</span>(sphere);</span><br><span class="line">                selectedMesh = sphere;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;plane&#x27;</span>:</span><br><span class="line">                scene.<span class="title function_">add</span>(plane);</span><br><span class="line">                selectedMesh = plane;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initModels</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initMBM</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>💡这个例子里可以设置side属性，通过这个属性可以指定THREE.Geometry对象的哪个面应用材质。可以通过选择plane(平面)网格验证该属性。side属性设置为FrontSide或者BackSide时，平面旋转时会有一半的时间看不见。side属性设置为BothSides时，这个平面始终都能看见（因为几何体两面都有材质）。设置为BothSides时，由于两面都有材质，所以渲染需要做更多的工作，对场景的性能会有影响。</p>
<h2 id="THREE-MeshDepthMaterial"><a href="#THREE-MeshDepthMaterial" class="headerlink" title="THREE.MeshDepthMaterial"></a>THREE.MeshDepthMaterial</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><ol>
<li>这个材质使用摄像机到网格的距离来决定如何给网格上色</li>
<li>可以将这种材质和其他材质结合，容易创建出逐渐消失的效果。</li>
<li>这种材质只有两个控制线框显示的属性</li>
</ol>
<h3 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>wireframe</td>
<td>该属性指定是否显示线框</td>
</tr>
<tr>
<td>wireframeLineWidth</td>
<td>该属性指定线框的宽度（这个属性支队THREE.CanvasRenderer有效）</td>
</tr>
</tbody></table>
<h3 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h3><p>描述：用THREE.MeshDepthMaterial材质渲染方块，基于摄像机的距离上色，点击addCube添加方块、removeCube移除方块（从最后一个添加进场景的方块开始移除）、自定义方块旋转速度、控制摄像机的近面距离和远面距离。</p>
<h4 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">    <span class="comment">//overrideMaterial设置所有物体材质的属性</span></span><br><span class="line">    scene.<span class="property">overrideMaterial</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshDepthMaterial</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">50</span>,<span class="number">110</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">50</span>,<span class="number">40</span>,<span class="number">50</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化性能</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>) &#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口响应式布局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MDM</span>,gui,rotationSpeed;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initGUI</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MDM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rotationSpeed</span> = <span class="number">0.02</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cameraNear</span> = camera.<span class="property">near</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cameraFar</span> = camera.<span class="property">far</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">removeCube</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> allChildren = scene.<span class="property">children</span>;</span><br><span class="line">            <span class="keyword">var</span> lastChild = allChildren[allChildren.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(lastChild <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">Mesh</span>)&#123;</span><br><span class="line">                scene.<span class="title function_">remove</span>(lastChild);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">addCube</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> cubeSize = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="number">3</span>+(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">3</span>));</span><br><span class="line">            <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(cubeSize,cubeSize,cubeSize);</span><br><span class="line">            <span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">                <span class="attr">color</span>:<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">0xffffff</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">var</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,cubeMaterial);</span><br><span class="line">            cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">            cube.<span class="property">position</span>.<span class="property">x</span> = -<span class="number">60</span>+<span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">100</span>));</span><br><span class="line">            cube.<span class="property">position</span>.<span class="property">y</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">10</span>));</span><br><span class="line">            cube.<span class="property">position</span>.<span class="property">z</span> = -<span class="number">100</span>+<span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">150</span>));</span><br><span class="line"></span><br><span class="line">            scene.<span class="title function_">add</span>(cube);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;removeCube&#x27;</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;addCube&#x27;</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;cameraNear&#x27;</span>,<span class="number">0</span>,<span class="number">100</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        camera.<span class="property">near</span> = e;</span><br><span class="line">        camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;cameraFar&#x27;</span>,<span class="number">0</span>,<span class="number">200</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        camera.<span class="property">far</span> = e;</span><br><span class="line">        camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span>  = <span class="string">&quot;absolute&quot;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="variable constant_">MDM</span>.<span class="title function_">addCube</span>();</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModel</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//辅助工具</span></span><br><span class="line">    <span class="keyword">var</span> helper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxisHelper</span>(<span class="number">10</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(helper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> s = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(s, s, s);</span><br><span class="line">    <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshDepthMaterial</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3000</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cube, material);</span><br><span class="line"></span><br><span class="line">        mesh.<span class="property">position</span>.<span class="property">x</span> = <span class="number">800</span> * ( <span class="number">2.0</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">1.0</span> );</span><br><span class="line">        mesh.<span class="property">position</span>.<span class="property">y</span> = <span class="number">800</span> * ( <span class="number">2.0</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">1.0</span> );</span><br><span class="line">        mesh.<span class="property">position</span>.<span class="property">z</span> = <span class="number">800</span> * ( <span class="number">2.0</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">1.0</span> );</span><br><span class="line"></span><br><span class="line">        mesh.<span class="property">rotation</span>.<span class="property">x</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">        mesh.<span class="property">rotation</span>.<span class="property">y</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">        mesh.<span class="property">rotation</span>.<span class="property">z</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"></span><br><span class="line">        mesh.<span class="title function_">updateMatrix</span>();</span><br><span class="line"></span><br><span class="line">        scene.<span class="title function_">add</span>(mesh);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历场景中mesh对象。</span></span><br><span class="line">    scene.<span class="title function_">traverse</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(e <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">Mesh</span>)&#123;</span><br><span class="line">            e.<span class="property">rotation</span>.<span class="property">x</span> += <span class="number">0.02</span>;</span><br><span class="line">            e.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.02</span>;</span><br><span class="line">            e.<span class="property">rotation</span>.<span class="property">z</span> += <span class="number">0.02</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initGUI</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="联合材质"><a href="#联合材质" class="headerlink" title="联合材质"></a>联合材质</h2><h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><ol>
<li>THREE.MeshDepthMaterial材质没有用来设置颜色的属性，一切都是由材质的默认属性决定</li>
<li>THREE.js库可以通过联合材质创建出可以拥有颜色，同时也是THREE.MeshDepthMaterial材质的物体</li>
<li>如何联合材质？<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建两种材质</span></span><br><span class="line"><span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshDepthMaterial</span>();</span><br><span class="line"><span class="comment">//对于THREE.MeshBasicMaterial材质，需要设置transparent为true，并且指定一个融合模式</span></span><br><span class="line"><span class="comment">//如果transparent没有设置为true，只会出现纯绿色物体，因为three.js不会执行任何融合模式</span></span><br><span class="line"><span class="keyword">var</span> colorMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>:<span class="number">0xffffff</span>,</span><br><span class="line">  <span class="attr">transparent</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//设置THREE.MeshBasicMaterial如何与背景（THREE.MeshDepthMaterial材质渲染的方块）互相作用</span></span><br><span class="line">  <span class="comment">//THREE.MultiplyBlending对象，这种融合模式会把前景色和背景色相乘</span></span><br><span class="line">  <span class="attr">blending</span>:<span class="variable constant_">THREE</span>.<span class="property">MultiplyBlending</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="property">SceneUtils</span>.<span class="title function_">createMultiMaterialObject</span>(cubeGeometry,[colorMaterial,cubeMaterial]);</span><br><span class="line">cube.<span class="property">children</span>[<span class="number">1</span>].<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.99</span>,<span class="number">0.99</span>,<span class="number">0.99</span>);</span><br><span class="line"><span class="comment">//当调用THREE.SceneUtils.createMultiMaterialObject()方法创建一个网格时，几何体会被复制，返回一个网格组</span></span><br><span class="line"><span class="comment">//如果没有最后一行，渲染的时候画面会有闪烁</span></span><br><span class="line"><span class="comment">//通过缩小THREE.MeshDepthMaterial材质的网格，可以避免闪烁现象</span></span><br></pre></td></tr></table></figure>
这些方块从MeshDepthMaterial对象获得了亮度，从MeshBasicMaterial对象获得了颜色</li>
</ol>
<h3 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>在上述THREE.MeshDepthMaterial案例中，使用联合材质方法，给方块添加颜色</p>
<h4 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">50</span>,<span class="number">110</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">50</span>,<span class="number">40</span>,<span class="number">50</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>) &#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口响应式布局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MDM</span>,gui,rotationSpeed;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initGUI</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MDM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rotationSpeed</span> = <span class="number">0.02</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cameraNear</span> = camera.<span class="property">near</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cameraFar</span> = camera.<span class="property">far</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = <span class="number">0x00ff00</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">removeCube</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> allChildren = scene.<span class="property">children</span>;</span><br><span class="line">            <span class="keyword">var</span> lastChild = allChildren[allChildren.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">            <span class="comment">//判断时不再是Mesh对象，而是判断是否是group对象</span></span><br><span class="line">            <span class="keyword">if</span>(lastChild <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">Group</span>)&#123;</span><br><span class="line">                scene.<span class="title function_">remove</span>(lastChild);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">addCube</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">//随机大小</span></span><br><span class="line">            <span class="keyword">var</span> cubeSize = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="number">3</span>+(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">3</span>));</span><br><span class="line">            <span class="comment">//定义立方体几何</span></span><br><span class="line">            <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(cubeSize,cubeSize,cubeSize);</span><br><span class="line">            <span class="comment">//定义一种材质MeshDepthMaterial</span></span><br><span class="line">            <span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshDepthMaterial</span>();</span><br><span class="line">            <span class="comment">//定义第二种材质MeshBasicMaterial</span></span><br><span class="line">            <span class="keyword">var</span> colorMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">               <span class="comment">// 颜色</span></span><br><span class="line">               <span class="attr">color</span>: <span class="variable constant_">MDM</span>.<span class="property">color</span>,</span><br><span class="line">               <span class="comment">// 是否透明</span></span><br><span class="line">               <span class="attr">transparent</span>: <span class="literal">true</span>,</span><br><span class="line">               <span class="comment">// 融合模式THREE.MultiplyBlending模式会把前景色和背景色融合</span></span><br><span class="line">               <span class="attr">blending</span>: <span class="variable constant_">THREE</span>.<span class="property">MultiplyBlending</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">var</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="property">SceneUtils</span>.<span class="title function_">createMultiMaterialObject</span>(cubeGeometry,[colorMaterial,cubeMaterial]);</span><br><span class="line">            cube.<span class="property">children</span>[<span class="number">1</span>].<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.99</span>,<span class="number">0.99</span>,<span class="number">0.99</span>);</span><br><span class="line">            cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">            cube.<span class="property">position</span>.<span class="property">x</span> = -<span class="number">60</span>+<span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">100</span>));</span><br><span class="line">            cube.<span class="property">position</span>.<span class="property">y</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">10</span>));</span><br><span class="line">            cube.<span class="property">position</span>.<span class="property">z</span> = -<span class="number">100</span>+<span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">150</span>));</span><br><span class="line"></span><br><span class="line">            scene.<span class="title function_">add</span>(cube);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">addColor</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;color&#x27;</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;removeCube&#x27;</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;addCube&#x27;</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;cameraNear&#x27;</span>,<span class="number">0</span>,<span class="number">100</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        camera.<span class="property">near</span> = e;</span><br><span class="line">        camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MDM</span>,<span class="string">&#x27;cameraFar&#x27;</span>,<span class="number">0</span>,<span class="number">200</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        camera.<span class="property">far</span> = e;</span><br><span class="line">        camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span>  = <span class="string">&quot;absolute&quot;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">    <span class="comment">//初始页面时先增加几个立方体</span></span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="variable constant_">MDM</span>.<span class="title function_">addCube</span>();</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历场景中Group对象。旋转立方体</span></span><br><span class="line">    scene.<span class="title function_">traverse</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(e <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">Group</span>)&#123;</span><br><span class="line">            e.<span class="property">rotation</span>.<span class="property">x</span> += <span class="number">0.02</span>;</span><br><span class="line">            e.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.02</span>;</span><br><span class="line">            e.<span class="property">rotation</span>.<span class="property">z</span> += <span class="number">0.02</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initGUI</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="THREE-MeshNormalMaterial"><a href="#THREE-MeshNormalMaterial" class="headerlink" title="THREE.MeshNormalMaterial"></a>THREE.MeshNormalMaterial</h2><h3 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h3><ol>
<li>使用法向向量计算物体的表面颜色</li>
<li>法向量在three.js中可以用来决定光的反射，有助于将纹理映射到三维模型，并提供有关如何计算光照、阴影和为表面像素着色的信息</li>
</ol>
<h3 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>wireframe</td>
<td>该属性指定是否显示线框</td>
</tr>
<tr>
<td>wireframeLineWidth</td>
<td>该属性指定线框的宽度（这个属性支队THREE.CanvasRenderer有效）</td>
</tr>
</tbody></table>
<h3 id="案例-4"><a href="#案例-4" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h4><p>选择sphere（球体）作为网格，当flatshading属性设置为true时，网格的每一个面渲染的颜色都不同，即使球体在旋转时，这些颜色也基本保持在原来的位置（每个面的颜色都是由从该面向外指的法向量计算得到的）。</p>
<h4 id="结果-3"><a href="#结果-3" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">20</span>,<span class="number">50</span>,<span class="number">40</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> webGLRenderer,canvasRenderer,renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    webGLRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    webGLRenderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    webGLRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    webGLRenderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    canvasRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CanvasRenderer</span>();</span><br><span class="line">    canvasRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line"></span><br><span class="line">    renderer = webGLRenderer;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x0c0c0c</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">40</span>,<span class="number">60</span>,-<span class="number">10</span>);</span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1024</span>,<span class="number">1024</span>);</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">130</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">40</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模型</span></span><br><span class="line"><span class="keyword">var</span> axes,cube,plane,meshMaterial,sphere,ground,selectedMesh;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    axes = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(axes);</span><br><span class="line">    <span class="comment">//材质</span></span><br><span class="line">    meshMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshNormalMaterial</span>()</span><br><span class="line">    <span class="comment">//地面</span></span><br><span class="line">    <span class="keyword">var</span> groundGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> groundMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x777777</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    ground = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(groundGeometry,groundMaterial);</span><br><span class="line">    ground.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">    ground.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">20</span>;</span><br><span class="line">    ground.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(ground);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//立方体</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>);</span><br><span class="line">    cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,meshMaterial);</span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//球</span></span><br><span class="line">    <span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">14</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">    sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphereGeometry,meshMaterial);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    sphere.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// scene.add(sphere);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//平面</span></span><br><span class="line">    <span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">14</span>,<span class="number">14</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,meshMaterial);</span><br><span class="line">    plane.<span class="property">position</span> = sphere.<span class="property">position</span>;</span><br><span class="line"></span><br><span class="line">    selectedMesh = cube;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    selectedMesh.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.02</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口自适应</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MBM</span>,<span class="title class_">MaterialGui</span>,gui;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMBM</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MBM</span> = cube.<span class="property">material</span>;</span><br><span class="line">    <span class="variable constant_">MBM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedMesh</span> = <span class="string">&quot;cube&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    <span class="title function_">addBasicMaterialSettings</span>(gui,<span class="variable constant_">MBM</span>,meshMaterial);</span><br><span class="line"></span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MBM</span>,<span class="string">&#x27;selectedMesh&#x27;</span>,[<span class="string">&#x27;cube&#x27;</span>,<span class="string">&#x27;sphere&#x27;</span>,<span class="string">&#x27;plane&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        scene.<span class="title function_">remove</span>(cube);</span><br><span class="line">        scene.<span class="title function_">remove</span>(sphere);</span><br><span class="line">        scene.<span class="title function_">remove</span>(plane);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (e)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;cube&#x27;</span>:</span><br><span class="line">                scene.<span class="title function_">add</span>(cube);</span><br><span class="line">                selectedMesh = cube;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;sphere&#x27;</span>:</span><br><span class="line">                scene.<span class="title function_">add</span>(sphere);</span><br><span class="line">                selectedMesh = sphere;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;plane&#x27;</span>:</span><br><span class="line">                scene.<span class="title function_">add</span>(plane);</span><br><span class="line">                selectedMesh = plane;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initModels</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initMBM</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="在单几何体上使用多种材质"><a href="#在单几何体上使用多种材质" class="headerlink" title="在单几何体上使用多种材质"></a>在单几何体上使用多种材质</h2><ol>
<li>如果有一个方块，有12个面（注意，three.js中只作用于三角形）。你可以用这种材质给方块的每个面指定一种材质（例如不同的颜色）</li>
</ol>
<h3 id="案例-5"><a href="#案例-5" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h4><ol>
<li>先创建一个THREE.Mesh对象，用来保存所有的方块</li>
<li>创建一个数组，用来保存所有材质（12个面，只需6个材质，每一个材质应用于一整个面）</li>
<li>建立三个循环，以保证创建出正确数量的方块</li>
<li>在循环中，创建每一个方块，赋予材质和定位，并把他们添加到组中</li>
</ol>
<h4 id="结果-4"><a href="#结果-4" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">50</span>,<span class="number">40</span>,<span class="number">50</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(scene.<span class="property">position</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>) &#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口响应式布局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> group;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">models</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//创建一个THREE.Mesh对象，用来保存所有方块</span></span><br><span class="line">    group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>();</span><br><span class="line">    <span class="comment">//创建一个数组</span></span><br><span class="line">    <span class="keyword">var</span> mats = [];</span><br><span class="line">    <span class="comment">//为每个面创建一个材质，并将它们保存在数组中</span></span><br><span class="line">    mats.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0x009e60</span>&#125;));</span><br><span class="line">    mats.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0x0051ba</span>&#125;));</span><br><span class="line">    mats.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0xffd500</span>&#125;));</span><br><span class="line">    mats.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0xff5800</span>&#125;));</span><br><span class="line">    mats.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0xC41E3A</span>&#125;));</span><br><span class="line">    mats.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="number">0xffffff</span>&#125;));</span><br><span class="line">    <span class="comment">//建立三个循环，以保证创建出正确数量的方块</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> z=<span class="number">0</span>;z&lt;<span class="number">3</span>; z++)&#123;</span><br><span class="line">                <span class="comment">//创建方块几何</span></span><br><span class="line">                <span class="keyword">var</span> geom = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">2.9</span>,<span class="number">2.9</span>,<span class="number">2.9</span>)</span><br><span class="line">                <span class="comment">//创建方块</span></span><br><span class="line">                <span class="keyword">var</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geom,mats);</span><br><span class="line">                <span class="comment">//设置方块位置定位</span></span><br><span class="line">                cube.<span class="property">position</span>.<span class="title function_">set</span>(i * <span class="number">3</span> - <span class="number">3</span>, j * <span class="number">3</span> - <span class="number">3</span>, z * <span class="number">3</span> - <span class="number">3</span>);</span><br><span class="line">                <span class="comment">//将方块添加到THREE.Mesh对象中</span></span><br><span class="line">                group.<span class="title function_">add</span>(cube);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//THREE.Mesh对象的放大</span></span><br><span class="line">    group.<span class="property">scale</span>.<span class="title function_">copy</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(group);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MFM</span>,gui,rotationSpeed;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initGUI</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MFM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rotationSpeed</span> = <span class="number">0.02</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">add</span>(<span class="variable constant_">MFM</span>,<span class="string">&#x27;rotationSpeed&#x27;</span>,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    group.<span class="property">rotation</span>.<span class="property">y</span> += <span class="variable constant_">MFM</span>.<span class="property">rotationSpeed</span>;</span><br><span class="line">    group.<span class="property">rotation</span>.<span class="property">x</span> += <span class="variable constant_">MFM</span>.<span class="property">rotationSpeed</span>;</span><br><span class="line">    group.<span class="property">rotation</span>.<span class="property">z</span> += <span class="variable constant_">MFM</span>.<span class="property">rotationSpeed</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">models</span>();</span><br><span class="line">    <span class="title function_">initGUI</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="THREE-MeshLambertMaterial"><a href="#THREE-MeshLambertMaterial" class="headerlink" title="THREE.MeshLambertMaterial"></a>THREE.MeshLambertMaterial</h2><h3 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h3><ol>
<li>用来创建暗淡的并不光亮的表面</li>
<li>该材质非常易用，而且会对场景中的光源产生反应</li>
<li>支持线框绘制属性，可以绘制具有光照效果的线框物体</li>
<li>效果看起来比较暗淡</li>
</ol>
<h3 id="属性-3"><a href="#属性-3" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>color（颜色）</td>
<td>这是材质的环境光</td>
</tr>
<tr>
<td>emissive（自发光）</td>
<td>材质自发光的颜色。该材质虽然不会让使用它的物体变成光源，但会使物体的颜色不受其他光源的影响（即使在场景中没有光源的暗处，该物体表面的emissive颜色也可见，从而实现物体自发光。）该属性的默认值为黑色。</td>
</tr>
</tbody></table>
<p>创建</p>
<p>var meshLambertMaterial &#x3D; new THREE.MeshLambertMaterial({color:0xffffff});</p>
<h3 id="案例-6"><a href="#案例-6" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h4><ol>
<li>通过改变标签可以自定义创建一个橘黄色，带有轻微自发光的效果的物体</li>
</ol>
<h4 id="结果-5"><a href="#结果-5" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">20</span>,<span class="number">50</span>,<span class="number">40</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> webGLRenderer,canvasRenderer,renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    webGLRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    webGLRenderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    webGLRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    webGLRenderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    canvasRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CanvasRenderer</span>();</span><br><span class="line">    canvasRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line"></span><br><span class="line">    renderer = webGLRenderer;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//环境光</span></span><br><span class="line">    <span class="keyword">var</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x0c0c0c</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line">    <span class="comment">//据光源</span></span><br><span class="line">    <span class="keyword">var</span> spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">40</span>,<span class="number">60</span>,-<span class="number">10</span>);</span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1024</span>,<span class="number">1024</span>);</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">130</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">40</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模型</span></span><br><span class="line"><span class="keyword">var</span> axes,cube,plane,meshMaterial,sphere,ground,selectedMesh;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    axes = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(axes);</span><br><span class="line">    <span class="comment">//创建THREE.MeshLambertMaterial材质</span></span><br><span class="line">    meshMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x7777ff</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//地面</span></span><br><span class="line">    <span class="keyword">var</span> groundGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> groundMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x777777</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    ground = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(groundGeometry,groundMaterial);</span><br><span class="line">    ground.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">    ground.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">20</span>;</span><br><span class="line">    ground.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(ground);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//立方体</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>);</span><br><span class="line">    cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,meshMaterial);</span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//球</span></span><br><span class="line">    <span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">14</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">    sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphereGeometry,meshMaterial);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    sphere.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// scene.add(sphere);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//平面</span></span><br><span class="line">    <span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">14</span>,<span class="number">14</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,meshMaterial);</span><br><span class="line">    plane.<span class="property">position</span> = sphere.<span class="property">position</span>;</span><br><span class="line"></span><br><span class="line">    selectedMesh = cube;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    selectedMesh.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.02</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口自适应</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MLM</span>,gui;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMBM</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MLM</span> = cube.<span class="property">material</span>;</span><br><span class="line">    <span class="variable constant_">MLM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedMesh</span> = <span class="string">&quot;cube&quot;</span>;</span><br><span class="line">        <span class="comment">//材质颜色</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = meshMaterial.<span class="property">color</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="comment">//材质自发光颜色</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">emissive</span> = meshMaterial.<span class="property">emissive</span>.<span class="title function_">getHex</span>();</span><br><span class="line">        <span class="comment">//材质是否显示线框模式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframe</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//材质线框的宽度，在WebGLRenderer下无反应</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframeLinewidth</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    <span class="title function_">addBasicMaterialSettings</span>(gui,<span class="variable constant_">MLM</span>,meshMaterial);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">MLMGUI</span> = gui.<span class="title function_">addFolder</span>(<span class="string">&quot;THREE.MeshLambertMaterial&quot;</span>)</span><br><span class="line">    <span class="variable constant_">MLMGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MLM</span>,<span class="string">&#x27;color&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">color</span>.<span class="title function_">setStyle</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MLMGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MLM</span>, <span class="string">&#x27;emissive&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">emissive</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MLMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MLM</span>,<span class="string">&#x27;wireframe&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframe</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MLMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MLM</span>,<span class="string">&#x27;wireframeLinewidth&#x27;</span>,<span class="number">0</span>,<span class="number">20</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframeLinewidth</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">loadGopher</span>(meshMaterial).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">gopher</span>)&#123;</span><br><span class="line">        gopher.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">        gui.<span class="title function_">add</span>(<span class="variable constant_">MLM</span>,<span class="string">&#x27;selectedMesh&#x27;</span>,[<span class="string">&#x27;cube&#x27;</span>,<span class="string">&#x27;sphere&#x27;</span>,<span class="string">&#x27;plane&#x27;</span>,<span class="string">&#x27;gopher&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">            scene.<span class="title function_">remove</span>(cube);</span><br><span class="line">            scene.<span class="title function_">remove</span>(sphere);</span><br><span class="line">            scene.<span class="title function_">remove</span>(plane);</span><br><span class="line">            scene.<span class="title function_">remove</span>(gopher);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (e)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;cube&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(cube);</span><br><span class="line">                    selectedMesh = cube;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;sphere&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(sphere);</span><br><span class="line">                    selectedMesh = sphere;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;plane&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(plane);</span><br><span class="line">                    selectedMesh = plane;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;gopher&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(gopher);</span><br><span class="line">                    selectedMesh = gopher;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initModels</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initMBM</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="THREE-MeshPhongMaterial"><a href="#THREE-MeshPhongMaterial" class="headerlink" title="THREE.MeshPhongMaterial"></a>THREE.MeshPhongMaterial</h2><h3 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h3><ol>
<li>创建一种光亮的材质</li>
<li>可以在物体表面实现高光效果</li>
<li>可以模拟塑料质感，也可以模拟金属质</li>
<li>THREE.js还提供了一个THREE.MeshPhongMaterial材质的扩展材质：THREE.MeshToonMaterial</li>
</ol>
<h3 id="属性-4"><a href="#属性-4" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>color（颜色）</td>
<td>材质的环境色。与环境光源一起使用。这个颜色会与环境光提供的颜色相乘。默认值为白色</td>
</tr>
<tr>
<td>emissive（自发光颜色）</td>
<td>材质自发光的颜色。该材质虽然不会让使用它的物体变成光源，但会使物体的颜色不受其他光源的影响（即使在场景中没有光源的暗处，该物体表面的emissive颜色也可见，从而实现物体自发光。）该属性的默认值为黑色。</td>
</tr>
<tr>
<td>specular（高光颜色）</td>
<td>该属性指定该材质的光亮程度及高光部分颜色。如果将它设置成与color属性相同的颜色，将会得到一个类似金属的材质，如果将它设置成灰色（grey），材质将会变得像塑料</td>
</tr>
<tr>
<td>shiness（高光度）</td>
<td>该属性指定物体表面镜面高光部分的轮廓的清晰程度，越光滑的表面，高光部分越清晰，反之越模糊。该属性的默认值为30</td>
</tr>
</tbody></table>
<p>创建</p>
<p>var meshPhongMaterial &#x3D; new THREE.MeshPhongMaterial({color: 0xdddddd});</p>
<h3 id="案例-7"><a href="#案例-7" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h4><ol>
<li>创建THREE.MeshPhongMaterial材质</li>
<li>可以通过GUI控制界面实验这个材质，随意改变材质参数，实现金属材质感和塑料材质感</li>
</ol>
<h4 id="结果-6"><a href="#结果-6" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">30</span>,<span class="number">40</span>,<span class="number">30</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> webGLRenderer,canvasRenderer,renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    webGLRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    webGLRenderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    webGLRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    webGLRenderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    canvasRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CanvasRenderer</span>();</span><br><span class="line">    canvasRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line"></span><br><span class="line">    renderer = webGLRenderer;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//环境光</span></span><br><span class="line">    <span class="keyword">var</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0xffffff</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line">    <span class="comment">//聚光源</span></span><br><span class="line">    <span class="keyword">var</span> spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line">    <span class="comment">//光源位置</span></span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">0</span>,<span class="number">30</span>,<span class="number">60</span>);</span><br><span class="line">    <span class="comment">//是否启用光源阴影</span></span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//光源强度</span></span><br><span class="line">    spotLight.<span class="property">intensity</span> = <span class="number">0.6</span></span><br><span class="line">    <span class="comment">//光源阴影大小</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1024</span>,<span class="number">1024</span>);</span><br><span class="line">    <span class="comment">//光源阴影投射远点</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">130</span>;</span><br><span class="line">    <span class="comment">//光源阴影投射近点</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">40</span>;</span><br><span class="line">    <span class="comment">//将光源添加进场景</span></span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模型</span></span><br><span class="line"><span class="keyword">var</span> axes,cube,plane,meshMaterial,sphere,ground,selectedMesh;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    axes = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(axes);</span><br><span class="line">    <span class="comment">//创建MeshStandardMaterial材质</span></span><br><span class="line">    meshMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x7777ff</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//地面</span></span><br><span class="line">    <span class="keyword">var</span> groundGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> groundMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x777777</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    ground = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(groundGeometry,groundMaterial);</span><br><span class="line">    ground.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">    ground.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">20</span>;</span><br><span class="line">    ground.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(ground);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//立方体</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>);</span><br><span class="line">    cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,meshMaterial);</span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//球</span></span><br><span class="line">    <span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">14</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">    sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphereGeometry,meshMaterial);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    sphere.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// scene.add(sphere);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//平面</span></span><br><span class="line">    <span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">14</span>,<span class="number">14</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,meshMaterial);</span><br><span class="line">    plane.<span class="property">position</span> = sphere.<span class="property">position</span>;</span><br><span class="line"></span><br><span class="line">    selectedMesh = cube;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    selectedMesh.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.02</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口自适应</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MPM</span>,<span class="title class_">MaterialGui</span>,gui;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMBM</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MPM</span> = meshMaterial;</span><br><span class="line">    <span class="variable constant_">MPM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedMesh</span> = <span class="string">&quot;cube&quot;</span>;</span><br><span class="line">        <span class="comment">//材质颜色</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = meshMaterial.<span class="property">color</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="comment">//材质自发光颜色</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">emissive</span> = meshMaterial.<span class="property">emissive</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="comment">//材质金属感程度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">metalness</span> = meshMaterial.<span class="property">metalness</span>;</span><br><span class="line">        <span class="comment">//材质粗糙程度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">roughness</span> = meshMaterial.<span class="property">roughness</span>;</span><br><span class="line">        <span class="comment">//线框模式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframe</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//线框宽度，WebGLRenderer下不支持</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframeLinewidth</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    <span class="title function_">addBasicMaterialSettings</span>(gui,<span class="variable constant_">MPM</span>,meshMaterial);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">MPMGUI</span> = gui.<span class="title function_">addFolder</span>(<span class="string">&quot;THREE.MeshLambertMaterial&quot;</span>)</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;color&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">color</span>.<span class="title function_">setStyle</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MPM</span>, <span class="string">&#x27;emissive&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">emissive</span>.<span class="title function_">setStyle</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;metalness&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">metalness</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;roughness&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">roughness</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;wireframe&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframe</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;wireframeLinewidth&#x27;</span>,<span class="number">0</span>,<span class="number">20</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframeLinewidth</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">loadGopher</span>(meshMaterial).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">gopher</span>)&#123;</span><br><span class="line">        gopher.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">        gui.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;selectedMesh&#x27;</span>,[<span class="string">&#x27;cube&#x27;</span>,<span class="string">&#x27;sphere&#x27;</span>,<span class="string">&#x27;plane&#x27;</span>,<span class="string">&#x27;gopher&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">            scene.<span class="title function_">remove</span>(cube);</span><br><span class="line">            scene.<span class="title function_">remove</span>(sphere);</span><br><span class="line">            scene.<span class="title function_">remove</span>(plane);</span><br><span class="line">            scene.<span class="title function_">remove</span>(gopher);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (e)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;cube&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(cube);</span><br><span class="line">                    selectedMesh = cube;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;sphere&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(sphere);</span><br><span class="line">                    selectedMesh = sphere;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;plane&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(plane);</span><br><span class="line">                    selectedMesh = plane;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;gopher&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(gopher);</span><br><span class="line">                    selectedMesh = gopher;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initModels</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initMBM</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="THREE-MeshStandardMaterial"><a href="#THREE-MeshStandardMaterial" class="headerlink" title="THREE.MeshStandardMaterial"></a>THREE.MeshStandardMaterial</h2><h3 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h3><ol>
<li>这种材质使用更加正确的物理计算来决定物体表面如何与场景中的光源互动</li>
<li>能够更好的表现塑料质感和金属质感的表面</li>
</ol>
<h3 id="属性-5"><a href="#属性-5" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>metalness（金属感程度）</td>
<td>该属性控制物体表面的金属感程度。0代表完全塑料质感，1代表完全金属质感。默认值为0.5</td>
</tr>
<tr>
<td>roughness（粗糙程度）</td>
<td>该属性控制物体表面的粗糙程度。在视觉上，它决定表面对入射光的漫反射程度。默认值0.5。当值为0时会产生类似镜面的反射，为1时会产生完全的漫反射效果</td>
</tr>
</tbody></table>
<h3 id="案例-8"><a href="#案例-8" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h4><h4 id="结果-7"><a href="#结果-7" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h4><h2 id="THREE-MeshPhysicalMaterial"><a href="#THREE-MeshPhysicalMaterial" class="headerlink" title="THREE.MeshPhysicalMaterial"></a>THREE.MeshPhysicalMaterial</h2><h3 id="简介-7"><a href="#简介-7" class="headerlink" title="简介"></a>简介</h3><ol>
<li>该材质与THREE.MeshPhongMaterial材质非常相似</li>
<li>提供了对反光度的更多控制</li>
<li>该材质与上述MeshStandardMaterial材质，在不动手实验的情况下，很难确定什么样的参数值才能最符合特定需求。因此最佳的实践方法就是在程序里增加一个简单的UI，一边调节参数一边观察。</li>
</ol>
<h3 id="属性-6"><a href="#属性-6" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>clearCoat（清漆）</td>
<td>该属性控制物体表面清漆涂层效果的明显程度。该属性值越高，则清漆图层越厚，其结果是clearCoatRoughness属性带来的影响越明显。取值范围是0-1，默认值0</td>
</tr>
<tr>
<td>clearCoatRoughness（清漆粗糙程度）</td>
<td>该属性控制物体表面清漆涂层的粗糙程度。粗糙程度越高，漫反射越明显。该属性需要与clearCoat属性配合使用。取值范围0-1，默认值0</td>
</tr>
<tr>
<td>reflectivity（反光度）</td>
<td>该属性用于控制非金属表面的反光度，因此当metalness（金属感程度）为1或接近1时该属性的作用很小。取值范围时0-1，默认值0.5</td>
</tr>
</tbody></table>
<h3 id="案例-9"><a href="#案例-9" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h4><ol>
<li>与上述THREE.MeshStandardMaterial材质案例相似。</li>
</ol>
<h4 id="结果-8"><a href="#结果-8" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-8"><a href="#代码-8" class="headerlink" title="代码"></a>代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">30</span>,<span class="number">40</span>,<span class="number">30</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> webGLRenderer,canvasRenderer,renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    webGLRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    webGLRenderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    webGLRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    webGLRenderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    canvasRenderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CanvasRenderer</span>();</span><br><span class="line">    canvasRenderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line"></span><br><span class="line">    renderer = webGLRenderer;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0xffffff</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">0</span>,<span class="number">30</span>,<span class="number">60</span>);</span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    spotLight.<span class="property">intensity</span> = <span class="number">0.6</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1024</span>,<span class="number">1024</span>);</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">130</span>;</span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">40</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模型</span></span><br><span class="line"><span class="keyword">var</span> axes,cube,plane,meshMaterial,sphere,ground,selectedMesh;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    axes = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(axes);</span><br><span class="line">    <span class="comment">//材质</span></span><br><span class="line">    meshMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhysicalMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x7777ff</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//地面</span></span><br><span class="line">    <span class="keyword">var</span> groundGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> groundMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>:<span class="number">0x777777</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    ground = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(groundGeometry,groundMaterial);</span><br><span class="line">    ground.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">    ground.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">20</span>;</span><br><span class="line">    ground.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(ground);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//立方体</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>);</span><br><span class="line">    cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,meshMaterial);</span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//球</span></span><br><span class="line">    <span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">14</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">    sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphereGeometry,meshMaterial);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">    sphere.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// scene.add(sphere);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//平面</span></span><br><span class="line">    <span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">14</span>,<span class="number">14</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,meshMaterial);</span><br><span class="line">    plane.<span class="property">position</span> = sphere.<span class="property">position</span>;</span><br><span class="line"></span><br><span class="line">    selectedMesh = cube;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>( camera, renderer.<span class="property">domElement</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls.<span class="property">maxDistance</span>  = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    selectedMesh.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.02</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口自适应</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MPM</span>,<span class="title class_">MaterialGui</span>,gui;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMBM</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable constant_">MPM</span> = meshMaterial;</span><br><span class="line">    <span class="variable constant_">MPM</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedMesh</span> = <span class="string">&quot;cube&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = meshMaterial.<span class="property">color</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">emissive</span> = meshMaterial.<span class="property">emissive</span>.<span class="title function_">getStyle</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">metalness</span> = meshMaterial.<span class="property">metalness</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">roughness</span> = meshMaterial.<span class="property">roughness</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">clearCoat</span> = meshMaterial.<span class="property">clearCoat</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">clearCoatRoughness</span> = meshMaterial.<span class="property">clearCoatRoughness</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reflectivity</span> = meshMaterial.<span class="property">reflectivity</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframe</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wireframeLinewidth</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    <span class="title function_">addBasicMaterialSettings</span>(gui,<span class="variable constant_">MPM</span>,meshMaterial);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">MPMGUI</span> = gui.<span class="title function_">addFolder</span>(<span class="string">&quot;THREE.MeshLambertMaterial&quot;</span>)</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;color&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">color</span>.<span class="title function_">setStyle</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">addColor</span>(<span class="variable constant_">MPM</span>, <span class="string">&#x27;emissive&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">emissive</span>.<span class="title function_">setStyle</span>(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;metalness&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">metalness</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;roughness&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">roughness</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;clearCoat&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">clearCoat</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;clearCoatRoughness&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">clearCoatRoughness</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;reflectivity&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.01</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        meshMaterial.<span class="property">reflectivity</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;wireframe&#x27;</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframe</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable constant_">MPMGUI</span>.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;wireframeLinewidth&#x27;</span>,<span class="number">0</span>,<span class="number">20</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        meshMaterial.<span class="property">wireframeLinewidth</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">loadGopher</span>(meshMaterial).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">gopher</span>)&#123;</span><br><span class="line">        gopher.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">        gui.<span class="title function_">add</span>(<span class="variable constant_">MPM</span>,<span class="string">&#x27;selectedMesh&#x27;</span>,[<span class="string">&#x27;cube&#x27;</span>,<span class="string">&#x27;sphere&#x27;</span>,<span class="string">&#x27;plane&#x27;</span>,<span class="string">&#x27;gopher&#x27;</span>]).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">            scene.<span class="title function_">remove</span>(cube);</span><br><span class="line">            scene.<span class="title function_">remove</span>(sphere);</span><br><span class="line">            scene.<span class="title function_">remove</span>(plane);</span><br><span class="line">            scene.<span class="title function_">remove</span>(gopher);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (e)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;cube&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(cube);</span><br><span class="line">                    selectedMesh = cube;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;sphere&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(sphere);</span><br><span class="line">                    selectedMesh = sphere;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;plane&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(plane);</span><br><span class="line">                    selectedMesh = plane;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;gopher&#x27;</span>:</span><br><span class="line">                    scene.<span class="title function_">add</span>(gopher);</span><br><span class="line">                    selectedMesh = gopher;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&quot;500px&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initModels</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initMBM</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="粒子和精灵"><a href="#粒子和精灵" class="headerlink" title="粒子和精灵"></a>粒子和精灵</h1><p>理解粒子：</p>
<ol>
<li>每一个粒子都是面向摄像机的二维平面。</li>
</ol>
<p>粒子的作用：</p>
<ol>
<li>可以非常容易的创建很多细小的物体，可以用来模拟雨滴，雪花，烟等有趣的效果</li>
</ol>
<p>粒子的创建：</p>
<ol>
<li>可以用THREE.Sprite(material)构造函数手工创建粒子。</li>
</ol>
<p>var material &#x3D; new THREE.Sprite(material);</p>
<p>material 属性可以是两种：new THREE.SpriteMaterial()  和  new THREE.SpriteCanvasMaterial()</p>
<ol start="2">
<li>将sprite添加到场景Scene中。如果没有给粒子指定任何属性，粒子将被渲染成二维的白色小方块。</li>
</ol>
<p>💡对象THREE.Sprite和THREE.Mesh一样，THREE.Sprite对象也是THREE.Object3D对象的扩展。也就是说THREE.Mesh的大部分属性和函数都可以用于THREE.Sprite。THREE.Points 和 THREE.PointsMaterial</p>
<ol>
<li>THREE.Points的构造函数接受两个属性：几何体和材质</li>
</ol>
<p>var cloud &#x3D; new THREE.Points(geometry,material);</p>
<p>🌞 材质用来给粒子着色和添加纹理；几何体用来指定单个粒子的位置案例代码（用THREE.PointsMaterial样式化粒子）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createParticles</span>(<span class="params">size,transparent,opacity,vertexColors,sizeAttenuation,colorValue,vertexColorValue</span>)&#123;</span><br><span class="line"> <span class="comment">//创建一个THREE.Geometry对象</span></span><br><span class="line">  <span class="keyword">var</span> geom = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br><span class="line">  <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">size</span>: size,</span><br><span class="line">    <span class="attr">transparent</span>: transparent,</span><br><span class="line">    <span class="attr">opacity</span>: opacity,</span><br><span class="line">    <span class="attr">vertexColors</span>: vertexColors,</span><br><span class="line">    <span class="attr">sizeAttenuation</span>: sizeAttenuation,</span><br><span class="line">    <span class="attr">color</span>: <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(colorValue),</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> range = <span class="number">500</span>;</span><br><span class="line">  <span class="comment">//循环，在随机的位置中创建particle</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i&lt; <span class="number">15000</span>; i++)&#123;</span><br><span class="line">    <span class="comment">//创建THREE.Vector3表示的粒子</span></span><br><span class="line">    <span class="keyword">var</span> particle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(</span><br><span class="line">      <span class="title class_">Math</span>.<span class="title function_">random</span>() * range - range / <span class="number">2</span>,</span><br><span class="line">      <span class="title class_">Math</span>.<span class="title function_">random</span>() * range - range / <span class="number">2</span>,</span><br><span class="line">      <span class="title class_">Math</span>.<span class="title function_">random</span>() * range - range / <span class="number">2</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//添加到几何体中</span></span><br><span class="line">    geom.<span class="property">vertices</span>.<span class="title function_">push</span>(particle);</span><br><span class="line">    <span class="keyword">var</span> color = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(vertexColorValue);</span><br><span class="line">    <span class="keyword">var</span> asHSL = &#123;&#125;;</span><br><span class="line">    color.<span class="title function_">getHSL</span>(asHSL);</span><br><span class="line">    color.<span class="title function_">setHSL</span>(asHSL.<span class="property">h</span>, asHSL.<span class="property">s</span>, asHSL.<span class="property">l</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br><span class="line">    geom.<span class="property">colors</span>.<span class="title function_">push</span>(color);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> cloud = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(geom, material);</span><br><span class="line">  cloud.<span class="property">name</span> = <span class="string">&quot;particles&quot;</span>;</span><br><span class="line">  scene.<span class="title function_">add</span>(cloud);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>THREE.PointsMaterial对象中所有可设置的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>color</strong></td>
<td>粒子系统中所有粒子的颜色。将vertexColors属性设置为true，并且通过颜色属性指定了几何体的颜色来覆盖该属性（更准确地说，顶点的颜色将乘以此值以确定最终颜色），默认值为：0xFFFFFF</td>
</tr>
<tr>
<td><strong>map</strong></td>
<td>通过这个属性可以在粒子上应用某种材质</td>
</tr>
<tr>
<td><strong>size</strong></td>
<td>指定粒子大小，默认值1</td>
</tr>
<tr>
<td><strong>sizeAnnutation</strong></td>
<td>如果该属性设置为false，那么所有粒子都将拥有相同的尺寸大小，无论距离摄像机有多远；如果设置为true，粒子的大小就取决于距离摄像机的距离远近。默认为true</td>
</tr>
<tr>
<td><strong>vertexColors</strong></td>
<td>通常，THREE.Points中所有粒子都拥有相同的颜色。如果该属性设置为THREE.VertexColors，并且几何体的颜色数组也有值，那就会使用颜色数组中的值。默认是THREE.NoColor</td>
</tr>
<tr>
<td><strong>opacity</strong></td>
<td>该属性与transparent属性一起使用，用来设置粒子的不透明度。默认值为1（完全无透明）</td>
</tr>
<tr>
<td><strong>transparent</strong></td>
<td>如果属性设置为true，那么粒子在渲染时会根据opacity属性的值来确定其透明度。默认值为false</td>
</tr>
<tr>
<td><strong>blending</strong></td>
<td>该属性指定渲染粒子时的融合模式.</td>
</tr>
<tr>
<td><strong>fog</strong></td>
<td>该属性决定粒子是否受雾化效果影响，默认为true</td>
</tr>
</tbody></table>
<p>材质 Material 的 .blending 属性主要控制纹理融合的叠加方式，.blending 属性的默认值是 THREE.NormalBlending，其它值THREE.AdditiveBlending、THREE.SubtractiveBlending 等</p>
<ul>
<li>THREE.NormalBlending:.blending 属性默认值</li>
<li>THREE.AdditiveBlending:加法融合模式</li>
<li>THREE.SubtractiveBlending:减法融合模式</li>
<li>THREE.MultiplyBlending:乘法融合模式</li>
<li>THREE.CustomBlending:自定义融合模式，与.blendSrc,.blendDst或.blendEquation属性组合使用</li>
</ul>
<p>纹理样式化粒子</p>
<ol>
<li>使用图像样式化粒子一种更直接的方式。使用THREE.TextureLoader().load()函数将图像加载为THREE.Texture对象，然后分配给材质的map属性</li>
</ol>
<p>var texture &#x3D; new THREE.TextureLoader().load(“..&#x2F;..&#x2F;ssf&#x2F;df&#x2F;raindrop-3.png”);</p>
<p>实现雨滴特效</p>
<ol>
<li>加载雨滴纹理（纹理应该是正方形，尺寸最好是2的幂）</li>
<li>设置雨滴粒子材质属性</li>
<li>为每个粒子创建顶点</li>
<li>为粒子（THREE.Vector3）添加如何水平移动（velocityX）和下落速度（velocityY）（横向运动速度的范围-0.16<del>+0.16，纵向速度的范围是0.1</del>0.3）</li>
<li>获取几何体所有粒子，对于每个粒子，用velocityX和velocityY改变它们的当前位置。</li>
<li>判断粒子范围，如果v.y的位置低于0，把粒子放回顶部，如果v.x的位置到达任何一条边界，就反转横向速度，让雨滴反弹。</li>
</ol>
<p>💡depthWrite属性决定这个对象是否影响WebGL的深度缓存。设置为false，可以保证在各个位置上渲染的雨滴之间不会互相影响。如果不设置为false，那么当一个粒子在另一个THREE.Points对象的粒子前面时，会看到纹理的黑色背景。实例代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>)&#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">1</span>,<span class="number">200</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">20</span>,<span class="number">100</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">30</span>,<span class="number">30</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x404040</span>));</span><br><span class="line"></span><br><span class="line">    light = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(<span class="number">0xffffff</span>);</span><br><span class="line">    light.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(light);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>) &#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">var</span> cloud;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>)&#123;</span><br><span class="line">    controls = <span class="keyword">new</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = <span class="number">2</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">transparent</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">opacity</span> = <span class="number">0.6</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = <span class="number">0xffffff</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sizeAttenuation</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">redraw</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            scene.<span class="title function_">remove</span>(scene.<span class="title function_">getObjectByName</span>(<span class="string">&quot;particle1&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="title function_">createSprites</span>(controls.<span class="property">size</span>, controls.<span class="property">transparent</span>, controls.<span class="property">opacity</span>, controls.<span class="property">color</span>,controls.<span class="property">sizeAttenuation</span>);</span><br><span class="line">            <span class="comment">// controls.autoRotate = gui.rotateSystem;</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;size&#x27;</span>,<span class="number">0</span>,<span class="number">20</span>).<span class="title function_">onChange</span>(controls.<span class="property">redraw</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;transparent&#x27;</span>).<span class="title function_">onChange</span>(controls.<span class="property">redraw</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;opacity&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>).<span class="title function_">onChange</span>(controls.<span class="property">redraw</span>);</span><br><span class="line">    gui.<span class="title function_">addColor</span>(controls,<span class="string">&#x27;color&#x27;</span>).<span class="title function_">onChange</span>(controls.<span class="property">redraw</span>);</span><br><span class="line">    gui.<span class="title function_">add</span>(controls,<span class="string">&#x27;sizeAttenuation&#x27;</span>).<span class="title function_">onChange</span>(controls.<span class="property">redraw</span>);</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span>;</span><br><span class="line">    gui.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="string">&#x27;300px&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    controls.<span class="title function_">redraw</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> helper;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//对称轴</span></span><br><span class="line">    helper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="comment">//scene.add(helper);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//生成粒子</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSprites</span>(<span class="params">size,transparent,opacity,color,sizeAttenuation</span>)&#123;</span><br><span class="line">    <span class="comment">//将图像加载为THREE.Texture对象，之后分配给材质的map属性，进行纹理化粒子</span></span><br><span class="line">    <span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&quot;textures/particles/raindrop-3.png&quot;</span>);</span><br><span class="line">    <span class="comment">//存放粒子数据的网格</span></span><br><span class="line">    <span class="keyword">var</span> geom = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br><span class="line"></span><br><span class="line">    geom.<span class="title function_">scale</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="comment">//样式化粒子的THREE.PointsMaterial材质</span></span><br><span class="line">    <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">size</span>:size,</span><br><span class="line">        <span class="attr">transparent</span>:transparent,</span><br><span class="line">        <span class="attr">opacity</span>:opacity,</span><br><span class="line">        <span class="attr">map</span>:texture,</span><br><span class="line">        <span class="attr">blending</span>: <span class="variable constant_">THREE</span>.<span class="property">AdditiveBlending</span>,</span><br><span class="line">        <span class="attr">sizeAttenuation</span>:sizeAttenuation,</span><br><span class="line">        <span class="attr">color</span>: color,</span><br><span class="line">        <span class="comment">//保证各个位置的雨滴之间不会互相影响。隐藏雨滴纹理的黑色背景</span></span><br><span class="line">        <span class="attr">depthWrite</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> range = <span class="number">150</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">15000</span>;i++)&#123;</span><br><span class="line">        <span class="comment">//添加顶点坐标</span></span><br><span class="line">        <span class="keyword">var</span> particle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(</span><br><span class="line">            <span class="title class_">Math</span>.<span class="title function_">random</span>()*range-range/<span class="number">2</span>,</span><br><span class="line">            <span class="title class_">Math</span>.<span class="title function_">random</span>()*range*<span class="number">1.5</span>,</span><br><span class="line">            <span class="comment">// Math.random()*range-range/2, y轴乱序——画面中很多重叠雨滴之间有不太理想的叠加效果</span></span><br><span class="line">            <span class="number">1</span>+(i/<span class="number">100</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//定义粒子如何水平移动（横向运动范围-0.16~+0.16）</span></span><br><span class="line">        particle.<span class="property">velocityX</span> = (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>)/<span class="number">3</span>;</span><br><span class="line">        <span class="comment">//定义粒子下落速度（纵向运动速度范围0.1~0.3）</span></span><br><span class="line">        particle.<span class="property">velocityY</span> = <span class="number">0.1</span>+(<span class="title class_">Math</span>.<span class="title function_">random</span>() /<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        geom.<span class="property">vertices</span>.<span class="title function_">push</span>(particle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生成模型添加到场景中</span></span><br><span class="line">    cloud = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(geom,material);</span><br><span class="line">    <span class="comment">// cloud.sortParticles = true; 新版Three.js已经没有这个功能</span></span><br><span class="line">    cloud.<span class="property">name</span> = <span class="string">&quot;particle1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    scene.<span class="title function_">add</span>(cloud);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放</span></span><br><span class="line"><span class="keyword">var</span> controls2;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls2</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    controls2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>(camera, renderer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果使用animate方法时，将此函数删除</span></span><br><span class="line">    <span class="comment">//controls.addEventListener( &#x27;change&#x27;, render );</span></span><br><span class="line">    <span class="comment">// 使动画循环使用时阻尼或自转 意思是否有惯性</span></span><br><span class="line">    controls2.<span class="property">enableDamping</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//动态阻尼系数 就是鼠标拖拽旋转灵敏度</span></span><br><span class="line">    <span class="comment">//controls.dampingFactor = 0.25;</span></span><br><span class="line">    <span class="comment">//是否可以缩放</span></span><br><span class="line">    controls2.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//是否自动旋转</span></span><br><span class="line">    controls2.<span class="property">autoRotate</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//设置相机距离原点的最远距离</span></span><br><span class="line">    controls2.<span class="property">minDistance</span>  = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// //设置相机距离原点的最远距离</span></span><br><span class="line">    <span class="comment">// controls2.maxDistance  = 200;</span></span><br><span class="line">    <span class="comment">//是否开启右键拖拽</span></span><br><span class="line">    controls2.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line">    <span class="comment">//实现雨滴动画效果</span></span><br><span class="line">    <span class="keyword">var</span> vertices = cloud.<span class="property">geometry</span>.<span class="property">vertices</span>;</span><br><span class="line">    <span class="comment">//修改顶点信息，让每一个粒子的x轴和y轴的位置信息每一帧都差生一些偏差</span></span><br><span class="line">    vertices.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">v</span>) &#123;</span><br><span class="line">        v.<span class="property">y</span> = v.<span class="property">y</span> - (v.<span class="property">velocityY</span>);</span><br><span class="line">        v.<span class="property">x</span> = v.<span class="property">x</span> - (v.<span class="property">velocityX</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (v.<span class="property">y</span> &lt;= <span class="number">0</span>) v.<span class="property">y</span> = <span class="number">60</span>;</span><br><span class="line">        <span class="keyword">if</span> (v.<span class="property">x</span> &lt;= -<span class="number">20</span> || v.<span class="property">x</span> &gt;= <span class="number">20</span>) v.<span class="property">velocityX</span> = v.<span class="property">velocityX</span> * -<span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//实时更新雨滴信息</span></span><br><span class="line">    cloud.<span class="property">geometry</span>.<span class="property">verticesNeedUpdate</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnchange</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = innerWidth / innerHeight;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(innerWidth,innerHeight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initModels</span>()</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initControls2</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">animate</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnchange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="加载和使用纹理"><a href="#加载和使用纹理" class="headerlink" title="加载和使用纹理"></a>加载和使用纹理</h1><h2 id="UV贴图"><a href="#UV贴图" class="headerlink" title="UV贴图"></a>UV贴图</h2><h2 id="纹理平铺（重复）的相关属性"><a href="#纹理平铺（重复）的相关属性" class="headerlink" title="纹理平铺（重复）的相关属性"></a>纹理平铺（重复）的相关属性</h2><p>在之前学习纹理对象Texture已经介绍过纹理的wrapS、wrapT、repeat属性，它们都是用来设置纹理重复的相关属性，在来简单说一下这几个属性wrapS</p>
<ul>
<li>纹理在水平方向上纹理包裹方式，在UV映射中对应于U，默认THREE.ClampToEdgeWrapping，表示纹理边缘与网格的边缘贴合。中间部分等比缩放。还可以设置为：THREE.RepeatWrapping(重复平铺) 和 THREE.MirroredRepeatWrapping（先镜像再重复平铺）</li>
</ul>
<p>wrapT</p>
<ul>
<li>纹理贴图在垂直方向上的包裹方式，在UV映射中对应于V，默认也是THREE.ClampToEdgeWrapping，与wrapS属性一样也可以设置为：THREE.RepeatWrapping(重复平铺) 和 THREE.MirroredRepeatWrapping（先镜像再重复平铺）</li>
</ul>
<p>repeat</p>
<ul>
<li>用来设置纹理将在表面上，分别在U、V方向重复多少次。</li>
</ul>
<p>repeat属性是Vector2类型，可以使用如下语句来为它赋值</p>
<blockquote>
<p>this.cube.material.map.repeat.set(repeatX, repeatY)</p>
</blockquote>
<p>repeatX 用来指定在x轴方向上多久重复一次，repeatY用来指定在y轴方向上多久重复一次<strong>这两个变量取值范围与对应效果如下</strong></p>
<ul>
<li>如果设置等于1，则纹理不会重复</li>
<li>如果设置为 大于0小于1 的值，纹理会被放大</li>
<li>如果设置为 小于0 的值，那么会产生纹理的镜像</li>
<li>如果设置为 大于1 的值，纹理会重复平铺</li>
</ul>
<h2 id="加载纹理并应用到网格"><a href="#加载纹理并应用到网格" class="headerlink" title="加载纹理并应用到网格"></a>加载纹理并应用到网格</h2><h3 id="简介-8"><a href="#简介-8" class="headerlink" title="简介"></a>简介</h3><ol>
<li>纹理最基础的用法就是作为贴图被添加到材质上，当用这种方法创建网格时，网格的颜色就来源于纹理</li>
<li>UV贴图实质上就是指定模型上的哪一部分需要被映射到纹理的相应位置</li>
<li>可以用如下方法加载纹理</li>
</ol>
<p>var textureLoader &#x3D; new THREE.TexturenLoader();var texture &#x3D; textureLoader.load(“..&#x2F;..&#x2F;assets&#x2F;textures&#x2F;sss.jpg”);</p>
<p>使用THREE.TextureLoader()从指定位置加载图片，图片格式可以是png,jpg或jpeg</p>
<ol start="3">
<li>纹理的加载是异步的：如果纹理加载较大，而程序在文件加载完成之前开始渲染场景，那么在最开始的瞬间会看到场景中一些物体没有贴图。如果希望等待纹理加载完成。可以为THREE.TextureLoader.load()添加回调函数。</li>
</ol>
<p>var textureLoader &#x3D; new THREE.TextureLoader();var texture &#x3D; textureLoder.load(“..&#x2F;..&#x2F;assets&#x2F;textures&#x2F;sss.jpg”,onloadFunction,onProgressFunction,onErrorFunction);</p>
<p>onloadFunction在纹理加载完成时被调用，onProgressFunction可以随时汇报加载进度，onError在纹理加载出故障时被调用</p>
<ol start="4">
<li>用图片来作为纹理使用时，最好使用长宽为2的次方的正方形图片</li>
<li>纹理的放大和缩小。可以设置magFilter属性来指定纹理如何放大，minFilter来指定纹理如何缩小</li>
</ol>
<p>这两个属性的属性值可以设置如下表所示的属性值</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>THREE.NearestFilter（最邻近过滤）</td>
<td>这个过滤器会将纹理上最近的像素颜色应用于面上。在放大时，会导致方块化，在缩小时，会丢失很多细节</td>
</tr>
<tr>
<td>THREE.LinearFilter（线性过滤）</td>
<td>这个过滤器最终的颜色是由周围四个像素值决定的。在缩小时仍会丢失一些细节，但是在放大时会平滑很多，方块化也比较少一些出现</td>
</tr>
</tbody></table>
<p>也可以使用mipmap。mipmap是把纹理按照2的倍数进行缩小。mipmap纹理过滤模式如下表所示关于mipmap,<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyNDI4NDg2L2FydGljbGUvZGV0YWlscy8xMTg4NTY2OTc=" title="https://blog.csdn.net/qq_42428486/article/details/118856697">https://blog.csdn.net/qq_42428486&#x2F;article&#x2F;details&#x2F;118856697<i class="fa fa-external-link"></i></span>💡 如果没有设置magFilter和minFilter属性的值。Three.js会将THREE.LinearFilter作为magFilter属性的默认值，将THREE.LinearMipMapLinearFilter作为minFilter属性的默认值。</p>
<h3 id="案例-10"><a href="#案例-10" class="headerlink" title="案例"></a>案例</h3><h4 id="描述-7"><a href="#描述-7" class="headerlink" title="描述"></a>描述</h4><h4 id="结果-9"><a href="#结果-9" class="headerlink" title="结果"></a>结果</h4><h4 id="代码-9"><a href="#代码-9" class="headerlink" title="代码"></a>代码</h4><h3 id="自定义加载器"><a href="#自定义加载器" class="headerlink" title="自定义加载器"></a>自定义加载器</h3><p>除了使用THREE.TextureLoader方法加载标准格式图片，Three.js还提供一些自定义的加载器，用来加载其他格式的 纹理文件。</p>
<table>
<thead>
<tr>
<th>加载器</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>THREE.DDSLoader</td>
<td>该加载器可以加载DirectDraw Surface格式的纹理文件。首先要在HTML页面中引入DDSLoader.js文件，然后像下面这样加载纹理var textureLoader &#x3D; new THREE.DDSLoader();var texture &#x3D; textureLoader.load(“..&#x2F;..&#x2F;..”)</td>
</tr>
<tr>
<td>THREE.PVRLoader</td>
<td>Power VP也是一种私有版权的压缩纹理格式。Three.js支持Power VR 3.0 版本的文件。在HTML页面导入PVRLoader文件后，像下面这样加载纹理var textureLoader &#x3D; new THREE.PVRLoader();var texture &#x3D; textureLoader.load(“..&#x2F;..&#x2F;..”);💡注意不是所有设备上的浏览器都支持PVR格式。如果在桌面版Chrome浏览器中加载这种格式会在控制台看到错误信息：WEBGL_compressed_texture_pvrtc extension not supported但是这种格式在iOS系统上被广泛使用</td>
</tr>
<tr>
<td>THREE.TGALoader</td>
<td>Targa是一种在3D软件中仍被广泛使用的栅格图像格式。在HTML页面中引入TGALoader.js后，像下面这样加载纹理var textureLoader &#x3D; new THREE.TGALoader();var texture &#x3D; textureLoader.load(“..&#x2F;..&#x2F;..”);</td>
</tr>
<tr>
<td>THREE.KTXLoader</td>
<td>Khronos Texture(KTX)文件格式来自于Khronos工作组。该格式的初衷是提供一个压缩纹理格式，使其可以被WebGL直接使用，以便尽量降低处理它的额外开销。KTX格式拥有多种不同的编码，不同的硬件对编码的支持有可能不同。在HTML页面中引入KTXLoader.js文件后，像下面这样加载纹理if(renderer.extension.get(‘WEBGL_compressed_texture_astc’)!&#x3D;&#x3D;null)  return “astc”;if(renderer.extension.get(‘WEBGL_compressed_texture_etc1’)!&#x3D;&#x3D;null)  return “etc1”;if(renderer.extension.get(‘WEBGL_compressed_texture_s3tc’)!&#x3D;&#x3D;null)  return “s3tc”;if(renderer.extension.get(‘WEBGL_compressed_texture_pvrtc’)!&#x3D;&#x3D;null)  return “pvrtc”;var ktxTextureLoader &#x3D; new THREE.KTXLoader();var texture;switch(determineFormat()){case “astc”:texture &#x3D; ktxTextureLoader.load(“..&#x2F;..&#x2F;…ktx”);break;case “etc1”:texture &#x3D; ktxTextureLoader.load(“..&#x2F;..&#x2F;…ktx”);break;case “s3tc”:texture &#x3D; ktxTextureLoader.load(“..&#x2F;..&#x2F;…ktx”);break;case “pvrtc”:texture &#x3D; ktxTextureLoader.load(“..&#x2F;..&#x2F;…ktx”);break;}上述代码先查询WebGL当前支持的KTX编码，然后选择加载特定编码的KTX文件</td>
</tr>
</tbody></table>
<p>上面的纹理都是直接存储或者压缩存储的普通图片。除了这些普通图片之外，Three.js还支持HDR图像（高动态范围图像）。相比普通图片，HDR图像包含了更高的亮度范围。它的亮度范围更接近人眼的光学特征。由于HDR图像所包含的亮度范围大于屏幕所能够支持的范围，可以尝试微调Three.js对HDR图像的渲染参数，并观察渲染效果的变化。这种参数调节可以通过设置THREE.WebGLRenderer类的属性来实现。下表列出了相关属性</p>
<table>
<thead>
<tr>
<th>加载器</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>toneMapping（色调映射）</td>
<td>该属性控制Three.js如何将HDR色彩域映射到屏幕所支持的色彩域上，由如下选项可用：</td>
</tr>
<tr>
<td></td>
<td>- THREE.NoToneMapping</td>
</tr>
<tr>
<td></td>
<td>- THREE.LinearToneMapping</td>
</tr>
<tr>
<td></td>
<td>- THREE.ReinhardToneMapping</td>
</tr>
<tr>
<td></td>
<td>- THREE.Uncharted2ToneMapping</td>
</tr>
<tr>
<td></td>
<td>- THREE.CineonToneMapping</td>
</tr>
<tr>
<td></td>
<td>默认映射为THREE.LinearToneMapping</td>
</tr>
<tr>
<td>toneMappingExposure</td>
<td>该属性控制色调映射的曝光级别，可用于微调渲染场景中纹理贴图的色彩</td>
</tr>
<tr>
<td>toneMappingWhitePoint</td>
<td>该属性设置色调映射中的白点值</td>
</tr>
</tbody></table>
<p>Three.js还支持EXR和RGBE格式</p>
<table>
<thead>
<tr>
<th>加载器</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>THREE.EXRLoader</td>
<td>EXR文件是为存储HDR图像而开发的图像文件格式。在HTML页面中引引入EXRLoader.js文件后，像下面这样加载纹理var textureLoader &#x3D; new THREE.EXRloader();var texture &#x3D; textureLoader.load(“..&#x2F;..&#x2F;..”);</td>
</tr>
<tr>
<td>THREE.RGBELoader</td>
<td>RGBE文件是Radiance渲染系统的图像文件格式。在HTML页面中引入RGBELoader.js文件后，像下面这样加载纹理var hdrTextureLoader &#x3D; new THREE.RGBEloader();hdrTextureLoader.load(“..&#x2F;..&#x2F;..”,function(texture,metadata){texture.encoding &#x3D; THREE.RGBEEncoding;texture.flipY &#x3D; true;… and use the texture})加载RGBE纹理时，必须将加载器返回的纹理对象的encoding属性设定为THREE.RGBEEncoding，否则将无法正确渲染。此外还需将flipY属性设置为true，否则图像会上下颠倒。</td>
</tr>
</tbody></table>
<h2 id="使用凹凸贴图创建褶皱"><a href="#使用凹凸贴图创建褶皱" class="headerlink" title="使用凹凸贴图创建褶皱"></a>使用凹凸贴图创建褶皱</h2><h3 id="简介-9"><a href="#简介-9" class="headerlink" title="简介"></a>简介</h3><ol>
<li>凹凸贴图用于为材质添加厚度</li>
</ol>
<p><img src="/images/1667208451941-bd1ac2cf-9f02-49a9-85d5-947fb92bf19c.png"><br>与左侧墙相比右侧有更多的细节</p>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>可以通过为材质设置额外的纹理（凹凸贴图）来实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">    <span class="comment">//设置map属性</span></span><br><span class="line">    <span class="attr">map</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../../assets/textures/stone/stone.jpg&quot;</span>),</span><br><span class="line">    <span class="comment">//设置bumpMap属性</span></span><br><span class="line">    <span class="attr">bumpMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../../assets/textures/stone/stone-bump.jpg&quot;</span>),</span><br><span class="line">    <span class="attr">metalness</span>: <span class="number">0.2</span>,</span><br><span class="line">    <span class="attr">roughness</span>: <span class="number">0.07</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//可以通过设置bumpScale属性，设置凹凸的高度（如果值为负数，则表示的是深度）</span></span><br></pre></td></tr></table></figure>
<p>💡注意像素的密集程度定义的是凹凸的高度，但是凹凸图只包含像素的相对高度，没有任何倾斜的方向信息。所以使用凹凸图所能表达的深度信息是有限的，要想实现更多细节可以使用法向贴图</p>
<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="使用法向贴图创建更加细致的凹凸和褶皱"><a href="#使用法向贴图创建更加细致的凹凸和褶皱" class="headerlink" title="使用法向贴图创建更加细致的凹凸和褶皱"></a>使用法向贴图创建更加细致的凹凸和褶皱</h2><h3 id="简介-10"><a href="#简介-10" class="headerlink" title="简介"></a>简介</h3><ol>
<li>发现贴图保存的不是高度信息，而是法向量的方向。</li>
<li>使用法向贴图只需要使用很少的顶点和面就可以创建出细节很丰富的模型</li>
</ol>
<p><img src="/images/1667208921070-16eecc42-d4cb-40c4-9045-8dff09a19a19.png"><br>右侧的图像细节更加丰富。当光源围绕方块移动时，你会看到纹理对光源做出很自然的反应，这样的模型更加真实</p>
<ol start="3">
<li>纹理（左图），法向贴图（右图）</li>
</ol>
<p><img src="/images/1667267400670-539d575f-78f8-4f90-92ee-d60d8a9f6c43.png"><br><img src="/images/1667267393418-3d968190-2215-4731-a17a-360684e789bd.png"></p>
<ol start="4">
<li>使用法向贴图最大问题是它们难以创建，需要使用比如Blender和Photoshop这样的特殊工具。这些工具可以将高分辨率的效果图或者纹理作为输入来创建法向图。</li>
<li>使用法向贴图和凹凸贴图来增加物体表面细节时，不需要改变模型的实际形状；所有顶点都保持在原始位置不变。这些贴图利用场景中的光照来制造伪深度和细节。</li>
</ol>
<h3 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">    <span class="comment">//设置map属性</span></span><br><span class="line">    <span class="attr">map</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../../assets/textures/general/plaster.jpg&quot;</span>),</span><br><span class="line">    <span class="comment">//设置bumpMap属性</span></span><br><span class="line">    <span class="attr">normalMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../../assets/textures/general/plaster-normal.jpg&quot;</span>),</span><br><span class="line">    <span class="attr">metalness</span>: <span class="number">0.2</span>,</span><br><span class="line">    <span class="attr">roughness</span>: <span class="number">0.07</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//还可以设置normalScale属性为mat.normalScale.set(1,1)来指定凹凸程度，</span></span><br><span class="line"><span class="comment">//通过这两个参数，可以沿着x轴和y轴进行缩放。最好的方式是设置成一样</span></span><br></pre></td></tr></table></figure>

<h3 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="使用移位贴图来改变顶点位置"><a href="#使用移位贴图来改变顶点位置" class="headerlink" title="使用移位贴图来改变顶点位置"></a>使用移位贴图来改变顶点位置</h2><h3 id="简介-11"><a href="#简介-11" class="headerlink" title="简介"></a>简介</h3><ol>
<li>移位贴图能够根据贴图的内容，修改模型顶点，真正改变模型的形状。</li>
<li>图中越亮的颜色会使顶点移位越远。</li>
<li>除了给displacementMap属性指定纹理对象之外，displacementScale和displacementBias两个属性也可以用来控制顶点的移位程度。</li>
<li>使用移位贴图的模型必须具有大量顶点。否则其顶点移位效果看起来会与移位贴图并不相像。因为顶点过少的模型没有足够的顶点可以移动。</li>
</ol>
<h3 id="创建-2"><a href="#创建-2" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载器</span></span><br><span class="line"><span class="keyword">var</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="comment">//球体几何</span></span><br><span class="line"><span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">4</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line"><span class="comment">//球体材质</span></span><br><span class="line"><span class="keyword">var</span> sphereMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//纹理</span></span><br><span class="line">    <span class="attr">map</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/w_c.jpg&quot;</span>),</span><br><span class="line">  <span class="comment">//移位贴图</span></span><br><span class="line">    <span class="attr">displacementMap</span>: texture.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/w_d.jpg&quot;</span>),</span><br><span class="line">  <span class="comment">//金属感程度</span></span><br><span class="line">    <span class="attr">metalness</span>: <span class="number">0.2</span>,</span><br><span class="line">  <span class="comment">//粗糙程度</span></span><br><span class="line">    <span class="attr">roughness</span>: <span class="number">0.07</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-2"><a href="#完整代码-2" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="用环境光遮挡贴图实现细节阴影"><a href="#用环境光遮挡贴图实现细节阴影" class="headerlink" title="用环境光遮挡贴图实现细节阴影"></a>用环境光遮挡贴图实现细节阴影</h2><h3 id="简介-12"><a href="#简介-12" class="headerlink" title="简介"></a>简介</h3><ol>
<li>场景中总是有静止不动的物体和光源，所以投射到物体上的阴影也不会变化，因此如果能够计算一此阴影数据并在渲染时重复使用，为了做到这一点，three.js提供了两种贴图：环境光遮挡贴图和光照贴图</li>
<li><strong>环境光遮挡技术用于决定模型的哪一部分暴露于环境光之中</strong>。</li>
<li>在Blender或类似的软件中，环境光通常被当作半球光源或者平行光源来考虑</li>
<li>虽然模型的大部分表面都能接收到环境光，但是它们接受光线的多少仍然有差别（以一个站立的人物模型为例，头顶往往接收的环境光更多，而胳膊下侧则接收更少）。</li>
<li><strong>这种光照的差异可以被渲染（又称烘培）到一张纹理贴图上，然后与颜色贴图混合在一起应用到模型上。这样一来可以避免在渲染循环中重复计算光照差异。</strong></li>
<li>环境光遮挡贴图</li>
</ol>
<p><img src="/images/1667271331333-f9dd7df5-6c88-4a4e-920a-57f7270fadb0.png"></p>
<ol start="7">
<li>环境遮挡贴图的作用是指出模型上哪些部分处于阴影中，应该从环境光中接受较少的光照。与环境光遮挡贴图作用相反的是光照贴图。该贴图用来决定模型的哪些部分需要补充更多的光照。</li>
</ol>
<h3 id="创建-3"><a href="#创建-3" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="keyword">var</span> meterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStardardMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//设置aoMap属性，加载环境光遮挡贴图</span></span><br><span class="line">  	<span class="attr">aoMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/baymax/ambient.png&quot;</span>),</span><br><span class="line">  <span class="comment">//指定环境光遮挡贴图的影响程度</span></span><br><span class="line">    <span class="attr">aoMapIntensity</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">    <span class="attr">metalness</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">roughtness</span>: <span class="number">1</span>,</span><br><span class="line">  	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>💡请记住，在使用aoMap属性或者lightMap属性时，对于光照贴图来说，需要使用faceVertexUvs[1]。</p>
<blockquote>
<p>geometry.faceVertexUvs.push(geometry.faceVertexUvs[0]);</p>
</blockquote>
<h3 id="完整代码-3"><a href="#完整代码-3" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="用光照贴图产生假阴影"><a href="#用光照贴图产生假阴影" class="headerlink" title="用光照贴图产生假阴影"></a>用光照贴图产生假阴影</h2><h3 id="简介-13"><a href="#简介-13" class="headerlink" title="简介"></a>简介</h3><ol>
<li>光照贴图里面的信息用于指出一个模型的特定部分应该从场景中接收多少光照，换句话说，模型的光照信息被预先烘培到了纹理贴图中。</li>
<li>有很多3D图形软件可以用于烘培光照贴图（比如Blender）</li>
<li>下图用于渲染地面。从图中可以看出，大部分面被白色光照亮，但有一处较暗的阴影部分。</li>
</ol>
<p>（这是因为要在地面上放置一个物体，它会在其地面上遮挡部分光照）<img src="/images/1667281330336-045d5f8a-a418-49c6-901b-27f575d5d4d9.png"></p>
<ol start="4">
<li>烘培到纹理贴图中的阴影、光照以及环境光遮挡信息只能用于静态场景，或者场景中的静态物体。一旦光源或物体发生移动或者改变，就不得不实时计算阴影了</li>
</ol>
<h3 id="创建-4"><a href="#创建-4" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于</span></span><br><span class="line">plane.<span class="property">geometry</span>.<span class="property">faceVertexUvs</span>.<span class="title function_">push</span>(plane.<span class="property">geometry</span>.<span class="property">faceVertexUvs</span>[<span class="number">0</span>]);</span><br><span class="line">plane.<span class="property">material</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">  	<span class="attr">map</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/general/floor-wood.jpg&quot;</span>),</span><br><span class="line">    <span class="attr">lightMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/lightmap/lightmap.png&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-4"><a href="#完整代码-4" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="金属光泽度贴图和粗糙度贴图"><a href="#金属光泽度贴图和粗糙度贴图" class="headerlink" title="金属光泽度贴图和粗糙度贴图"></a>金属光泽度贴图和粗糙度贴图</h2><h3 id="简介-14"><a href="#简介-14" class="headerlink" title="简介"></a>简介</h3><ol>
<li>MeshStandardMaterial材质中可以用metalness和roughness两个属性来设置大部分物体的表面质感。除了可以直接用数值来设置这两个属性值之外，还可以通过纹理贴图来设置。</li>
<li>如果希望在一个表面粗糙的物体上指定一些闪亮的局部，则可以为metalnessMap属性设置一张金属质感贴图。</li>
<li>若希望在一个光滑的物体上设置一些粗糙的局部，则可以在roughnessMap属性上使用纹理贴图来实现。</li>
<li>当使用纹理贴图来设置两个属性时，在模型的具体位置上，metalness和roughness两个属性的实际值等于属性值本身与响应贴图中的值的乘积。</li>
<li>在环境贴图的基础上，金属光泽度属性值越高的物体，表面的反射越清晰，粗糙度值越高的物体，反射越浑浊。</li>
<li>如下图所示，画面中的左图在roughness属性上设置了粗糙度贴图，从而使小球锈迹斑斑。右边的小球在metalness属性上设置了金属光泽度贴图，整个球面使粗糙的，只有一些区域被磨的光亮，显示出金属表面特有的镜面反射效果。</li>
</ol>
<p><img src="/images/1667358786048-ef1773b6-4d25-4ec8-8bd7-0ae47b06ced1.png"><br>💡注意：金属光泽度属性metalness的值会先与来自metalnessMap贴图中的值相乘，粗糙度属性roughness的值则会与先来自roughnessMap贴图中的值相乘，然后再应用于物体渲染中。</p>
<h3 id="创建-5"><a href="#创建-5" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">met1.<span class="property">metalnessMap</span> = textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/engraved/roughness-map.jpg&quot;</span>);</span><br><span class="line">mat1.<span class="property">roughnessMap</span> = textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/engraved/roughness-map.jpg&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-5"><a href="#完整代码-5" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="Alpha贴图"><a href="#Alpha贴图" class="headerlink" title="Alpha贴图"></a>Alpha贴图</h2><h3 id="简介-15"><a href="#简介-15" class="headerlink" title="简介"></a>简介</h3><ol>
<li>Alpha贴图用于控制物体表面的透明度</li>
<li>贴图中的纯黑部分代表该部分表面完全透明，纯白色部分则代表完全不透明</li>
</ol>
<h3 id="创建-6"><a href="#创建-6" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sphereMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">alphaMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/alpha/partial-transparenxy.png&quot;</span>),</span><br><span class="line">  <span class="comment">//设置环境贴图</span></span><br><span class="line">  <span class="attr">envMap</span>: alternativeMap,</span><br><span class="line">  <span class="attr">metalness</span>: <span class="number">0.02</span>,</span><br><span class="line">  <span class="attr">roughness</span>: <span class="number">0.07</span>,</span><br><span class="line">  <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">  <span class="comment">//设置alphaTest属性，避免使用半透明特性时可能出现一些小斑点问题</span></span><br><span class="line">  <span class="attr">alphaTest</span>: <span class="number">0.5</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//控制纹理再模型表面的重复模式和频率</span></span><br><span class="line">sphereMaterial.<span class="property">alphaMap</span>.<span class="property">wrapS</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span>;</span><br><span class="line">sphereMaterial.<span class="property">alphaMap</span>.<span class="property">wrapT</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span>;</span><br><span class="line"><span class="comment">//当设置为（1，1）时，纹理不会重复，当设置为更高值时，纹理会被缩小，并在模型表面重复贴图</span></span><br><span class="line">sphereMaterial.<span class="property">alphaMap</span>.<span class="property">repeat</span>.<span class="title function_">set</span>(<span class="number">8</span>,<span class="number">8</span>);</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-6"><a href="#完整代码-6" class="headerlink" title="完整代码"></a>完整代码</h3><h2 id="自发光贴图"><a href="#自发光贴图" class="headerlink" title="自发光贴图"></a>自发光贴图</h2><h3 id="简介-16"><a href="#简介-16" class="headerlink" title="简介"></a>简介</h3><ol>
<li>自发光贴图是一个控制模型表面实现自发光效果的纹理贴图</li>
<li>自发光物体本身看起来闪耀光芒，但是对周围环境毫无影响。也就是说自发光特性只能单独影响物体本身，不能使该物体变成光源</li>
<li>💡注意：由于来自emissiveMap的颜色由emissive属性值调制，因此需要将该属性值设置为非0才能看见自发光贴图效果。</li>
</ol>
<h3 id="创建-7"><a href="#创建-7" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//设置emissive属性</span></span><br><span class="line">  <span class="attr">emissive</span>: <span class="number">0xffffff</span>,</span><br><span class="line">  <span class="comment">//自发光贴图</span></span><br><span class="line">  <span class="attr">emissiveMap</span>: textureLoad.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/emissive/lava.png&quot;</span>),</span><br><span class="line">  <span class="comment">//法向贴图</span></span><br><span class="line">  <span class="attr">normalMap</span>: textureLoad.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/emissive/lava-normals.png&quot;</span>),</span><br><span class="line">  <span class="comment">//金属光泽度贴图</span></span><br><span class="line">  <span class="attr">metalnessMap</span>: textureLoad.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/emissive/lava-smoothness.png&quot;</span>),</span><br><span class="line">  <span class="comment">//金属感程度</span></span><br><span class="line">  <span class="attr">metalness</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">//粗糙程度</span></span><br><span class="line">  <span class="attr">roughness</span>: <span class="number">0.4</span>,</span><br><span class="line">  <span class="attr">normalScal</span>: <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">4</span>,<span class="number">4</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="完整案例"><a href="#完整案例" class="headerlink" title="完整案例"></a>完整案例</h3><h2 id="高光贴图"><a href="#高光贴图" class="headerlink" title="高光贴图"></a>高光贴图</h2><h3 id="简介-17"><a href="#简介-17" class="headerlink" title="简介"></a>简介</h3><ol>
<li>一般情况下，在新版的three.js中THREE.MeshStandardMaterial材质是最佳选择，可以通过调节其各种属性来生成现实世界中的各种真实材质</li>
<li>若要使用高光贴图，需要使用MeshPhongMaterial材质。</li>
<li>高光贴图用于指定物体表面中哪些部分比较闪亮，或者哪部分相对暗淡。与THREE.MeshStandardMaterial材质的金属光泽度贴图和粗糙度贴图的作用有些接近</li>
</ol>
<h3 id="创建-8"><a href="#创建-8" class="headerlink" title="创建"></a>创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> earthMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//加载纹理</span></span><br><span class="line">  <span class="attr">map</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/earth/Earth.png&quot;</span>),</span><br><span class="line">  <span class="comment">//法向贴图</span></span><br><span class="line">  <span class="attr">normalMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/earth/EarthNormal.png&quot;</span>),</span><br><span class="line">  <span class="comment">//高光贴图</span></span><br><span class="line">  <span class="attr">specularMap</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/textures/earth/EarthSpec.png&quot;</span>),</span><br><span class="line">  <span class="attr">normalScale</span>: <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vertor2</span>(<span class="number">6</span>,<span class="number">6</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="完整案例-1"><a href="#完整案例-1" class="headerlink" title="完整案例"></a>完整案例</h3><p>渲染一个地球，其中使用高光贴图来生成相对闪亮的海面和相对暗淡的陆地表面</p>
<h2 id="使用环境贴图创建伪镜面效果"><a href="#使用环境贴图创建伪镜面效果" class="headerlink" title="使用环境贴图创建伪镜面效果"></a>使用环境贴图创建伪镜面效果</h2><h3 id="简介-18"><a href="#简介-18" class="headerlink" title="简介"></a>简介</h3><ol>
<li>计算镜面反射效果对CPU的消耗是非常大的，而且通常会使用光线追踪算法</li>
<li>在three.js中可以通过创建一个对象所处环境的纹理来伪装镜面反射，并将它应用到指定的对象上。</li>
</ol>
<h3 id="创建-9"><a href="#创建-9" class="headerlink" title="创建"></a>创建</h3><h3 id="案例完整代码"><a href="#案例完整代码" class="headerlink" title="案例完整代码"></a>案例完整代码</h3><h2 id="自定义UV映射"><a href="#自定义UV映射" class="headerlink" title="自定义UV映射"></a>自定义UV映射</h2><h2 id="重复纹理"><a href="#重复纹理" class="headerlink" title="重复纹理"></a>重复纹理</h2><h3 id="简介-19"><a href="#简介-19" class="headerlink" title="简介"></a>简介</h3><ol>
<li><p>需要保证将纹理的包裹属性设置为THREE.RepeatWrapping</p>
<blockquote>
<p>cube.material.map.wrapS &#x3D; THREE.RepeatWrapping;<br>cube.material.map.wrapT &#x3D; THREE.RepeatWrapping;</p>
</blockquote>
</li>
<li><p>wrapS属性定义的是纹理沿x轴方向的行为，wrapT是沿y轴方向的行为。three.js为这些属性提供了如下两个选项</p>
</li>
</ol>
<ul>
<li>THREE.RepeatWrapping 允许纹理重复自己</li>
<li>THREE.ClampToEdgeWrapping 是属性的默认值，纹理的整体不会重复，只会重复纹理边缘的像素来填满剩下的空间。</li>
</ul>
<ol start="3">
<li>如果设置了THREE.RepeatWrapping，可以通过以下代码设置repeat属性<blockquote>
<p>cube.material.map.repeat.set(repeatX,repeatY);</p>
</blockquote>
</li>
</ol>
<ul>
<li>变量repeatX用来指定纹理在x轴方向多久重复一次</li>
<li>变量repeatY用来指定纹理在y轴方向多久重复一次</li>
<li>如果变量的值为1，那么纹理不会重复</li>
<li>如果变量的值大于1，纹理开始重复</li>
<li>如果变量的值小于1，纹理被放大</li>
<li>如果变量的值为负数，会产生一个纹理的镜像</li>
</ul>
<ol start="4">
<li>当修改repeat属性时，three.js会自动更新纹理，并使用新的值来进行渲染</li>
<li>如果将值从THREE.RepeatWrapping改为THREE.ClampToEdgeWrapping，需要明确的更新纹理<blockquote>
<p>cube.material.map.needsUpdate &#x3D; true;</p>
</blockquote>
</li>
</ol>
<h2 id="在画布上绘制图案并作为纹理"><a href="#在画布上绘制图案并作为纹理" class="headerlink" title="在画布上绘制图案并作为纹理"></a>在画布上绘制图案并作为纹理</h2><h3 id="将画布作为纹理"><a href="#将画布作为纹理" class="headerlink" title="将画布作为纹理"></a>将画布作为纹理</h3><p>如何在画布上创建简单纹理，并应用到网格</p>
<h4 id="简介-20"><a href="#简介-20" class="headerlink" title="简介"></a>简介</h4><ol>
<li><p>需要使用Literally库（<span class="exturl" data-url="aHR0cDovL2xpdGVyYWxseWNhbnZhcy5jb20vJUVGJUJDJTg5JUU2JTlEJUE1JUU1JTg4JTlCJUU1JUJCJUJBJUU0JUI4JTgwJUU0JUI4JUFBJUU0JUJBJUE0JUU0JUJBJTkyJUU1JUJDJThGJUU3JTk0JUJCJUU1JUI4JTgz" title="http://literallycanvas.com/%EF%BC%89%E6%9D%A5%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%94%BB%E5%B8%83">http://literallycanvas.com/）来创建一个交互式画布<i class="fa fa-external-link"></i></span></p>
</li>
<li><p>创建一个画布元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;fs-container&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;canvas-output&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>  </span><br><span class="line">&lt;/div&gt;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas-output&quot;</span>).<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">$(<span class="string">&quot;#canvas-output&quot;</span>).<span class="title function_">literallycanvas</span>(&#123;<span class="attr">imageURLPrefix</span>:<span class="string">&quot;../libs/other/literally/img&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将画布上绘制的结果作为输入创建一个纹理（在创建纹理时将画布元素的引用作为参数传递给纹理对象的构造函数new THREE.Texture(canvas)）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Texture</span>(canvas);</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后需要做的是在渲染时更新材质，这样画布上的内容就会显示在物体上。</p>
</li>
</ol>
<p>（为了告知three.js我们需要更新材质，需要将纹理的needsUpdate属性设置为true）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">	renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">	<span class="comment">// 渲染时更新材质</span></span><br><span class="line">  cube.<span class="property">material</span>.<span class="property">map</span>.<span class="property">needsUpdate</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整案例代码"><a href="#完整案例代码" class="headerlink" title="完整案例代码"></a>完整案例代码</h4><h3 id="将画布用作凹凸贴图"><a href="#将画布用作凹凸贴图" class="headerlink" title="将画布用作凹凸贴图"></a>将画布用作凹凸贴图</h3><h2 id="将视频输出作为纹理"><a href="#将视频输出作为纹理" class="headerlink" title="将视频输出作为纹理"></a>将视频输出作为纹理</h2><h1 id="创建动画和移动摄像机"><a href="#创建动画和移动摄像机" class="headerlink" title="创建动画和移动摄像机"></a>创建动画和移动摄像机</h1><h2 id="简单动画"><a href="#简单动画" class="headerlink" title="简单动画"></a>简单动画</h2><h3 id="简介-21"><a href="#简介-21" class="headerlink" title="简介"></a>简介</h3><ol>
<li>可以通过改变物体的旋转，位置，缩放，材质等属性来实现动画</li>
<li>以下案例实现简单动画（方块旋转动画，小球弹跳动画，圆柱缩放动画）</li>
</ol>
<h3 id="案例完整代码-1"><a href="#案例完整代码-1" class="headerlink" title="案例完整代码"></a>案例完整代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//场景</span></span><br><span class="line"><span class="keyword">var</span> scene;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initScene</span>(<span class="params"></span>) &#123;</span><br><span class="line">    scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//摄像机</span></span><br><span class="line"><span class="keyword">var</span> camera;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCamera</span>(<span class="params"></span>) &#123;</span><br><span class="line">    camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>,<span class="number">0.1</span>,<span class="number">1000</span>);</span><br><span class="line">    camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">30</span>,<span class="number">40</span>,<span class="number">30</span>);</span><br><span class="line">    camera.<span class="title function_">lookAt</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    scene.<span class="title function_">add</span>(camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染器</span></span><br><span class="line"><span class="keyword">var</span> renderer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();</span><br><span class="line">    renderer.<span class="title function_">setClearColor</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x000000</span>));</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光源</span></span><br><span class="line"><span class="keyword">var</span> ambientLight,spotLight;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLight</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//环境光</span></span><br><span class="line">    ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0x444444</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line">    <span class="comment">//聚光源</span></span><br><span class="line">    spotLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(<span class="number">0xffffff</span>);</span><br><span class="line">    <span class="comment">//光源位置</span></span><br><span class="line">    spotLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>);</span><br><span class="line">    <span class="comment">//阴影映射宽度</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="property">width</span> = <span class="number">2048</span>;</span><br><span class="line">    <span class="comment">//阴影映射高度</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="property">height</span> = <span class="number">2048</span>;</span><br><span class="line">    <span class="comment">// 投影视场</span></span><br><span class="line">    spotLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">fov</span> = <span class="number">150</span>;</span><br><span class="line">    <span class="comment">//开启光源投影</span></span><br><span class="line">    spotLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//将光源添加至场景中</span></span><br><span class="line">    scene.<span class="title function_">add</span>(spotLight);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模型</span></span><br><span class="line"><span class="keyword">var</span> axes,plane,cube,sphere,cylinder;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//坐标轴</span></span><br><span class="line">    axes = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="comment">// scene.add(axes);</span></span><br><span class="line">    <span class="comment">//平面</span></span><br><span class="line">    <span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">20</span>,<span class="number">60</span>);</span><br><span class="line">    <span class="keyword">var</span> planeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">       <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,planeMaterial);</span><br><span class="line">    plane.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="number">0.5</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">    plane.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    plane.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(plane);</span><br><span class="line">    <span class="comment">//方块</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">       <span class="attr">color</span>: <span class="number">0xff0000</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,cubeMaterial);</span><br><span class="line">    cube.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">3</span>,<span class="number">20</span>);</span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line">    <span class="comment">//球体</span></span><br><span class="line">    <span class="keyword">var</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">4</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">var</span> sphereMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">       <span class="attr">color</span>: <span class="number">0x0000ff</span>,</span><br><span class="line">        <span class="attr">metalness</span>: <span class="number">0.05</span>,</span><br><span class="line">        <span class="attr">roughness</span>: <span class="number">0.07</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphereGeometry,sphereMaterial);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">4</span>,-<span class="number">20</span>);</span><br><span class="line">    sphere.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(sphere);</span><br><span class="line">    <span class="comment">//圆柱</span></span><br><span class="line">    <span class="keyword">var</span> cylinderGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CylinderGeometry</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">var</span> cylinderMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">       <span class="attr">color</span>: <span class="number">0x00ff00</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    cylinder = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cylinderGeometry,cylinderMaterial);</span><br><span class="line">    cylinder.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">    cylinder.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">    scene.<span class="title function_">add</span>(cylinder);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//GUI控制</span></span><br><span class="line"><span class="keyword">var</span> animation;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initGUI</span>(<span class="params"></span>)&#123;</span><br><span class="line">    animation = <span class="keyword">new</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rotationSpeed</span> = <span class="number">0.02</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bouncingSpeed</span> = <span class="number">0.03</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scalingSpeed</span> = <span class="number">0.03</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> gui = <span class="keyword">new</span> dat.<span class="title function_">GUI</span>();</span><br><span class="line">    gui.<span class="title function_">add</span>(animation,<span class="string">&#x27;rotationSpeed&#x27;</span>,<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">0.001</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">       animation.<span class="property">rotationSpeed</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="title function_">add</span>(animation,<span class="string">&#x27;bouncingSpeed&#x27;</span>,<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">0.001</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        animation.<span class="property">bouncingSpeed</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">    gui.<span class="title function_">add</span>(animation,<span class="string">&#x27;scalingSpeed&#x27;</span>,<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">0.001</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        animation.<span class="property">scalingSpeed</span> = e;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//场景缩放控制移动</span></span><br><span class="line"><span class="keyword">var</span> controls;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initControls</span>(<span class="params"></span>)&#123;</span><br><span class="line">    controls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>(camera,renderer.<span class="property">domElement</span>);</span><br><span class="line">    controls.<span class="property">enablePan</span> = <span class="literal">true</span>;</span><br><span class="line">    controls.<span class="property">enableZoom</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//页面响应式布局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">windowOnresize</span>(<span class="params"></span>)&#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerWidth</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化性能插件</span></span><br><span class="line"><span class="keyword">var</span> stats;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initStats</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;webgl-output&quot;</span>).<span class="title function_">appendChild</span>(stats.<span class="property">domElement</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//渲染</span></span><br><span class="line"><span class="keyword">var</span> step = <span class="number">0</span>,scalingStep = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line">    <span class="comment">//旋转方块</span></span><br><span class="line">    cube.<span class="property">rotation</span>.<span class="property">x</span> += animation.<span class="property">rotationSpeed</span>;</span><br><span class="line">    cube.<span class="property">rotation</span>.<span class="property">y</span> += animation.<span class="property">rotationSpeed</span>;</span><br><span class="line">    cube.<span class="property">rotation</span>.<span class="property">z</span> += animation.<span class="property">rotationSpeed</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//小球弹跳</span></span><br><span class="line">    step += animation.<span class="property">bouncingSpeed</span>;</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="property">z</span> = -<span class="number">10</span>+<span class="number">10</span>*<span class="title class_">Math</span>.<span class="title function_">cos</span>(step);</span><br><span class="line">    sphere.<span class="property">position</span>.<span class="property">y</span> = <span class="number">4</span>+<span class="number">10</span>*<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">sin</span>(step));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//圆柱缩放</span></span><br><span class="line">    scalingStep += animation.<span class="property">scalingSpeed</span>;</span><br><span class="line">    <span class="keyword">var</span> scaleX = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">sin</span>(scalingStep/<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">var</span> scaleY = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">cos</span>(scalingStep/<span class="number">5</span>));</span><br><span class="line">    <span class="keyword">var</span> scaleZ = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">sin</span>(scalingStep/<span class="number">7</span>));</span><br><span class="line">    cylinder.<span class="property">scale</span>.<span class="title function_">set</span>(scaleX,scaleY,scaleZ);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(render);</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">initScene</span>();</span><br><span class="line">    <span class="title function_">initStats</span>();</span><br><span class="line">    <span class="title function_">initCamera</span>();</span><br><span class="line">    <span class="title function_">initRenderer</span>();</span><br><span class="line">    <span class="title function_">initLight</span>();</span><br><span class="line">    <span class="title function_">initModels</span>();</span><br><span class="line">    <span class="title function_">initControls</span>();</span><br><span class="line">    <span class="title function_">initGUI</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onresize</span> = windowOnresize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="如何使用鼠标选择场景中的对象"><a href="#如何使用鼠标选择场景中的对象" class="headerlink" title="如何使用鼠标选择场景中的对象"></a>如何使用鼠标选择场景中的对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> projector = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Projector</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onDocumentMouseDown</span>(<span class="params">event</span>)&#123;</span><br><span class="line">  <span class="comment">// 首先基于屏幕的点击位置创建一个THREE.Vector3向量</span></span><br><span class="line">  <span class="keyword">var</span> vector = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>((event.<span class="property">clientX</span> / <span class="variable language_">window</span>.<span class="property">innerWidth</span>)*<span class="number">2</span>-<span class="number">1</span>,-(event.<span class="property">clientY</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>)*<span class="number">2</span>+<span class="number">1</span>,<span class="number">0.5</span>);</span><br><span class="line">  <span class="comment">// 使用vector.unproject方法将屏幕坐标转换成三维场景中的坐标</span></span><br><span class="line">  vector = vector.<span class="title function_">unproject</span>(camera);</span><br><span class="line">  <span class="comment">// 创建THREE.Raycaster.</span></span><br><span class="line">  <span class="keyword">var</span> raycaster = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Raycaster</span>(camera.<span class="property">position</span>,vector.<span class="title function_">sub</span>(camera.<span class="property">position</span>).<span class="title function_">normalize</span>());</span><br><span class="line">  <span class="keyword">var</span> intersects = raycaster.<span class="title function_">intersectObjects</span>([sphere,cylinder,cube]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(intersects.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(intersects[<span class="number">0</span>]);</span><br><span class="line">    intersects[<span class="number">0</span>].<span class="property">object</span>.<span class="property">material</span>.<span class="property">transparent</span> = <span class="literal">true</span>;</span><br><span class="line">    intersects[<span class="number">0</span>].<span class="property">object</span>.<span class="property">material</span>.<span class="property">opacity</span> = <span class="number">0.1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousdown&quot;</span>,onDocumentMouseDown,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h2 id="使用Tween-js实现动画"><a href="#使用Tween-js实现动画" class="headerlink" title="使用Tween.js实现动画"></a>使用Tween.js实现动画</h2><h3 id="简介-22"><a href="#简介-22" class="headerlink" title="简介"></a>简介</h3><ol>
<li>Tween.js是一个轻量级的JavaScript库，可以从<span class="exturl" data-url="aHR0cDovL2dpdGh1Yi5jb20vc29sZS90d2Vlbi5qcy8lRTQlQjglOEIlRTglQkQlQkQ=" title="http://github.com/sole/tween.js/%E4%B8%8B%E8%BD%BD">http://github.com/sole/tween.js/下载<i class="fa fa-external-link"></i></span></li>
<li>通过这个库可以很容易地实现某个属性在两个值之间进行过度，起始值和结束值的所有中间值都会自动计算出来，tweening补间。</li>
<li>例如，你可以使用这个值将网格的x轴坐标值在10秒内从10递减到3<blockquote>
<p>var tween &#x3D; new THREE.Tween({x:10}).to({x:3},1000)<br>.easing(TWEEN.Easing.Elastic.Inout)<br>.onUpdate(function(){<br>&#x2F;&#x2F;update the mesh<br>})</p>
</blockquote>
</li>
</ol>
<h2 id="摄像机控件"><a href="#摄像机控件" class="headerlink" title="摄像机控件"></a>摄像机控件</h2><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>第一视角控制器（FirstPersonControls）</td>
<td>该控制器的行为类似第一视角射击游戏中的摄像机，使用键盘移动，使用鼠标转动</td>
</tr>
<tr>
<td>飞行控制器（FlyControls）</td>
<td>飞行模拟控制器，用键盘和鼠标控制摄像机的移动</td>
</tr>
<tr>
<td>翻滚控制器（RollControls）</td>
<td>该控制器是飞行控制器的简化版，允许绕着z轴旋转</td>
</tr>
<tr>
<td>轨迹球控制器（TrackBallControls）</td>
<td>最常用的控制器，可以使用鼠标或者控制球来移动，平移和缩放场景。如果你使用的是OrtographicCamera，可以使用OrtographicTrack Ballcontrols，它是这个摄像机类型专用的</td>
</tr>
<tr>
<td>轨道控制器（OrbitControls）</td>
<td>该控件可以在特定的场景中模拟轨道中的卫星，可以使用鼠标和键盘在场景中游走</td>
</tr>
</tbody></table>
<h3 id="轨迹球控制器（TrackBallControls）"><a href="#轨迹球控制器（TrackBallControls）" class="headerlink" title="轨迹球控制器（TrackBallControls）"></a>轨迹球控制器（TrackBallControls）</h3><ol>
<li><p>使用TrackBallControls控制器时，先在HTML页面引入对应的JavaScript文件</p>
<blockquote>
<script type="text/javascript" src="../assets/libs/three/controls/TrackballControls.js"></script>
</blockquote>
</li>
<li><p>创建控制器，并绑定到摄像机上</p>
<blockquote>
<p>var trackballControls &#x3D; new THREE.TrackballControls(camera);<br>trackballControls.rotateSpeed &#x3D; 1.0;    &#x2F;&#x2F;旋转速度，默认值1.0<br>trackballControls.zoomSpedd &#x3D; 1.0;	&#x2F;&#x2F;缩放速度，默认值1.2<br>trackballControls.panSpeed &#x3D; 1.0;	&#x2F;&#x2F;平移速度，默认值是0.3</p>
</blockquote>
</li>
<li><p>摄像机的位置更新</p>
<blockquote>
<p>var clock &#x3D; new THREE.Clock();<br>function render(){<br>var delta &#x3D; clock.getDelta();   &#x2F;&#x2F;调用clock.getDelta()方法可以精确的计算出此次调用距离上次调用的时间间隔<br>trackballControls.update(delta); 	 &#x2F;&#x2F;更新控制器，常被用在动画循环中。<br>requestAnimationFrame(render);<br>webGLRender.render(scene,camera);<br>}</p>
</blockquote>
</li>
</ol>
<h3 id="飞行控制器（FlyControls）"><a href="#飞行控制器（FlyControls）" class="headerlink" title="飞行控制器（FlyControls）"></a>飞行控制器（FlyControls）</h3><ol>
<li><p>使用飞行控制器可以像飞行模拟器一样在场景中飞行</p>
</li>
<li><p>首先需要在HTML页面中加载对于的JavaScript文件</p>
</li>
<li><p>创建控制器并绑定到摄像机上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flyControls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">FlyControls</span>(camera);</span><br><span class="line">flyControls.<span class="property">movementSpeed</span> = <span class="number">25</span>;  <span class="comment">//移动速度，默认为1。</span></span><br><span class="line">flyControls.<span class="property">domElement</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#webgl-output&#x27;</span>); </span><br><span class="line"><span class="comment">//该 HTMLDOMElement 用于监听鼠标/触摸事件</span></span><br><span class="line">flyControls.<span class="property">rollSpeed</span> = <span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">24</span>;  <span class="comment">//旋转速度。默认为0.005</span></span><br><span class="line">flyControls.<span class="property">autoForward</span> = <span class="literal">true</span>;  <span class="comment">//若该值设为true，初始变换后，摄像机将自动向前移动（且不会停止）默认为false</span></span><br><span class="line">flyControls.<span class="property">dragToLook</span> = <span class="literal">false</span>;  <span class="comment">//若该值设为true，你将只能通过执行拖拽交互来环视四周。默认为false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>摄像机的位置更新</p>
</li>
</ol>
<h3 id="第一视角控制器（FirstPersonControls）"><a href="#第一视角控制器（FirstPersonControls）" class="headerlink" title="第一视角控制器（FirstPersonControls）"></a>第一视角控制器（FirstPersonControls）</h3><ol>
<li><p>通过第一视角控制器可以像第一视角射击游戏那样控制摄像机。鼠标用于控制视角，键盘用于控制移动角色</p>
</li>
<li><p>同样先引入对应的JavaScript文件，然后创建控制器并绑定摄像机</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fpControls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">FirstPersonControls</span>(camera);</span><br><span class="line">fpControls.<span class="property">lookSpeed</span> = <span class="number">0.4</span>;</span><br><span class="line">fpControls.<span class="property">movementSpeed</span> = <span class="number">20</span>;</span><br><span class="line">fpControls.<span class="property">lookVertical</span> = <span class="literal">true</span>;</span><br><span class="line">fpControls.<span class="property">constrainVertical</span> = <span class="literal">true</span>;</span><br><span class="line">fpControls.<span class="property">verticalMin</span> = <span class="number">1.0</span>;</span><br><span class="line">fpControls.<span class="property">verticalMax</span> = <span class="number">2.0</span>;</span><br><span class="line">fpControls.<span class="property">lon</span> = -<span class="number">150</span>;</span><br><span class="line">fpControls.<span class="property">lat</span> = <span class="number">120</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>摄像机的位置更新</p>
</li>
</ol>
<h3 id="轨道控制器（OrbitControls）"><a href="#轨道控制器（OrbitControls）" class="headerlink" title="轨道控制器（OrbitControls）"></a>轨道控制器（OrbitControls）</h3><ol>
<li>轨道控制器可以用于控制场景中的对象围绕场景中心旋转和平移。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在HTML中先引入对应的JavaScript文件</span></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javaScript&quot;</span> asrc=<span class="string">&quot;../assets/libs/three/controls/OrbitControls&quot;</span>&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 创建控制器并绑定摄像机</span></span><br><span class="line"><span class="keyword">var</span> orbitControls = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrbitControls</span>(camera);</span><br><span class="line"><span class="comment">// 设置摄像机属性</span></span><br><span class="line">orbitControls.<span class="property">autoRotate</span> = <span class="literal">true</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 摄像机的位置更新</span></span><br><span class="line"><span class="keyword">var</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">  orbitControls.<span class="title function_">update</span>(clock.<span class="title function_">getDelta</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="变形动画和骨骼动画"><a href="#变形动画和骨骼动画" class="headerlink" title="变形动画和骨骼动画"></a>变形动画和骨骼动画</h2><ul>
<li>变形动画<ul>
<li>使用变形动画，需要定义网格变形之后的状态，或者是关键位置</li>
<li>对于变形目标，所有顶点位置都会被存储下来。</li>
<li>所需要做的事将所有顶点从一个位置移动到另一个定义好的关键位置，并重复该过程</li>
</ul>
</li>
<li>骨骼动画<ul>
<li>使用骨骼动画时需要定义骨骼，也就是网格的骨头，并把顶点绑定到特定的骨头上。</li>
<li>当你移动一块骨头时，任何与其相连的骨头都会做相应的移动，同时骨头上绑定的顶点也会随之移动</li>
<li>网格的变形也是基于骨头的位置、移动和缩放实现的</li>
</ul>
</li>
</ul>
<h3 id="用变形目标创建动画"><a href="#用变形目标创建动画" class="headerlink" title="用变形目标创建动画"></a>用变形目标创建动画</h3><p>变形目标时实现动画的最直接方式。可以为所有顶点定义一系列的关键位置（也称关键帧），然后让Three.js将这些顶点动一个位置移动到另一个位置。这种方法对大型网格和大型动画来说，模型文件会变得非常大，因为在每个关键帧的位置，所有顶点的位置都需要重复存储一遍。</p>
<h4 id="使用混合器和变形目标创建动画"><a href="#使用混合器和变形目标创建动画" class="headerlink" title="使用混合器和变形目标创建动画"></a>使用混合器和变形目标创建动画</h4><p>Three.js的三个核心动画类</p>
<ol>
<li>THREE.AnimationClip（动画片段）：<ol>
<li>当具有动画数据的模型被加载的时候，这个模型对象往往具有一个名为animations的成员对象。该对象包含了一个THREE.AnimationClip对象集合</li>
<li>一个模型所包含的THREE.AnimationClip对象通常保存有某种特定类型的动画数据，或者时该模型能够执行的某种动作。</li>
<li>比如当加载一个鸟模型时，它可能包含了两个THREE.AnimationClip对象，一个保存了拍打翅膀的作用，另一个保存了张嘴闭嘴的作用。</li>
</ol>
</li>
<li>THREE.AnimationMixer（动画混合器）：<ol>
<li>THREE.AnimationMixer对象用于控制多个THREE.AnimationClip对象，确保这些动画在适当的时间发生，使动画同步或者控制从一个动画过度到另一个动画。</li>
<li>主要方法为：</li>
</ol>
</li>
</ol>
<p>mixer &#x3D; new THREE.AnimationMixer(mesh);&#x2F;&#x2F;通过mesh获取到AnimationMixer对象action  &#x3D; mixer.clipAction(clip);&#x2F;&#x2F;用clipAction方法生成可以控制执行动画的实例</p>
<ol start="3">
<li>THREE.AnimationAction（动画行为）：<ol>
<li>当向THREE.AnimationMixer对象添加一个THREE.AnimationClip对象时，调用者会获得一个THREE.AnimationAction。</li>
<li>很多动画控制功能是通过THREE.AnimationAction 调用的，而THREE.AnimationMixer并没有提供很全面的控制接口。</li>
</ol>
</li>
</ol>
<p>实例（马的奔跑运动）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">JSON</span>Loader();</span><br><span class="line"><span class="keyword">var</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>();</span><br><span class="line"><span class="keyword">var</span> mesh,clipAction,frameMesh;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&#x27;../assets/models/horse/horse.js&#x27;</span>, <span class="keyword">function</span> (<span class="params">geometry, mat</span>) &#123;</span><br><span class="line">    <span class="comment">// 通过将每个顶点法线计算为共享该顶点的所有面的面法线的平均值来“平滑”顶点法线</span></span><br><span class="line">        geometry.<span class="title function_">computeVertexNormals</span>();</span><br><span class="line">      <span class="comment">// 确保在动画过程中three.js有正确的光照数据来渲染模型</span></span><br><span class="line">        geometry.<span class="title function_">computeMorphNormals</span>();</span><br><span class="line">    	<span class="comment">// 定义模型材质</span></span><br><span class="line">        <span class="keyword">var</span> mat = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">          <span class="comment">// 如果为false，则没有动画效果</span></span><br><span class="line">            <span class="attr">morphTargets</span>:<span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 颜色</span></span><br><span class="line">            <span class="attr">vertexColors</span>:<span class="variable constant_">THREE</span>.<span class="property">FaceColors</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry,mat);</span><br><span class="line">        mesh.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.15</span>,<span class="number">0.15</span>,<span class="number">0.15</span>);</span><br><span class="line">        mesh.<span class="title function_">translateY</span>(-<span class="number">10</span>);</span><br><span class="line">        mesh.<span class="title function_">translateX</span>(<span class="number">20</span>);</span><br><span class="line">        mesh.<span class="property">rotation</span>.<span class="property">y</span> = -<span class="number">0.3</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//坐标轴</span></span><br><span class="line">        <span class="comment">// scene.add(new THREE.AxesHelper(50));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//为加载后的模型创建一个THREE.AnimationMixer对象</span></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(mesh);</span><br><span class="line">        <span class="keyword">var</span> animationClip = geometry.<span class="property">animations</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//用mixer.clipAction方法播放模型包含的第一个动画</span></span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(animationClip).<span class="title function_">play</span>();</span><br><span class="line">        <span class="comment">//加快所有被控制的动画速度</span></span><br><span class="line">        mixer.<span class="property">timeScale</span> = <span class="number">10</span>;</span><br><span class="line">        <span class="comment">//加快当前动画速度</span></span><br><span class="line">        clipAction.<span class="property">timeScale</span> = <span class="number">10</span>;</span><br><span class="line">        clipAction.<span class="property">effectiveTimeScale</span> = <span class="number">10</span>;</span><br><span class="line">        clipAction.<span class="title function_">setLoop</span>(<span class="variable constant_">THREE</span>.<span class="property">LoopRepeat</span>);</span><br><span class="line">        scene.<span class="title function_">add</span>(mesh);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后需要更新mixer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line">    controls.<span class="title function_">update</span>(clock.<span class="title function_">getDelta</span>());</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(render);</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(mixer)&#123;</span><br><span class="line">        mixer.<span class="title function_">update</span>(clock.<span class="title function_">getDelta</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>💡必须用mixer.update（delta）的形式去调用update函数，以便告诉混合器此次渲染和上次渲染的时间差</p>
<h4 id="使用多个THREE-AnimationClip对象"><a href="#使用多个THREE-AnimationClip对象" class="headerlink" title="使用多个THREE.AnimationClip对象"></a>使用多个THREE.AnimationClip对象</h4><p>实例（立方体的放大与缩小动画）手动创建两个动画，第一段动画：将立方体的尺寸从（2，2，2）变为（2，20，2）第二段动画：将立方体尺寸从（2，2，2）变为（40，2，2）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载模型</span></span><br><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">JSON</span>Loader();</span><br><span class="line"><span class="keyword">var</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>();</span><br><span class="line"><span class="keyword">var</span> mesh,clipAction1,clipAction2,animationClip1,animationClip2;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//设置立方体初始大小（原始变形目标）</span></span><br><span class="line">    <span class="keyword">var</span> cubeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//设置立方体材质</span></span><br><span class="line">    <span class="keyword">var</span> cubeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">       <span class="attr">morphTargets</span>:<span class="literal">true</span>,</span><br><span class="line">       <span class="attr">color</span>: <span class="number">0xff0000</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//设置立方体变形目标的大小</span></span><br><span class="line">    <span class="keyword">var</span> cubeTarget1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">2</span>,<span class="number">20</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">var</span> cubeTarget2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">40</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//将三个变形目标添加到原始立方体的morphTargets属性中</span></span><br><span class="line">    cubeGeometry.<span class="property">morphTargets</span>[<span class="number">0</span>] = &#123;<span class="attr">name</span>:<span class="string">&#x27;t1&#x27;</span>,<span class="attr">vertices</span>:cubeGeometry.<span class="property">vertices</span>&#125;;</span><br><span class="line">    cubeGeometry.<span class="property">morphTargets</span>[<span class="number">1</span>] = &#123;<span class="attr">name</span>:<span class="string">&#x27;t2&#x27;</span>,<span class="attr">vertices</span>:cubeTarget1.<span class="property">vertices</span>&#125;;</span><br><span class="line">    cubeGeometry.<span class="property">morphTargets</span>[<span class="number">2</span>] = &#123;<span class="attr">name</span>:<span class="string">&#x27;t3&#x27;</span>,<span class="attr">vertices</span>:cubeTarget2.<span class="property">vertices</span>&#125;;</span><br><span class="line">    <span class="comment">//在动画过程中确保有正确的光照渲染模型</span></span><br><span class="line">    cubeGeometry.<span class="title function_">computeMorphNormals</span>();</span><br><span class="line">    <span class="comment">//创建立方体</span></span><br><span class="line">    <span class="keyword">var</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cubeGeometry,cubeMaterial);</span><br><span class="line">    <span class="comment">//设置立方体位置</span></span><br><span class="line">    cube.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//添加立方体到场景中</span></span><br><span class="line">    scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//为加载后的模型创建一个THREE.AnimationMixer对象</span></span><br><span class="line">    mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(cube);</span><br><span class="line">    <span class="comment">//用CreateFromMorphTargetSequence函数创建AnimationClip动画的两个对象</span></span><br><span class="line">    <span class="comment">//第一个动画从变形目标morphTargets[0]到变形目标morphTargets[1].</span></span><br><span class="line">    animationClip1 = <span class="variable constant_">THREE</span>.<span class="property">AnimationClip</span>.<span class="title class_">CreateFromMorphTargetSequence</span>(</span><br><span class="line">        <span class="string">&#x27;first&#x27;</span>,</span><br><span class="line">        [cubeGeometry.<span class="property">morphTargets</span>[<span class="number">0</span>],cubeGeometry.<span class="property">morphTargets</span>[<span class="number">1</span>]], <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//第二个动画从变形目标morphTargets[0]到变形目标morphTargets[2].</span></span><br><span class="line">    animationClip2 = <span class="variable constant_">THREE</span>.<span class="property">AnimationClip</span>.<span class="title class_">CreateFromMorphTargetSequence</span>(</span><br><span class="line">        <span class="string">&#x27;second&#x27;</span>,</span><br><span class="line">        [cubeGeometry.<span class="property">morphTargets</span>[<span class="number">0</span>],cubeGeometry.<span class="property">morphTargets</span>[<span class="number">2</span>]], <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//用clipAction方法播放动画</span></span><br><span class="line">    clipAction1 = mixer.<span class="title function_">clipAction</span>(animationClip1).<span class="title function_">play</span>();</span><br><span class="line">    clipAction2 = mixer.<span class="title function_">clipAction</span>(animationClip2).<span class="title function_">play</span>();</span><br><span class="line">    <span class="comment">//加快动画播放速度</span></span><br><span class="line">    mixer.<span class="property">timeScale</span> = <span class="number">10</span>;</span><br><span class="line">    clipAction1.<span class="property">timeScale</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用骨骼和蒙皮创建动画"><a href="#用骨骼和蒙皮创建动画" class="headerlink" title="用骨骼和蒙皮创建动画"></a>用骨骼和蒙皮创建动画</h3><ol>
<li>当使用骨骼创建动画时，移动骨骼，three.js需要决定如何相应的移动相应的皮肤（一系列顶点）</li>
</ol>
<p>案例一个手模型，上面有几块骨头，通过移动这几块骨头，就可以让整个模型动起来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mesh;</span><br><span class="line"><span class="comment">// 模型加载</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">    loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">JSON</span>Loader();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/hand/hand-1.js&quot;</span>,<span class="keyword">function</span> (<span class="params">geometry,amt</span>)&#123;</span><br><span class="line">      <span class="comment">// 设置模型材质</span></span><br><span class="line">       <span class="keyword">var</span> mat = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">         <span class="comment">// 颜色</span></span><br><span class="line">           <span class="attr">color</span>:<span class="number">0xF0C8C9</span>,</span><br><span class="line">         <span class="comment">// 开启骨头运动</span></span><br><span class="line">           <span class="attr">skinning</span>:<span class="literal">true</span>,</span><br><span class="line">       &#125;);</span><br><span class="line">       mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SkinnedMesh</span>(geometry,mat);</span><br><span class="line">      <span class="comment">// 模型的大小位置</span></span><br><span class="line">       mesh.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>);</span><br><span class="line">       mesh.<span class="property">position</span>.<span class="property">x</span> = -<span class="number">5</span>;</span><br><span class="line">       mesh.<span class="title function_">rotateX</span>(<span class="number">0.5</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">       mesh.<span class="title function_">rotateZ</span>(<span class="number">0.3</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">      <span class="comment">// 将模型添加至场景</span></span><br><span class="line">       scene.<span class="title function_">add</span>(mesh);</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">       <span class="title function_">startAnimation</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过设置指部骨头绕z轴旋转实现抓东西的东西的动作</span></span><br><span class="line"><span class="keyword">var</span> onUpdate = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pos = <span class="variable language_">this</span>.<span class="property">pos</span>;</span><br><span class="line"></span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">5</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">6</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">10</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">11</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">15</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">16</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">20</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">21</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,pos);</span><br><span class="line"></span><br><span class="line">    mesh.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">1</span>].<span class="property">rotation</span>.<span class="title function_">set</span>(pos,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> tween;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">startAnimation</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//创建tween对象，pos变量从-1.5过度到0</span></span><br><span class="line">    tween = <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123;<span class="attr">pos</span>:-<span class="number">1.5</span>&#125;)</span><br><span class="line">        .<span class="title function_">to</span>(&#123;<span class="attr">pos</span>:<span class="number">0</span>&#125;,<span class="number">3000</span>)</span><br><span class="line">      <span class="comment">// easing缓动函数，Cubic三次方的缓动，InOut前半段加速，后半段减速</span></span><br><span class="line">        .<span class="title function_">easing</span>(<span class="variable constant_">TWEEN</span>.<span class="property">Easing</span>.<span class="property">Cubic</span>.<span class="property">InOut</span>)</span><br><span class="line">        .<span class="title function_">yoyo</span>(<span class="literal">true</span>)</span><br><span class="line">      <span class="comment">// 无限循环</span></span><br><span class="line">        .<span class="title function_">repeat</span>(<span class="title class_">Infinity</span>)</span><br><span class="line">        .<span class="title function_">onUpdate</span>(onUpdate)</span><br><span class="line"></span><br><span class="line">    tween.<span class="title function_">start</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用外部模型创建动画"><a href="#使用外部模型创建动画" class="headerlink" title="使用外部模型创建动画"></a>使用外部模型创建动画</h4><h4 id="使用Blender创建骨骼动画"><a href="#使用Blender创建骨骼动画" class="headerlink" title="使用Blender创建骨骼动画"></a>使用Blender创建骨骼动画</h4><p>为了能够让动画运行起来，还需要创建THREE.SkinnedMesh对象，共同使用THREE.AnimationMixer、THREE.AnimationClip和THREE.ClipAction告诉three.js如何运行导入的动画。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mesh,animationClip,clipAction,mixer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">JSON</span>Loader();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/hand/hand-8.json&quot;</span>,<span class="keyword">function</span> (<span class="params">geometry,amt</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> mat = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshNormalMaterial</span>(&#123;</span><br><span class="line">            <span class="attr">color</span>:<span class="number">0xF0C8C9</span>,</span><br><span class="line">            <span class="attr">skinning</span>:<span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// 创建THREE.SkinnedMesh对象</span></span><br><span class="line">        mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SkinnedMesh</span>(geometry,mat);</span><br><span class="line">        mesh.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">18</span>,<span class="number">18</span>,<span class="number">18</span>);</span><br><span class="line">        scene.<span class="title function_">add</span>(mesh);</span><br><span class="line"></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(mesh);</span><br><span class="line">        animationClip = mesh.<span class="property">geometry</span>.<span class="property">animations</span>[<span class="number">0</span>];</span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(animationClip).<span class="title function_">play</span>();</span><br><span class="line">        animationClip = clipAction.<span class="title function_">getClip</span>();</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    stats.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(render);</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(mixer)&#123;</span><br><span class="line">        mixer.<span class="title function_">update</span>(clock.<span class="title function_">getDelta</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="从Collada模型加载动画"><a href="#从Collada模型加载动画" class="headerlink" title="从Collada模型加载动画"></a>从Collada模型加载动画</h4><ol>
<li>第一步需要先引入对应的JavaScript文件（ColladaLoader.js）</li>
<li>由于普通的Collada模型是不压缩的，因此文件非常大。three.js还有一个KMZLoader加载器，用于加载KMZ（Keyhole Markup language Zipped）模型，该模型基本上就是压缩过的Collada模型。如需加载此类模型，只需要将ColladaLoader替换为KMZLoader即可</li>
<li>第二部创建一个加载器，加载模型文件。</li>
<li>Collada模型不仅可以包含模型，还可以保存包含摄像机、光源和动画等的场景。使用Collada模型最好的方式是将loader.load方法的调用结果输出在控制台，然后决定使用哪些组件。</li>
<li>第三步set up the mixer<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mesh,animationClip,clipAction,mixer;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ColladaLoader</span>();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/monster/monster.dae&quot;</span>,<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">        scene.<span class="title function_">add</span>(result.<span class="property">scene</span>);</span><br><span class="line">        result.<span class="property">scene</span>.<span class="title function_">rotateZ</span>(-<span class="number">0.2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">        result.<span class="property">scene</span>.<span class="title function_">translateX</span>(-<span class="number">20</span>);</span><br><span class="line">        result.<span class="property">scene</span>.<span class="title function_">translateY</span>(-<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(result.<span class="property">scene</span>);</span><br><span class="line">        animationClip = result.<span class="property">animations</span>[<span class="number">0</span>];</span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(animationClip).<span class="title function_">play</span>();</span><br><span class="line">        animationClip = clipAction.<span class="title function_">getClip</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">enableControls</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="从雷神之锤模型中加载动画"><a href="#从雷神之锤模型中加载动画" class="headerlink" title="从雷神之锤模型中加载动画"></a>从雷神之锤模型中加载动画</h4><ol>
<li>加载MD2文件的方式与前面介绍的其他文件方式非常相似，但是由于MD2文件只存储几何体，所以在加载MD2文件时，需要创建材质对象，并自行为其加载纹理资源。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line">    loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MD2Loader</span>();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/ogre/ogro.md2&quot;</span>,<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> mat = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="number">0xffffff</span>,</span><br><span class="line">            <span class="attr">morphTargets</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">metalness</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">map</span>: textureLoader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/ogre/skins/skin.jpg&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> mat2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshNormalMaterial</span>();</span><br><span class="line">        mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(result,mat);</span><br><span class="line">        scene.<span class="title function_">add</span>(mesh);</span><br><span class="line"></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(mesh);</span><br><span class="line">        animationClip1 = result.<span class="property">animations</span>[<span class="number">7</span>];</span><br><span class="line">        clipAction1 = mixer.<span class="title function_">clipAction</span>(animationClip1).<span class="title function_">play</span>();</span><br><span class="line">        animationClip2 = result.<span class="property">animations</span>[<span class="number">9</span>];</span><br><span class="line">        clipAction2 = mixer.<span class="title function_">clipAction</span>(animationClip2)</span><br><span class="line">        animationClip3 = result.<span class="property">animations</span>[<span class="number">10</span>];</span><br><span class="line">        clipAction3 = mixer.<span class="title function_">clipAction</span>(animationClip3)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// enableControls();</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用gltfLoader"><a href="#使用gltfLoader" class="headerlink" title="使用gltfLoader"></a>使用gltfLoader</h4><ol>
<li>gltf格式本身侧重于优化文件尺寸以及提高资源使用效率</li>
<li>这种格式的新版加载器名为THREE.GLTFLoader，它支持2.0版（这是目前的gltf标准格式）以及更高版本的glTF文件。</li>
<li>首先在HTML页面引入对应的Javascript文件</li>
<li>然后按照下面方式使用glTFLoader加载器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">GLTFLoader</span>();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/CesiumMan/CesiumMan.gltf&quot;</span>,<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">        scene.<span class="title function_">add</span>(result.<span class="property">scene</span>);</span><br><span class="line">        result.<span class="property">scene</span>.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">        result.<span class="property">scene</span>.<span class="title function_">rotateY</span>(-<span class="number">0.4</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(result.<span class="property">scene</span>);</span><br><span class="line">        animationClip = result.<span class="property">animations</span>[<span class="number">0</span>];</span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(animationClip).<span class="title function_">play</span>();</span><br><span class="line">        animationClip = clipAction.<span class="title function_">getClip</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">enableControls</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="利用fbxLoader显示动作捕捉模型动画"><a href="#利用fbxLoader显示动作捕捉模型动画" class="headerlink" title="利用fbxLoader显示动作捕捉模型动画"></a>利用fbxLoader显示动作捕捉模型动画</h4><ol>
<li>Autodesk的FBX格式是一种非常易于使用的格式。<span class="exturl" data-url="aHR0cHM6Ly93d3cubWl4YW1vLmNvbS8=" title="https://www.mixamo.com/">https://www.mixamo.com/<i class="fa fa-external-link"></i></span> 提供了约2500个动画模型可供下载和使用<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">FBXLoader</span>();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/salsa/salsa.fbx&quot;</span>,<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">        scene.<span class="title function_">add</span>(result);</span><br><span class="line">        result.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.2</span>,<span class="number">0.2</span>,<span class="number">0.2</span>);</span><br><span class="line">        <span class="comment">// result.scene.rotateY(-0.4*Math.PI);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(result);</span><br><span class="line">        animationClip = result.<span class="property">animations</span>[<span class="number">0</span>];</span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(animationClip).<span class="title function_">play</span>();</span><br><span class="line">        animationClip = clipAction.<span class="title function_">getClip</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">enableControls</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="通过xLoader加载古老的DirectX模型"><a href="#通过xLoader加载古老的DirectX模型" class="headerlink" title="通过xLoader加载古老的DirectX模型"></a>通过xLoader加载古老的DirectX模型</h4><ol>
<li>这种文件格式将模型和动画分开存储。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> manager = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LoadingManager</span>();</span><br><span class="line">    <span class="keyword">var</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line">    <span class="comment">//创建两个THREE.XLoader加载器对象，分别用于加载模型文件和动画文件</span></span><br><span class="line">    <span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">XLoader</span>(manager,textureLoader);</span><br><span class="line">    <span class="keyword">var</span> animLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">XLoader</span>(manager,textureLoader);</span><br><span class="line">    <span class="comment">//加载模型</span></span><br><span class="line">    loader.<span class="title function_">load</span>([<span class="string">&quot;../assets/models/x/SSR06_model.x&quot;</span>],<span class="keyword">function</span> (<span class="params">result</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> mesh = result.<span class="property">models</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//加载动画</span></span><br><span class="line">        animLoader.<span class="title function_">load</span>([<span class="string">&quot;../assets/models/x/stand.x&quot;</span>,&#123;<span class="attr">putPos</span>:<span class="literal">false</span>,<span class="attr">putScl</span>:<span class="literal">false</span>&#125;],<span class="keyword">function</span> (<span class="params">anim</span>)&#123;</span><br><span class="line">            <span class="comment">//调用assignAnimation函数将动画对象指定给模型对象</span></span><br><span class="line">            animLoader.<span class="title function_">assignAnimation</span>(mesh);</span><br><span class="line"></span><br><span class="line">            mixer = mesh.<span class="property">animationMixer</span>;</span><br><span class="line">            clipAction = mixer.<span class="title function_">clipAction</span>(<span class="string">&quot;stand&quot;</span>).<span class="title function_">play</span>();</span><br><span class="line">            clip = clipAction.<span class="title function_">getClip</span>();</span><br><span class="line"></span><br><span class="line">            mesh.<span class="title function_">translateY</span>(-<span class="number">6</span>);</span><br><span class="line">            mesh.<span class="title function_">rotateY</span>(-<span class="number">0.7</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">            scene.<span class="title function_">add</span>(mesh);</span><br><span class="line">            <span class="title function_">enableControls</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="利用BVHLoader显示骨骼动画"><a href="#利用BVHLoader显示骨骼动画" class="headerlink" title="利用BVHLoader显示骨骼动画"></a>利用BVHLoader显示骨骼动画</h4><ol>
<li>BVHLoader的特殊之处在于该加载器不返回具有动画的网格或者几何体，它只返回骨骼和动画。</li>
<li>为了可视化，在程序中使用了THREE.SkeletonHelper<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BVHLoader</span>();</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/amelia-dance/DanceNightClub7_t1.bvh&quot;</span>,<span class="keyword">function</span> (<span class="params">result,mat</span>)&#123;</span><br><span class="line">        skeletonHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SkeletonHelper</span>(result.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        skeletonHelper.<span class="property">skeleton</span> = result.<span class="property">skeleton</span>;</span><br><span class="line">        <span class="keyword">var</span> boneContainer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Object3D</span>();</span><br><span class="line">        boneContainer.<span class="title function_">translateY</span>(-<span class="number">70</span>);</span><br><span class="line">        boneContainer.<span class="title function_">translateX</span>(-<span class="number">100</span>);</span><br><span class="line">        boneContainer.<span class="title function_">add</span>(result.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">0</span>]);</span><br><span class="line">        scene.<span class="title function_">add</span>(skeletonHelper);</span><br><span class="line">        scene.<span class="title function_">add</span>(boneContainer);</span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(skeletonHelper);</span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(result.<span class="property">clip</span>).<span class="title function_">setEffectiveWeight</span>(<span class="number">1.0</span>).<span class="title function_">play</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">enableControls</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="如何重用SEA3D模型"><a href="#如何重用SEA3D模型" class="headerlink" title="如何重用SEA3D模型"></a>如何重用SEA3D模型</h4><ol>
<li>SEA3D是一个开源软件项目，它的功能很丰富，通常可以用于制作游戏、创建模型、添加动画等</li>
<li>在创建THREE.SEA3D加载器对象的时候，就要同时向它提供场景容器THREE.Scene的对象。</li>
<li>加载状态回调函数也不是在调用load函数时提供，而是直接向onComplete属性提供回调函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initModels</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> sceneContainer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">    <span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SEA3D</span>(&#123;</span><br><span class="line">        <span class="attr">container</span>:sceneContainer,</span><br><span class="line">    &#125;);</span><br><span class="line">    loader.<span class="title function_">load</span>(<span class="string">&quot;../assets/models/mascot/mascot.sea&quot;</span>);</span><br><span class="line">    loader.<span class="property">onComplete</span> = <span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> skinnedMesh = sceneContainer.<span class="property">children</span>[<span class="number">0</span>];</span><br><span class="line">        skinnedMesh.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.1</span>,<span class="number">0.1</span>,<span class="number">0.1</span>);</span><br><span class="line">        skinnedMesh.<span class="title function_">translateX</span>(-<span class="number">40</span>);</span><br><span class="line">        skinnedMesh.<span class="title function_">translateY</span>(-<span class="number">20</span>);</span><br><span class="line">        skinnedMesh.<span class="title function_">rotateY</span>(-<span class="number">0.2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">        scene.<span class="title function_">add</span>(skinnedMesh);</span><br><span class="line"></span><br><span class="line">        mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(skinnedMesh);</span><br><span class="line">        animationClip = skinnedMesh.<span class="property">animations</span>[<span class="number">0</span>].<span class="property">clip</span>;</span><br><span class="line">        clipAction = mixer.<span class="title function_">clipAction</span>(animationClip).<span class="title function_">play</span>();</span><br><span class="line">        animationClip = clipAction.<span class="title function_">getClip</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">enableControls</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="绘制直线和曲线"><a href="#绘制直线和曲线" class="headerlink" title="绘制直线和曲线"></a>绘制直线和曲线</h1><h2 id="直线"><a href="#直线" class="headerlink" title="直线"></a>直线</h2><p>方法一：<br>tips<br>var p1 &#x3D; new THREE.Vector3(5,6,7);var p2 &#x3D; new THREE.Vector3(50,60,4);var geometry &#x3D; new THREE.Geometry();geometry.vertices.push(p1,p2); var material &#x3D; new THREE.LineBasicMaterial({color:0xffffff});var line &#x3D; new THREE.Line(geometry,material);scene.add(line);</p>
<p>方法二：<br>tips<br>var p3 &#x3D; new THREE.Vector3(20,4,50);var p4 &#x3D; new THREE.Vector3(1,40,8);var line2 &#x3D; new THREE.LineCurve3(p3,p4);let points &#x3D; line2.getPoints(100);geometry.setFromPoints(points);</p>
<h2 id="曲线（自定义弧线）"><a href="#曲线（自定义弧线）" class="headerlink" title="曲线（自定义弧线）"></a>曲线（自定义弧线）</h2><h2 id="通过添加点，绘制样条曲线"><a href="#通过添加点，绘制样条曲线" class="headerlink" title="通过添加点，绘制样条曲线"></a>通过添加点，绘制样条曲线</h2><ol>
<li><p>创建一个平面作为画板</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建平面</span></span><br><span class="line"><span class="keyword">var</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeomrtry</span>(<span class="number">60</span>,<span class="number">60</span>);</span><br><span class="line"><span class="keyword">var</span> planeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>:<span class="number">0xCCCCCC</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,planeMaterial);</span><br><span class="line"><span class="comment">// 平面旋转90</span></span><br><span class="line">plane.<span class="title function_">rotatoX</span>(-<span class="number">0.5</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">scene.<span class="title function_">add</span>(plane);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建点击事件，获取平面上的点坐标，并创建圆点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 光线投射，用于确定鼠标点击位置</span></span><br><span class="line"><span class="keyword">var</span> raycaster = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Raycaster</span>();</span><br><span class="line"><span class="comment">// 创建二维平面</span></span><br><span class="line"><span class="keyword">var</span> mouse = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>();</span><br><span class="line"><span class="comment">// 页面绑定鼠标点击事件</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousedown&quot;</span>,mousedown);</span><br><span class="line"><span class="comment">// 点击函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mousedown</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="comment">// 判断是否点击鼠标左键</span></span><br><span class="line">  <span class="keyword">if</span>(e.<span class="property">button</span> == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">// 将html坐标系转化为webgl坐标系，并确定鼠标点击位置</span></span><br><span class="line">    mouse.<span class="property">x</span> = e.<span class="property">clientX</span>/renderer.<span class="property">domElement</span>.<span class="property">clientWidth</span>*<span class="number">2</span>-<span class="number">1</span>;</span><br><span class="line">    mouse.<span class="property">y</span> = -(e.<span class="property">clientY</span>/renderer.<span class="property">domElement</span>.<span class="property">clientHeight</span>*<span class="number">2</span>)+<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 以camera为z坐标。确定所点击物体的3D空间位置</span></span><br><span class="line">    raycaster.<span class="title function_">setFromCamera</span>(mouse,camera);</span><br><span class="line">    <span class="comment">// 确定所点击位置上的物体数量</span></span><br><span class="line">    <span class="keyword">var</span> intersects = raycaster.<span class="title function_">intersectObjects</span>(scene.<span class="property">children</span>);</span><br><span class="line">    <span class="keyword">if</span>(intersects.<span class="property">length</span>)&#123;</span><br><span class="line">      <span class="comment">// 取第一个物体</span></span><br><span class="line">      selected = intersects[<span class="number">0</span>];</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>绘制曲线（实时更新曲线——删除上一个曲线）</p>
</li>
</ol>
<h2 id="线的那些事"><a href="#线的那些事" class="headerlink" title="线的那些事"></a>线的那些事</h2><h3 id="1-线的材质"><a href="#1-线的材质" class="headerlink" title="1. 线的材质"></a>1. 线的材质</h3><ul>
<li><p>LineBasicMaterial<br>tips<br>const material &#x3D; new THREE.LineBasicMaterial({color:0xffffff,   &#x2F;&#x2F;颜色linewidth:1,   &#x2F;&#x2F;线宽，一般线宽宽度总是1，不可设置linecap:’round’,  &#x2F;&#x2F;线端点类型，可以是：butt\round\square，默认是roundlinejoin:’round’,  &#x2F;&#x2F;线连接点类型，可以是：bevel\round\miter，默认是round})</p>
</li>
<li><p>LineDashedMaterial</p>
<ul>
<li>虚线材质<br>tips<br>const material &#x3D; new THREE.LineDashedMaterial({color:0xffffff,    &#x2F;&#x2F;颜色linewidth:1,	&#x2F;&#x2F;线宽scale:1,	&#x2F;&#x2F;虚线的比例大小 ，默认1dashSize:3,	&#x2F;&#x2F;虚线的点的大小，默认3gapSize:1,		&#x2F;&#x2F;点之间的间距大小，默认1})</li>
</ul>
</li>
</ul>
<h3 id="2-线的几何"><a href="#2-线的几何" class="headerlink" title="2. 线的几何"></a>2. 线的几何</h3><p>tips<br>const points &#x3D; [];points.push(new THREE.Vector3(-10,0,0));points.push(new THREE.Vector3(0,10,0));points.push(new THREE.Vector3(10,0,0));</p>
<p>const geometry &#x3D; new THREE.BufferGeometry().setFromPoints(points);</p>
<p>const line &#x3D; new THREE.Line(geometry,material);</p>
<h3 id="3-LineCurve"><a href="#3-LineCurve" class="headerlink" title="3. LineCurve"></a>3. LineCurve</h3><h1 id="Raycaster"><a href="#Raycaster" class="headerlink" title="Raycaster"></a>Raycaster</h1><ol>
<li>raycaster（光线投射），用于进行鼠标拾取（在三维空间中计算出鼠标移过了什么物体），物体选中</li>
<li>Raycaster( origin, direction, near, far )<ol>
<li>origin–射线的起点向量</li>
<li>direction–射线的方向向量，应该归一标准化</li>
<li>near–所有返回的结果应该比near远，near不能为负，默认0</li>
<li>far–所有返回的结果应该比far近，far不能小于near，默认值为无穷大<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Raycaster</span>();</span><br><span class="line"><span class="keyword">const</span> mouse = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onDocumentMouseDown</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="comment">// 屏幕坐标（2维）转换为世界坐标（三维）</span></span><br><span class="line">  mouse.<span class="property">x</span> = (event.<span class="property">clientX</span> / <span class="variable language_">window</span>.<span class="property">innerWidth</span>)*<span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">  mouse.<span class="property">y</span> = -(event.<span class="property">clientY</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>)*<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过摄像机和鼠标位置更新射线</span></span><br><span class="line">  raycaster.<span class="title function_">setFromCamera</span>(mouse,camera);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计算物体和射线交点</span></span><br><span class="line">  <span class="keyword">var</span> intersects = raycaster.<span class="title function_">intersectObjects</span>(objects);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(intersects.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">// 选中第一个射线相交的物体</span></span><br><span class="line">    <span class="keyword">var</span> intersect = intersects[<span class="number">0</span>].<span class="property">object</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h1 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h1><h2 id="阴影问题（无法渲染正确阴影）："><a href="#阴影问题（无法渲染正确阴影）：" class="headerlink" title="阴影问题（无法渲染正确阴影）："></a>阴影问题（无法渲染正确阴影）：</h2><ul>
<li><p>首先确认渲染器有无开启阴影贴图（默认是false）</p>
<blockquote>
<p>renderer.shadowMap.enabled &#x3D; true;</p>
</blockquote>
</li>
<li><p>确认物体材质是否可受光照影响（MeshBasicMaterial材质不受光照影响）</p>
</li>
<li><p>确认光源是否可以产生阴影（PointLight、SpotLight、DirectionalLight可以有阴影）</p>
</li>
<li><p>确认光源是否开启阴影</p>
<blockquote>
<p>spotLight.castShadow &#x3D; true;</p>
</blockquote>
</li>
<li><p>确认物体是否渲染阴影贴图和是否接收阴影</p>
<blockquote>
<p>&#x2F;&#x2F;地面接收阴影<br>ground.receiveShadow &#x3D; true;<br>&#x2F;&#x2F;方块产生阴影<br>cube.castShaow &#x3D; true;</p>
</blockquote>
</li>
</ul>
<h2 id="页面响应式布局"><a href="#页面响应式布局" class="headerlink" title="页面响应式布局"></a>页面响应式布局</h2><ul>
<li>给页面添加一个监听事件</li>
<li>设置摄像机的长宽比，手动更新相机的投影矩阵</li>
<li>设置渲染器的宽高<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//监听事件</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(resize,onResize,<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//onResize函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onResize</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 摄像机长宽比</span></span><br><span class="line">	camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">  <span class="comment">// 手动更新摄像机投影矩阵</span></span><br><span class="line">  camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">  <span class="comment">// 渲染器宽高</span></span><br><span class="line">  renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>,<span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="SindreYang 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="SindreYang 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>SindreYang
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://blog.mviai.com/2025/8._Three.js/" title="8">http://blog.mviai.com/2025/8._Three.js/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat.png">
            <span class="icon">
              <i class="fa fa-wechat"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/8._%E7%86%9F%E6%82%89pycharm%E4%BD%BF%E7%94%A8/" rel="prev" title="8">
      <i class="fa fa-chevron-left"></i> 8
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/7._%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9%E5%8A%9F%E8%83%BD%E3%80%81%E8%BF%9B%E5%BA%A6%E6%9D%A1%E6%8E%A7%E5%88%B6/" rel="next" title="7">
      7 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="SOHUCS"></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AD%A3%E4%BA%A4%E6%8A%95%E5%BD%B1%E6%91%84%E5%83%8F%E6%9C%BA%E5%92%8C%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1%E6%91%84%E5%83%8F%E6%9C%BA"><span class="nav-number">1.</span> <span class="nav-text">正交投影摄像机和透视投影摄像机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8E%E5%A4%96%E9%83%A8%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">2.</span> <span class="nav-text">从外部资源加载几何体</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="nav-number">2.1.</span> <span class="nav-text">问题：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%89%E6%BA%90"><span class="nav-number">3.</span> <span class="nav-text">光源</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E7%A7%8D%E7%B1%BB%E7%9A%84%E5%85%89%E6%BA%90"><span class="nav-number">3.1.</span> <span class="nav-text">不同种类的光源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-AmbientLight"><span class="nav-number">3.2.</span> <span class="nav-text">THREE.AmbientLight</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E6%8F%8F%E8%BF%B0%EF%BC%9A"><span class="nav-number">3.2.1.</span> <span class="nav-text">作用描述：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A"><span class="nav-number">3.2.2.</span> <span class="nav-text">注意事项：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BATHREE-AmbientLight%E5%85%89%E6%BA%90"><span class="nav-number">3.2.3.</span> <span class="nav-text">创建THREE.AmbientLight光源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B"><span class="nav-number">3.2.4.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C%EF%BC%9A"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">结果：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="nav-number">3.2.4.2.</span> <span class="nav-text">代码：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-SpotLight"><span class="nav-number">3.3.</span> <span class="nav-text">THREE.SpotLight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-PointLight"><span class="nav-number">3.4.</span> <span class="nav-text">THREE.PointLight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-DirectionalLight"><span class="nav-number">3.5.</span> <span class="nav-text">THREE.DirectionalLight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-HemisphereLight"><span class="nav-number">3.6.</span> <span class="nav-text">THREE.HemisphereLight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-AreaLight"><span class="nav-number">3.7.</span> <span class="nav-text">THREE.AreaLight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%95%9C%E5%A4%B4%E5%85%89%E6%99%95%EF%BC%88Lens-Flare%EF%BC%89"><span class="nav-number">3.8.</span> <span class="nav-text">镜头光晕（Lens Flare）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8%EF%BC%88texture%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">材质（texture）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%80%E6%9C%89%E6%9D%90%E8%B4%A8%EF%BC%9A"><span class="nav-number">4.1.</span> <span class="nav-text">所有材质：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8%E7%9A%84%E5%85%B1%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.</span> <span class="nav-text">材质的共有属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.1.</span> <span class="nav-text">基础属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%9E%8D%E5%90%88%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.2.</span> <span class="nav-text">融合属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.3.</span> <span class="nav-text">高级属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshBasicMaterial"><span class="nav-number">4.3.</span> <span class="nav-text">THREE.MeshBasicMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">4.3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7"><span class="nav-number">4.3.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="nav-number">4.3.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C"><span class="nav-number">4.3.3.1.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">4.3.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshDepthMaterial"><span class="nav-number">4.4.</span> <span class="nav-text">THREE.MeshDepthMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="nav-number">4.4.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7-1"><span class="nav-number">4.4.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-2"><span class="nav-number">4.4.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-1"><span class="nav-number">4.4.3.1.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">4.4.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%9D%90%E8%B4%A8"><span class="nav-number">4.5.</span> <span class="nav-text">联合材质</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="nav-number">4.5.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-3"><span class="nav-number">4.5.2.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0"><span class="nav-number">4.5.2.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-2"><span class="nav-number">4.5.2.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="nav-number">4.5.2.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshNormalMaterial"><span class="nav-number">4.6.</span> <span class="nav-text">THREE.MeshNormalMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-3"><span class="nav-number">4.6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7-2"><span class="nav-number">4.6.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-4"><span class="nav-number">4.6.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-1"><span class="nav-number">4.6.3.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-3"><span class="nav-number">4.6.3.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="nav-number">4.6.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%8D%95%E5%87%A0%E4%BD%95%E4%BD%93%E4%B8%8A%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%A7%8D%E6%9D%90%E8%B4%A8"><span class="nav-number">4.7.</span> <span class="nav-text">在单几何体上使用多种材质</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-5"><span class="nav-number">4.7.1.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-2"><span class="nav-number">4.7.1.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-4"><span class="nav-number">4.7.1.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="nav-number">4.7.1.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshLambertMaterial"><span class="nav-number">4.8.</span> <span class="nav-text">THREE.MeshLambertMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-4"><span class="nav-number">4.8.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7-3"><span class="nav-number">4.8.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-6"><span class="nav-number">4.8.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-3"><span class="nav-number">4.8.3.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-5"><span class="nav-number">4.8.3.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-5"><span class="nav-number">4.8.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshPhongMaterial"><span class="nav-number">4.9.</span> <span class="nav-text">THREE.MeshPhongMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-5"><span class="nav-number">4.9.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7-4"><span class="nav-number">4.9.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-7"><span class="nav-number">4.9.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-4"><span class="nav-number">4.9.3.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-6"><span class="nav-number">4.9.3.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-6"><span class="nav-number">4.9.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshStandardMaterial"><span class="nav-number">4.10.</span> <span class="nav-text">THREE.MeshStandardMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-6"><span class="nav-number">4.10.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7-5"><span class="nav-number">4.10.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-8"><span class="nav-number">4.10.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-5"><span class="nav-number">4.10.3.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-7"><span class="nav-number">4.10.3.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-7"><span class="nav-number">4.10.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREE-MeshPhysicalMaterial"><span class="nav-number">4.11.</span> <span class="nav-text">THREE.MeshPhysicalMaterial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-7"><span class="nav-number">4.11.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7-6"><span class="nav-number">4.11.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-9"><span class="nav-number">4.11.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-6"><span class="nav-number">4.11.3.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-8"><span class="nav-number">4.11.3.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-8"><span class="nav-number">4.11.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B2%92%E5%AD%90%E5%92%8C%E7%B2%BE%E7%81%B5"><span class="nav-number">5.</span> <span class="nav-text">粒子和精灵</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%92%8C%E4%BD%BF%E7%94%A8%E7%BA%B9%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">加载和使用纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UV%E8%B4%B4%E5%9B%BE"><span class="nav-number">6.1.</span> <span class="nav-text">UV贴图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E5%B9%B3%E9%93%BA%EF%BC%88%E9%87%8D%E5%A4%8D%EF%BC%89%E7%9A%84%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-number">6.2.</span> <span class="nav-text">纹理平铺（重复）的相关属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E7%BA%B9%E7%90%86%E5%B9%B6%E5%BA%94%E7%94%A8%E5%88%B0%E7%BD%91%E6%A0%BC"><span class="nav-number">6.3.</span> <span class="nav-text">加载纹理并应用到网格</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-8"><span class="nav-number">6.3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-10"><span class="nav-number">6.3.2.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-7"><span class="nav-number">6.3.2.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-9"><span class="nav-number">6.3.2.2.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-9"><span class="nav-number">6.3.2.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">6.3.3.</span> <span class="nav-text">自定义加载器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%87%B9%E5%87%B8%E8%B4%B4%E5%9B%BE%E5%88%9B%E5%BB%BA%E8%A4%B6%E7%9A%B1"><span class="nav-number">6.4.</span> <span class="nav-text">使用凹凸贴图创建褶皱</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-9"><span class="nav-number">6.4.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA"><span class="nav-number">6.4.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">6.4.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%95%E5%90%91%E8%B4%B4%E5%9B%BE%E5%88%9B%E5%BB%BA%E6%9B%B4%E5%8A%A0%E7%BB%86%E8%87%B4%E7%9A%84%E5%87%B9%E5%87%B8%E5%92%8C%E8%A4%B6%E7%9A%B1"><span class="nav-number">6.5.</span> <span class="nav-text">使用法向贴图创建更加细致的凹凸和褶皱</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-10"><span class="nav-number">6.5.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="nav-number">6.5.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="nav-number">6.5.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A7%BB%E4%BD%8D%E8%B4%B4%E5%9B%BE%E6%9D%A5%E6%94%B9%E5%8F%98%E9%A1%B6%E7%82%B9%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.6.</span> <span class="nav-text">使用移位贴图来改变顶点位置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-11"><span class="nav-number">6.6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-2"><span class="nav-number">6.6.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-2"><span class="nav-number">6.6.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E7%8E%AF%E5%A2%83%E5%85%89%E9%81%AE%E6%8C%A1%E8%B4%B4%E5%9B%BE%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E9%98%B4%E5%BD%B1"><span class="nav-number">6.7.</span> <span class="nav-text">用环境光遮挡贴图实现细节阴影</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-12"><span class="nav-number">6.7.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-3"><span class="nav-number">6.7.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-3"><span class="nav-number">6.7.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E5%85%89%E7%85%A7%E8%B4%B4%E5%9B%BE%E4%BA%A7%E7%94%9F%E5%81%87%E9%98%B4%E5%BD%B1"><span class="nav-number">6.8.</span> <span class="nav-text">用光照贴图产生假阴影</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-13"><span class="nav-number">6.8.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-4"><span class="nav-number">6.8.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-4"><span class="nav-number">6.8.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%91%E5%B1%9E%E5%85%89%E6%B3%BD%E5%BA%A6%E8%B4%B4%E5%9B%BE%E5%92%8C%E7%B2%97%E7%B3%99%E5%BA%A6%E8%B4%B4%E5%9B%BE"><span class="nav-number">6.9.</span> <span class="nav-text">金属光泽度贴图和粗糙度贴图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-14"><span class="nav-number">6.9.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-5"><span class="nav-number">6.9.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-5"><span class="nav-number">6.9.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Alpha%E8%B4%B4%E5%9B%BE"><span class="nav-number">6.10.</span> <span class="nav-text">Alpha贴图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-15"><span class="nav-number">6.10.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-6"><span class="nav-number">6.10.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-6"><span class="nav-number">6.10.3.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8F%91%E5%85%89%E8%B4%B4%E5%9B%BE"><span class="nav-number">6.11.</span> <span class="nav-text">自发光贴图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-16"><span class="nav-number">6.11.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-7"><span class="nav-number">6.11.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B"><span class="nav-number">6.11.3.</span> <span class="nav-text">完整案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E5%85%89%E8%B4%B4%E5%9B%BE"><span class="nav-number">6.12.</span> <span class="nav-text">高光贴图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-17"><span class="nav-number">6.12.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-8"><span class="nav-number">6.12.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B-1"><span class="nav-number">6.12.3.</span> <span class="nav-text">完整案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E8%B4%B4%E5%9B%BE%E5%88%9B%E5%BB%BA%E4%BC%AA%E9%95%9C%E9%9D%A2%E6%95%88%E6%9E%9C"><span class="nav-number">6.13.</span> <span class="nav-text">使用环境贴图创建伪镜面效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-18"><span class="nav-number">6.13.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-9"><span class="nav-number">6.13.2.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">6.13.3.</span> <span class="nav-text">案例完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89UV%E6%98%A0%E5%B0%84"><span class="nav-number">6.14.</span> <span class="nav-text">自定义UV映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E7%BA%B9%E7%90%86"><span class="nav-number">6.15.</span> <span class="nav-text">重复纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-19"><span class="nav-number">6.15.1.</span> <span class="nav-text">简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E7%94%BB%E5%B8%83%E4%B8%8A%E7%BB%98%E5%88%B6%E5%9B%BE%E6%A1%88%E5%B9%B6%E4%BD%9C%E4%B8%BA%E7%BA%B9%E7%90%86"><span class="nav-number">6.16.</span> <span class="nav-text">在画布上绘制图案并作为纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E7%94%BB%E5%B8%83%E4%BD%9C%E4%B8%BA%E7%BA%B9%E7%90%86"><span class="nav-number">6.16.1.</span> <span class="nav-text">将画布作为纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-20"><span class="nav-number">6.16.1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">6.16.1.2.</span> <span class="nav-text">完整案例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E7%94%BB%E5%B8%83%E7%94%A8%E4%BD%9C%E5%87%B9%E5%87%B8%E8%B4%B4%E5%9B%BE"><span class="nav-number">6.16.2.</span> <span class="nav-text">将画布用作凹凸贴图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E8%A7%86%E9%A2%91%E8%BE%93%E5%87%BA%E4%BD%9C%E4%B8%BA%E7%BA%B9%E7%90%86"><span class="nav-number">6.17.</span> <span class="nav-text">将视频输出作为纹理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E7%94%BB%E5%92%8C%E7%A7%BB%E5%8A%A8%E6%91%84%E5%83%8F%E6%9C%BA"><span class="nav-number">7.</span> <span class="nav-text">创建动画和移动摄像机</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%8A%A8%E7%94%BB"><span class="nav-number">7.1.</span> <span class="nav-text">简单动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-21"><span class="nav-number">7.1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="nav-number">7.1.2.</span> <span class="nav-text">案例完整代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E9%BC%A0%E6%A0%87%E9%80%89%E6%8B%A9%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.2.</span> <span class="nav-text">如何使用鼠标选择场景中的对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Tween-js%E5%AE%9E%E7%8E%B0%E5%8A%A8%E7%94%BB"><span class="nav-number">7.3.</span> <span class="nav-text">使用Tween.js实现动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-22"><span class="nav-number">7.3.1.</span> <span class="nav-text">简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%91%84%E5%83%8F%E6%9C%BA%E6%8E%A7%E4%BB%B6"><span class="nav-number">7.4.</span> <span class="nav-text">摄像机控件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%A8%E8%BF%B9%E7%90%83%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88TrackBallControls%EF%BC%89"><span class="nav-number">7.4.1.</span> <span class="nav-text">轨迹球控制器（TrackBallControls）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A3%9E%E8%A1%8C%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88FlyControls%EF%BC%89"><span class="nav-number">7.4.2.</span> <span class="nav-text">飞行控制器（FlyControls）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E8%A7%86%E8%A7%92%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88FirstPersonControls%EF%BC%89"><span class="nav-number">7.4.3.</span> <span class="nav-text">第一视角控制器（FirstPersonControls）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%A8%E9%81%93%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88OrbitControls%EF%BC%89"><span class="nav-number">7.4.4.</span> <span class="nav-text">轨道控制器（OrbitControls）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB%E5%92%8C%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.</span> <span class="nav-text">变形动画和骨骼动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E5%8F%98%E5%BD%A2%E7%9B%AE%E6%A0%87%E5%88%9B%E5%BB%BA%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.1.</span> <span class="nav-text">用变形目标创建动画</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B7%B7%E5%90%88%E5%99%A8%E5%92%8C%E5%8F%98%E5%BD%A2%E7%9B%AE%E6%A0%87%E5%88%9B%E5%BB%BA%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.1.1.</span> <span class="nav-text">使用混合器和变形目标创建动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AATHREE-AnimationClip%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.5.1.2.</span> <span class="nav-text">使用多个THREE.AnimationClip对象</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E9%AA%A8%E9%AA%BC%E5%92%8C%E8%92%99%E7%9A%AE%E5%88%9B%E5%BB%BA%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.</span> <span class="nav-text">用骨骼和蒙皮创建动画</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E6%A8%A1%E5%9E%8B%E5%88%9B%E5%BB%BA%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.1.</span> <span class="nav-text">使用外部模型创建动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Blender%E5%88%9B%E5%BB%BA%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.2.</span> <span class="nav-text">使用Blender创建骨骼动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8ECollada%E6%A8%A1%E5%9E%8B%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.3.</span> <span class="nav-text">从Collada模型加载动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E%E9%9B%B7%E7%A5%9E%E4%B9%8B%E9%94%A4%E6%A8%A1%E5%9E%8B%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.4.</span> <span class="nav-text">从雷神之锤模型中加载动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8gltfLoader"><span class="nav-number">7.5.2.5.</span> <span class="nav-text">使用gltfLoader</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8fbxLoader%E6%98%BE%E7%A4%BA%E5%8A%A8%E4%BD%9C%E6%8D%95%E6%8D%89%E6%A8%A1%E5%9E%8B%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.6.</span> <span class="nav-text">利用fbxLoader显示动作捕捉模型动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87xLoader%E5%8A%A0%E8%BD%BD%E5%8F%A4%E8%80%81%E7%9A%84DirectX%E6%A8%A1%E5%9E%8B"><span class="nav-number">7.5.2.7.</span> <span class="nav-text">通过xLoader加载古老的DirectX模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8BVHLoader%E6%98%BE%E7%A4%BA%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB"><span class="nav-number">7.5.2.8.</span> <span class="nav-text">利用BVHLoader显示骨骼动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%87%8D%E7%94%A8SEA3D%E6%A8%A1%E5%9E%8B"><span class="nav-number">7.5.2.9.</span> <span class="nav-text">如何重用SEA3D模型</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E7%9B%B4%E7%BA%BF%E5%92%8C%E6%9B%B2%E7%BA%BF"><span class="nav-number">8.</span> <span class="nav-text">绘制直线和曲线</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E7%BA%BF"><span class="nav-number">8.1.</span> <span class="nav-text">直线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B2%E7%BA%BF%EF%BC%88%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%A7%E7%BA%BF%EF%BC%89"><span class="nav-number">8.2.</span> <span class="nav-text">曲线（自定义弧线）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%B7%BB%E5%8A%A0%E7%82%B9%EF%BC%8C%E7%BB%98%E5%88%B6%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF"><span class="nav-number">8.3.</span> <span class="nav-text">通过添加点，绘制样条曲线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="nav-number">8.4.</span> <span class="nav-text">线的那些事</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BA%BF%E7%9A%84%E6%9D%90%E8%B4%A8"><span class="nav-number">8.4.1.</span> <span class="nav-text">1. 线的材质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BA%BF%E7%9A%84%E5%87%A0%E4%BD%95"><span class="nav-number">8.4.2.</span> <span class="nav-text">2. 线的几何</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-LineCurve"><span class="nav-number">8.4.3.</span> <span class="nav-text">3. LineCurve</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Raycaster"><span class="nav-number">9.</span> <span class="nav-text">Raycaster</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-number">10.</span> <span class="nav-text">注意点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%B4%E5%BD%B1%E9%97%AE%E9%A2%98%EF%BC%88%E6%97%A0%E6%B3%95%E6%B8%B2%E6%9F%93%E6%AD%A3%E7%A1%AE%E9%98%B4%E5%BD%B1%EF%BC%89%EF%BC%9A"><span class="nav-number">10.1.</span> <span class="nav-text">阴影问题（无法渲染正确阴影）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80"><span class="nav-number">10.2.</span> <span class="nav-text">页面响应式布局</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SindreYang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">SindreYang</p>
  <div class="site-description" itemprop="description">沉淀后我愿意做一个温暖的人。有自己的喜好，有自己的原则，有自己的信仰，不急功近利，不浮夸轻薄，宠辱不惊，淡定安逸，心静如水。------不忘初心，方得始终</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">321</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NpbmRyZVlhbmc=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SindreYang"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnl4QG12aWFpLmNvbQ==" title="E-Mail → mailto:yx@mviai.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="languages">
    <label class="lang-select-label">
      <i class="fa fa-language"></i>
      <span>简体中文</span>
      <i class="fa fa-angle-up" aria-hidden="true"></i>
    </label>
    <select class="lang-select" data-canonical="">
      
        <option value="zh-CN" data-href="/2025/8._Three.js/" selected="">
          简体中文
        </option>
      
        <option value="en" data-href="/en/2025/8._Three.js/" selected="">
          English
        </option>
      
    </select>
  </div>

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SindreYang</span>
</div><!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
<!-- 背景波浪 -->
<script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>


<!-- 腾讯企业邮箱 -->
<style>
.bizmail_loginpanel {
    font-size: 12px;
    width: 300px;
    height: auto;
    background: transparent;
    margin-left: auto;
    margin-right: auto;
}

.bizmail_LoginBox {
    padding: 10px 15px;
}


.bizmail_loginpanel form {
    margin: 0;
    padding: 0;
}

.bizmail_loginpanel input.text {
    font-size: 12px;
    width: 100px;
    height: 20px;
    margin: 0 2px;
    background-color: transparent;
    border:1px solid transparent;
    box-shadow: none;
    color: black;
}

.bizmail_loginpanel .bizmail_column {
    height: 28px;
}

.bizmail_loginpanel .bizmail_column label {
    display: block;
    float: left;
    width: 30px;
    height: 24px;
    line-height: 24px;
    font-size: 12px;
}

.bizmail_loginpanel .bizmail_column .bizmail_inputArea {
    float: left;
    width: 240px;
}

.bizmail_loginpanel .bizmail_column span {
    font-size: 12px;
    word-wrap: break-word;
    margin-left: 2px;
    line-height: 200%;
}

.bizmail_loginpanel .bizmail_SubmitArea {
    margin-left: 30px;
    clear: both;
}

.bizmail_loginpanel .bizmail_SubmitArea a {
    font-size: 12px;
    margin-left: 5px;
}

.bizmail_loginpanel select {
    width: 110px;
    height: 20px;
    margin: 0 2px;
}
.bizmail_loginpanel input {

    background-color: rgba(83, 126, 236, 0.562);
}


</style>

<script type="text/javascript">
function checkInput() {
    var e = document.form1.uin,
        i = document.form1.pwd;
    return 0 == e.value.length ? e.focus() : 0 == i.value.length ? i.focus() : (document.form1.submit(), setTimeout(" document.form1.pwd.value = '' ", 500)), !1
}

function writeLoginPanel(e) {
    if (e && e.domainlist && -1 != e.domainlist.indexOf(".")) {
        var a = "return checkInput()",
            t = '<div id="divLoginpanelHor" class="bizmail_loginpanel" style="width:550px;"><div class="bizmail_LoginBox"><form name="form1" action="https://exmail.qq.com/cgi-bin/login" target="_blank" method="post" onsubmit="' + a + '"><input type="hidden" name="firstlogin" value="false" /><input type="hidden" name="errtemplate" value="dm_loginpage" /><input type="hidden" name="aliastype" value="other" /><input type="hidden" name="dmtype" value="bizmail" /><input type="hidden" name="p" value="" /><label>\u8d26\u53f7:</label><input type="text" name="uin" class="text" value="" />@#domainlist#<label>&nbsp&nbsp&nbsp;\u5bc6\u7801:</label><input type="password" name="pwd" class="text" value="" /><input type="submit" class="" name="" value="\u767b\u5f55" />&nbsp;<a href="https://exmail.qq.com/cgi-bin/readtemplate?check=false&t=biz_rf_portal#recovery" target="_blank">\u5fd8\u8bb0\u5bc6\u7801\uff1f</a></form></div></div>',
            n = '<div id="divLoginpanelVer" class="bizmail_loginpanel"><div class="bizmail_LoginBox"><form name="form1" action="https://exmail.qq.com/cgi-bin/login" target="_blank" method="post" onsubmit="' + a + '"><input type="hidden" name="firstlogin" value="false" /><input type="hidden" name="errtemplate" value="dm_loginpage" /><input type="hidden" name="aliastype" value="other" /><input type="hidden" name="dmtype" value="bizmail" /><input type="hidden" name="p" value="" /><div class="bizmail_column"><label>\u8d26\u53f7:</label><div class="bizmail_inputArea"><input type="text" name="uin" class="text" value="" />@#domainlist#</div></div><div class="bizmail_column"><label>\u5bc6\u7801:</label><div class="bizmail_inputArea"><input type="password" name="pwd" class="text" value="" /></div></div><div class="bizmail_SubmitArea"><input type="submit" class="" name="" style="width:66px;" value="\u767b\u5f55" /><a href="https://exmail.qq.com/cgi-bin/readtemplate?check=false&t=biz_rf_portal#recovery" target="_blank">\u5fd8\u8bb0\u5bc6\u7801\uff1f</a></div></form></div></div>',
            l = e.domainlist.split(";");
        if (1 == l.length) var m = '<span>#domain#</span><input type="hidden" name="domain" value="#domain#" />'.replace(/#domain#/g, l[0]);
        else {
            m = '<select name="domain">';
            for (i = 0; i < l.length; i++) m += '<option value="' + l[i] + '">' + l[i] + "</option>";
            m += "</select>"
        }
        e.mode && "vertical" != e.mode && "both" != e.mode || document.write(n.replace(/#domainlist#/g, m)), "horizontal" != e.mode && "both" != e.mode || document.write(t.replace(/#domainlist#/g, m))
    }
}

</script>      

<script type="text/javascript"> writeLoginPanel({domainlist:"mviai.com", mode:"horizontal"});</script>      


        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  <script>
  NexT.utils.loadComments(document.querySelector('#SOHUCS'), () => {
    var appid = 'cyxmItxjS';
    var conf = 'e5e71132d9086bb54aeeba6e88e87df9';
    var width = window.innerWidth || document.documentElement.clientWidth;
    if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
    } else {
      var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});
    }
  });
  </script>
  <script src="https://cy-cdn.kuaizhan.com/upload/plugins/plugins.count.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":75,"height":150},"mobile":{"show":true},"log":false});</script></body>
</html>




